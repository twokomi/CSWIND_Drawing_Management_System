<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì”¨ì—ìŠ¤ìœˆë“œ ë„ë©´ê´€ë¦¬ & MTO ì‹œìŠ¤í…œ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SheetJS for Excel file parsing -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Custom CSS - ì¸ë¼ì¸ìœ¼ë¡œ ì²˜ë¦¬ -->
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* ì›Œí¬í”Œë¡œìš° ìŠ¤í… ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .workflow-step {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        
        .workflow-step.hidden {
            opacity: 0;
            transform: translateY(10px);
        }
        
        /* í”„ë¡œì íŠ¸ í–‰ í˜¸ë²„ íš¨ê³¼ */
        .project-row {
            transition: all 0.2s ease-in-out;
        }
        
        .project-row:hover {
            background-color: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        /* ë‹¨ê³„ ì¸ë””ì¼€ì´í„° ì• ë‹ˆë©”ì´ì…˜ */
        .step-indicator {
            transition: all 0.3s ease-in-out;
        }
        
        /* BOM Tree ìŠ¤íƒ€ì¼ë§ */
        .bom-tree-row {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .bom-tree-row:hover {
            background-color: #f3f4f6;
        }
        
        .bom-tree-row.depth-0 { background-color: #fef3c7; }
        .bom-tree-row.depth-1 { background-color: #dbeafe; }
        .bom-tree-row.depth-2 { background-color: #f3e8ff; }
        .bom-tree-row.depth-3 { background-color: #dcfce7; }
        .bom-tree-row.depth-4 { background-color: #fce7f3; }
        .bom-tree-row.depth-5 { background-color: #f1f5f9; }
        
        .toggle-icon {
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s ease;
        }
        
        .toggle-icon.expanded {
            transform: rotate(90deg);
        }
        
        /* PDF ë·°ì–´ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ë§ */
        .pdf-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }
        
        .pdf-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pdf-modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 95%;
            max-height: 95%;
            overflow: auto;
            position: relative;
        }
        
        .pdf-modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .pdf-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            z-index: 1001;
        }
        
        .pdf-modal-close:hover {
            color: #374151;
        }
        
        /* ë“œë˜ê·¸ì•¤ë“œë¡­ ìŠ¤íƒ€ì¼ë§ */
        .bom-item, .supplier-package-item {
            transition: all 0.3s ease;
            cursor: grab;
            border: 2px solid transparent;
        }
        
        .bom-item:hover, .supplier-package-item:hover {
            background-color: #f3f4f6;
            border-color: #e5e7eb;
        }
        
        .bom-item.dragging, .supplier-package-item.dragging {
            opacity: 0.7;
            transform: scale(1.02) rotate(2deg);
            cursor: grabbing;
            z-index: 1000;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            background-color: #eff6ff;
            border-color: #3b82f6;
        }
        
        .drag-handle {
            cursor: grab;
            transition: color 0.2s ease;
        }
        
        .drag-handle:hover {
            color: #3b82f6;
        }
        
        .supplier-package {
            min-height: 120px;
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        
        .supplier-package.drag-over {
            border-color: #10b981;
            background-color: #ecfdf5;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
            transform: scale(1.02);
        }
        
        .supplier-package.drag-over > div:first-child {
            background-color: #10b981;
            color: white;
        }
        
        .supplier-package.has-items {
            border-style: solid;
            border-color: #e5e7eb;
        }
        
        /* ë“œë¡œë‹¤ìš´ ë©”ë‰´ ìŠ¤íƒ€ì¼ë§ */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 50;
            min-width: 200px;
            margin-top: 4px;
        }
        
        .dropdown:hover .dropdown-menu {
            display: block;
        }
        
        .dropdown-item {
            display: block;
            padding: 12px 16px;
            color: #374151;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        
        .dropdown-item:hover {
            background-color: #f3f4f6;
        }
        
        .dropdown-item:first-child {
            border-radius: 7px 7px 0 0;
        }
        
        .dropdown-item:last-child {
            border-radius: 0 0 7px 7px;
        }
        
        /* AI ì‹ ë¢°ë„ ë°°ì§€ */
        .confidence-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .confidence-high {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .confidence-medium {
            background-color: #fed7aa;
            color: #9a3412;
        }
        
        .confidence-low {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* ë„ë©´ ë§í¬ ìŠ¤íƒ€ì¼ë§ */
        .drawing-link {
            color: #3b82f6;
            text-decoration: underline;
            cursor: pointer;
            font-weight: 500;
        }
        
        .drawing-link:hover {
            color: #1d4ed8;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { max-height: 0; opacity: 0; }
            to { max-height: 400px; opacity: 1; }
        }
        
        @keyframes slideUp {
            from { max-height: 400px; opacity: 1; }
            to { max-height: 0; opacity: 0; }
        }
        
        .slide-down {
            animation: slideDown 0.4s ease-out forwards;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-in forwards;
        }
        
        /* BOM íŠ¸ë¦¬ êµ¬ì¡° ìŠ¤íƒ€ì¼ë§ */
        .bom-tree-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .bom-tree-level-1 {
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
        }
        
        .bom-tree-level-2 {
            background-color: #f1f5f9;
            border-left: 4px solid #10b981;
            margin-left: 20px;
        }
        
        .bom-tree-level-3 {
            background-color: #fefce8;
            border-left: 4px solid #f59e0b;
            margin-left: 40px;
        }
        
        .bom-tree-level-4 {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
            margin-left: 60px;
        }
        
        .bom-tree-item.expanded {
            background-color: #eff6ff;
        }
        
        .bom-tree-item.collapsed .bom-children {
            display: none;
        }
        
        .bom-tree-toggle {
            transition: transform 0.3s ease;
        }
        
        .bom-tree-toggle.expanded {
            transform: rotate(90deg);
        }
        
        /* ì›ë³¸ ì—‘ì…€ í…Œì´ë¸” ìŠ¤íƒ€ì¼ë§ */
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .excel-table th {
            background-color: #374151;
            color: white;
            padding: 8px 12px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #4b5563;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .excel-table td {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            background-color: white;
        }
        
        .excel-table tr:nth-child(even) td {
            background-color: #f9fafb;
        }
        
        .excel-table tr:hover td {
            background-color: #e5e7eb;
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ */
        @keyframes searchPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(251, 146, 60, 0.7);
                background-color: #fed7aa;
            }
            50% {
                box-shadow: 0 0 0 10px rgba(251, 146, 60, 0);
                background-color: #fdba74;
            }
            100% {
                box-shadow: 0 0 0 0 rgba(251, 146, 60, 0);
                background-color: #fed7aa;
            }
        }

        [data-search-highlight="true"] {
            background-color: #fed7aa !important;
            border: 3px solid #fb923c !important;
            box-shadow: 0 4px 12px rgba(251, 146, 60, 0.5), 
                        inset 0 0 0 1px rgba(251, 146, 60, 0.3) !important;
            animation: searchPulse 2s ease-in-out 2;
            position: relative;
            z-index: 10;
        }

        [data-search-highlight="true"] td {
            background-color: transparent !important;
            font-weight: 600;
            color: #7c2d12;
        }

        /* BOM íŠ¸ë¦¬ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .bom-tree-row {
            border-bottom: 1px solid #e5e7eb;
            transition: background-color 0.2s ease;
        }

        .bom-tree-row:hover {
            background-color: #fef3c7 !important;
        }

        .tree-name-cell {
            cursor: pointer;
            display: flex;
            align-items: center;
            min-height: 40px;
        }

        .tree-toggle-icon {
            cursor: pointer;
            user-select: none;
            margin-right: 8px;
            color: #3b82f6;
            font-weight: bold;
            font-size: 0.9rem;
            transition: transform 0.2s ease, color 0.2s ease;
            display: inline-block;
            width: 14px;
        }

        .tree-toggle-icon:hover {
            color: #1d4ed8;
            transform: scale(1.2);
        }

        .name-text {
            flex: 1;
            font-weight: 500;
        }

        /* ê³„ì¸µë³„ ìŠ¤íƒ€ì¼ë§ */
        .depth-1 {
            font-weight: 600;
        }

        .depth-2 {
            font-weight: 500;
        }

        .depth-3 {
            font-weight: 400;
        }

        .depth-4 {
            font-weight: 300;
            font-style: italic;
        }

        .hidden-tree-row {
            display: none !important;
        }

        /* íŠ¸ë¦¬ í…Œì´ë¸” í—¤ë” */
        #bom-tree-table thead th {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            font-weight: 600;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.2);
            white-space: nowrap;
            padding: 4px 6px;
            font-size: 0.75rem;
        }

        #bom-tree-table thead th:last-child {
            border-right: none;
        }

        /* íŠ¸ë¦¬ í…Œì´ë¸” ì…€ ìŠ¤íƒ€ì¼ */
        #bom-tree-table tbody td {
            border-right: 1px solid #e5e7eb;
            vertical-align: middle;
            padding: 3px 6px;
            font-size: 0.75rem;
            line-height: 1.2;
        }

        #bom-tree-table tbody td:last-child {
            border-right: none;
        }

        /* ê³„ì¸µë³„ ë°°ê²½ìƒ‰ */
        .depth-1 {
            background-color: #ffffff;
        }

        .depth-2 {
            background-color: #dbeafe;
        }

        .depth-3 {
            background-color: #e0e7ff;
        }

        .depth-4 {
            background-color: #ede9fe;
        }

        .depth-5 {
            background-color: #fdf2f8;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            #bom-tree-table {
                font-size: 0.8rem;
            }
            
            #bom-tree-table th,
            #bom-tree-table td {
                padding: 8px 6px;
            }
            
            .tree-name-cell {
                min-height: 32px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- í—¤ë” -->
    <header class="bg-white shadow-lg border-b border-gray-200">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-600 text-white p-2 rounded-lg">
                        <i class="fas fa-wind text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">CS Wind R&D</h1>
                        <p class="text-sm text-gray-600">ë„ë©´ê´€ë¦¬ & MTO ì‹œìŠ¤í…œ</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">í’ë ¥íƒ€ì›Œ ì œì¡°</span>
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-blue-600"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bg-white border-b border-gray-200">
        <div class="container mx-auto px-6">
            <div class="flex space-x-8">
                <button id="nav-projects" class="nav-tab active flex items-center space-x-2 py-4 px-2 border-b-2 border-blue-600 text-blue-600">
                    <i class="fas fa-folder-open"></i>
                    <span>í”„ë¡œì íŠ¸ ê´€ë¦¬</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="container mx-auto px-6 py-8">
        
        <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
        <!-- ğŸ”¥ ëŒ€ì‹œë³´ë“œ íƒ­ ì™„ì „ ì œê±° - í”„ë¡œì íŠ¸ ê´€ë¦¬ íƒ­ë§Œ ì‚¬ìš© -->
        <div id="tab-dashboard" class="tab-content hidden">
            <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ ì œê±°ë¨ -->
        </div>

        <!-- í”„ë¡œì íŠ¸ ê´€ë¦¬ íƒ­ (SalesíŒ€ìš©) -->
        <div id="tab-projects" class="tab-content">
            <!-- ì›Œí¬í”Œë¡œìš° í—¤ë” -->
            <div class="mb-6 bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">í”„ë¡œì íŠ¸ ìƒì„± ë° ê¸°ë³¸ BOM ë¶„ì„</h2>
                        <p class="text-sm text-gray-600 mt-1">SalesíŒ€ ì „ìš©: ë‹¨ê³„ë³„ í”„ë¡œì íŠ¸ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°</p>
                    </div>
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-medium">SalesíŒ€</span>
                </div>
                
                <!-- ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ í‘œì‹œ -->
                <div class="mt-4 flex items-center space-x-4">
                    <div id="step-indicator-1" class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold">1</div>
                        <span class="text-sm font-medium text-blue-700">í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400"></i>
                    <div id="step-indicator-2" class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-semibold">2</div>
                        <span class="text-sm text-gray-500">ì‹ ê·œ í”„ë¡œì íŠ¸ ìƒì„±</span>
                    </div>
                    <i class="fas fa-arrow-right text-gray-400"></i>
                    <div id="step-indicator-3" class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-semibold">3</div>
                        <span class="text-sm text-gray-500">BOM ë¶„ì„ & ë“œë¡œì‰ ì—…ë¡œë“œ</span>
                    </div>
                </div>
            </div>

            <!-- Step 1: í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ -->
            <div id="step-project-list" class="workflow-step">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">Step 1: í”„ë¡œì íŠ¸ ê´€ë¦¬</h3>
                        <p class="text-sm text-gray-600 mt-1">ë“±ë¡ëœ í”„ë¡œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ê³  ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
                    </div>
                    <button id="btn-new-project" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i>ìƒˆ í”„ë¡œì íŠ¸
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-list text-blue-600 mr-2"></i>
                            ë“±ë¡ëœ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸
                        </h4>
                    <div class="flex items-center space-x-2">
                        <button id="btn-delete-selected-projects" onclick="deleteSelectedProjects()" class="bg-red-600 text-white px-3 py-1.5 rounded-md hover:bg-red-700 transition-colors text-sm disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-trash-alt mr-1"></i>ì„ íƒ ì‚­ì œ (<span id="selected-count">0</span>)
                        </button>
                        <span id="project-count-sales" class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-medium">0ê°œ</span>
                        <button onclick="refreshProjectListSales()" class="text-blue-600 hover:text-blue-800 transition-colors" title="ëª©ë¡ ìƒˆë¡œê³ ì¹¨">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300 rounded-lg overflow-hidden">
                        <thead class="bg-gray-50">
                            <tr class="text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                <th class="px-3 py-2 border-r text-center">
                                    <input type="checkbox" id="select-all-projects" onchange="toggleAllProjectSelection()" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" title="ì „ì²´ ì„ íƒ/í•´ì œ">
                                </th>
                                <th class="px-3 py-2 border-r text-center">ë²ˆí˜¸</th>
                                <th class="px-3 py-2 border-r">í”„ë¡œì íŠ¸ëª…</th>
                                <th class="px-3 py-2 border-r text-center">í”„ë¡œì íŠ¸ íƒ€ì…</th>
                                <th class="px-3 py-2 border-r">ê³ ê°ì‚¬</th>
                                <th class="px-3 py-2 border-r text-center">ì‹œì‘ì¼</th>
                                <th class="px-3 py-2 border-r text-center">ì™„ë£Œì¼</th>
                                <th class="px-3 py-2 border-r text-center">BOM ë¶„ì„</th>
                                <th class="px-3 py-2 border-r text-center">ìƒíƒœ</th>
                                <th class="px-3 py-2 text-center">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="project-list-body-sales" class="bg-white divide-y divide-gray-200">
                            <tr id="no-projects-row">
                                <td colspan="10" class="px-6 py-8 text-center text-gray-500">
                                    <i class="fas fa-folder-open text-4xl mb-2 opacity-50"></i>
                                    <p>ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                    <p class="text-xs mt-1">ìœ„ì˜ "+ ìƒˆ í”„ë¡œì íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.</p>
                                    <p class="text-xs mt-2 text-blue-600">ğŸ’¡ í”„ë¡œì íŠ¸ ìƒì„± í›„ <strong>ë”ë¸”í´ë¦­</strong>í•˜ì—¬ BOM ë¶„ì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>

            <!-- Step 2: ì‹ ê·œ í”„ë¡œì íŠ¸ ìƒì„± -->
            <div id="step-new-project" class="workflow-step hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">Step 2: ì‹ ê·œ í”„ë¡œì íŠ¸ ìƒì„±</h3>
                        <p class="text-sm text-gray-600 mt-1">ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                    </div>
                    <button id="btn-back-to-list" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ë¡œ
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-folder-plus text-green-600 mr-2"></i>
                        í”„ë¡œì íŠ¸ ê¸°ë³¸ ì •ë³´ ì…ë ¥
                    </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">í”„ë¡œì íŠ¸ëª…</label>
                        <input type="text" id="project-name-sales" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="ì˜ˆ: í’ë ¥íƒ€ì›Œ HUB-E (2025-Q4)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">í”„ë¡œì íŠ¸ íƒ€ì…</label>
                        <select id="project-type-sales" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="í’ë ¥íƒ€ì›Œ">í’ë ¥íƒ€ì›Œ</option>
                            <option value="í•´ìƒí’ë ¥">í•´ìƒí’ë ¥</option>
                            <option value="ìœ¡ìƒí’ë ¥">ìœ¡ìƒí’ë ¥</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê³ ê°ì‚¬</label>
                        <input type="text" id="customer-name-sales" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                               placeholder="ì˜ˆ: Siemens Gamesa">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">í”„ë¡œì íŠ¸ ì‹œì‘ì¼</label>
                        <input type="date" id="project-start-date-sales" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ˆìƒ ì™„ë£Œì¼</label>
                        <input type="date" id="project-end-date-sales" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
                    <button onclick="createProjectSales()" 
                            class="mt-4 bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition">
                        <i class="fas fa-save mr-2"></i>í”„ë¡œì íŠ¸ ìƒì„±
                    </button>
                </div>
            </div>

            <!-- Step 3: BOM ë¶„ì„ & ë“œë¡œì‰ ì—…ë¡œë“œ -->
            <div id="step-bom-drawing" class="workflow-step hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800">Step 3: BOM ë¶„ì„ & ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ</h3>
                        <p class="text-sm text-gray-600 mt-1" id="selected-project-info">ì„ íƒëœ í”„ë¡œì íŠ¸: <span class="font-medium text-blue-600"></span></p>
                    </div>
                    <button id="btn-back-to-list-from-analysis" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ë¡œ
                    </button>
                </div>

                <!-- 3-1. BOM íŒŒì¼ ì—…ë¡œë“œ -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-file-excel text-blue-600 mr-2"></i>
                        ê¸°ë³¸ BOM ë¶„ì„ - íŒŒì¼ ì—…ë¡œë“œ
                    </h4>
                
                    <div id="bom-upload-section">
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 mb-4">
                        <div class="text-center">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <div class="mb-4">
                                <label for="bom-file-input-sales" class="cursor-pointer">
                                    <span class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 inline-block">
                                        <i class="fas fa-file-excel mr-2"></i>BOM íŒŒì¼ ì„ íƒ
                                    </span>
                                    <input type="file" id="bom-file-input-sales" accept=".xlsx,.xls,.csv" class="hidden">
                                </label>
                            </div>
                            <p class="text-sm text-gray-600">Excel íŒŒì¼ (.xlsx, .xls) ë˜ëŠ” CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
                            <p class="text-xs text-gray-500 mt-1">ì§€ì› ì»¬ëŸ¼: Depth, Name, Number, Version, FindNumber, Quantity, Unit, Weight, Material ë“±</p>
                        </div>
                    </div>
                    
                    <!-- ì„ íƒëœ íŒŒì¼ ì •ë³´ -->
                    <div id="selected-bom-file-info-sales" class="hidden bg-blue-50 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-file-excel text-green-600 mr-3"></i>
                                <div>
                                    <p id="bom-file-name-sales" class="font-medium text-gray-700"></p>
                                    <p id="bom-file-size-sales" class="text-sm text-gray-500"></p>
                                </div>
                            </div>
                            <button onclick="clearBOMFileSales()" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button id="upload-bom-btn-sales" onclick="uploadBOMFileSales()" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition duration-200 disabled:bg-gray-400">
                        <i class="fas fa-upload mr-2"></i>ê¸°ë³¸ BOM ë¶„ì„ ì‹œì‘
                    </button>
                    </div>
                </div>
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-folder-open text-orange-600 mr-2"></i>
                    ë“œë¡œì‰ íŒ¨í‚¤ì§€ í´ë” ì—…ë¡œë“œ
                </h3>
                
                    <div id="drawing-upload-section">
                    <div class="border-2 border-dashed border-orange-300 rounded-lg p-6 mb-4">
                        <div class="text-center">
                            <i class="fas fa-folder-open text-4xl text-orange-400 mb-4"></i>
                            <div class="mb-4">
                                <label for="drawing-package-input-sales" class="cursor-pointer">
                                    <span class="bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 transition duration-200 inline-block">
                                        <i class="fas fa-folder-open mr-2"></i>í´ë” ì„ íƒ
                                    </span>
                                    <input type="file" id="drawing-package-input-sales" webkitdirectory directory multiple accept=".pdf" class="hidden">
                                </label>
                            </div>
                            <p class="text-sm text-gray-600">PDF ë„ë©´ íŒŒì¼ë“¤ì´ í¬í•¨ëœ ë“œë¡œì‰ íŒ¨í‚¤ì§€ í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                            <p class="text-xs text-gray-500 mt-1">ìë™ìœ¼ë¡œ BOM Numberì™€ ë„ë©´ íŒŒì¼ì„ ë§¤ì¹­í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    
                    <!-- ì„ íƒëœ í´ë” ì •ë³´ -->
                    <div id="selected-drawing-info-sales" class="hidden bg-orange-50 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-folder-open text-orange-600 mr-3"></i>
                                <div>
                                    <p id="drawing-folder-name-sales" class="font-medium text-gray-700"></p>
                                    <p id="drawing-file-count-sales" class="text-sm text-gray-500"></p>
                                </div>
                            </div>
                            <button onclick="clearDrawingPackageSales()" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                        <button id="upload-drawings-btn-sales" onclick="uploadDrawingPackageSales()" 
                                class="bg-orange-600 text-white px-6 py-2 rounded-md hover:bg-orange-700 transition duration-200 disabled:bg-gray-400">
                            <i class="fas fa-upload mr-2"></i>ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ
                        </button>
                    </div>
                </div>

            <!-- 4. ê¸°ë³¸ BOM ë¶„ì„ í…Œì´ë¸” -->
            <div id="basic-bom-analysis-section-sales" class="bg-white rounded-lg shadow p-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-sitemap text-purple-600 mr-2"></i>
                        ê¸°ë³¸ BOM ë¶„ì„ ê²°ê³¼ (SalesíŒ€ ê²€í† ìš©)
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <!-- ì „ì²´ ì œì–´ ë²„íŠ¼ -->
                        <div class="flex space-x-1">
                            <button onclick="expandAllTreeRowsSales()" class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200">
                                <i class="fas fa-expand-alt mr-1"></i>ì „ì²´ í¼ì¹˜ê¸°
                            </button>
                            <button onclick="collapseAllTreeRowsSales()" class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded hover:bg-gray-200">
                                <i class="fas fa-compress-alt mr-1"></i>ì „ì²´ ì ‘ê¸°
                            </button>
                        </div>
                        
                        <!-- ë ˆë²¨ë³„ í¼ì¹˜ê¸° ë²„íŠ¼ -->
                        <div class="flex space-x-1 border-l pl-2">
                            <span class="text-xs text-gray-500 self-center mr-1">ë ˆë²¨ë³„:</span>
                            <button onclick="expandToLevelSales(0)" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200">L0</button>
                            <button onclick="expandToLevelSales(1)" class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200">L1</button>
                            <button onclick="expandToLevelSales(2)" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200">L2</button>
                            <button onclick="expandToLevelSales(3)" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200">L3</button>
                            <button onclick="expandToLevelSales(4)" class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded hover:bg-yellow-200">L4</button>
                            <button onclick="expandToLevelSales(5)" class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded hover:bg-red-200">L5</button>
                        </div>
                        
                        <!-- CSV ë‚´ë³´ë‚´ê¸° -->
                        <div class="border-l pl-2">
                            <button onclick="exportVisibleItemsSales()" class="text-sm bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200">
                                <i class="fas fa-download mr-1"></i>CSV ë‚´ë³´ë‚´ê¸°
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- BOM í†µê³„ ì •ë³´ -->
                <div id="bom-statistics-sales" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 p-4 bg-gray-50 rounded-lg">
                    <div class="text-center">
                        <div id="total-items-sales" class="text-2xl font-bold text-blue-600">0</div>
                        <div class="text-sm text-gray-600">ì´ ì•„ì´í…œ</div>
                    </div>
                    <div class="text-center">
                        <div id="visible-items-sales" class="text-2xl font-bold text-green-600">0</div>
                        <div class="text-sm text-gray-600">í‘œì‹œ ì¤‘</div>
                    </div>
                    <div class="text-center">
                        <div id="max-depth-sales" class="text-2xl font-bold text-purple-600">0</div>
                        <div class="text-sm text-gray-600">ìµœëŒ€ ë ˆë²¨</div>
                    </div>
                    <div class="text-center">
                        <div id="parent-items-sales" class="text-2xl font-bold text-orange-600">0</div>
                        <div class="text-sm text-gray-600">ë¶€ëª¨ ì•„ì´í…œ</div>
                    </div>
                </div>
                
                <!-- BOM íŠ¸ë¦¬ í…Œì´ë¸” -->
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300 rounded-lg overflow-hidden">
                        <thead class="bg-gray-100">
                            <tr class="text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                <th class="px-2 py-2 border-r text-xs">Depth</th>
                                <th class="px-2 py-2 border-r text-xs">Name</th>
                                <th class="px-2 py-2 border-r text-xs">Number</th>
                                <th class="px-2 py-2 border-r text-xs">Version</th>
                                <th class="px-2 py-2 border-r text-xs">FindNumber</th>
                                <th class="px-2 py-2 border-r text-xs">Quantity</th>
                                <th class="px-2 py-2 border-r text-xs">Unit</th>
                                <th class="px-2 py-2 border-r text-xs">Weight</th>
                                <th class="px-2 py-2 border-r text-xs">Material</th>
                                <th class="px-2 py-2 text-center text-xs">Drawing</th>
                            </tr>
                        </thead>
                        <tbody id="bom-tree-body-sales" class="bg-white divide-y divide-gray-200">
                            <!-- BOM íŠ¸ë¦¬ í–‰ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ì‹œìŠ¤í…œ ë“±ë¡ ì„¹ì…˜ -->
            <!-- ğŸ”¥ ì‹œìŠ¤í…œ ë“±ë¡ ì„¹ì…˜ ì œê±°ë¨ - ë“œë¡œì‰ ì—…ë¡œë“œ ì™„ë£Œ ì‹œ ìë™ ì €ì¥ -->

            <!-- 5. ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ ê´€ë¦¬ ì„¹ì…˜ (NEW!) -->
            <div id="unmatched-items-section-sales" class="bg-white rounded-lg shadow p-6 mt-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-exclamation-triangle text-orange-600 mr-2"></i>
                            ë„ë©´ ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ (ê³ ê°ì‚¬ ë³´ê³ ìš©)
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">
                            ë“œë¡œì‰ íŒ¨í‚¤ì§€ì— ëˆ„ë½ëœ ë„ë©´ ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ í•­ëª©ì„ ì„ íƒ ì‚­ì œí•œ í›„ Excelë¡œ ë‚´ë³´ë‚´ì–´ ê³ ê°ì‚¬ì— ë³´ê³ í•˜ì„¸ìš”.
                        </p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="unmatched-count-badge" class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">
                            0ê°œ ëˆ„ë½
                        </span>
                    </div>
                </div>

                <!-- í†µê³„ ì •ë³´ -->
                <div class="grid grid-cols-3 gap-4 mb-4 p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <div class="text-center">
                        <div id="unmatched-total-count" class="text-2xl font-bold text-orange-600">0</div>
                        <div class="text-sm text-gray-600">ë§¤ì¹­ ì‹¤íŒ¨</div>
                    </div>
                    <div class="text-center">
                        <div id="unmatched-selected-count" class="text-2xl font-bold text-blue-600">0</div>
                        <div class="text-sm text-gray-600">ì„ íƒë¨</div>
                    </div>
                    <div class="text-center">
                        <div id="unmatched-after-delete-count" class="text-2xl font-bold text-green-600">0</div>
                        <div class="text-sm text-gray-600">ì‚­ì œ í›„ ë‚¨ìŒ</div>
                    </div>
                </div>

                <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="select-all-unmatched" onchange="toggleAllUnmatchedSelection()" 
                               class="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                        <label for="select-all-unmatched" class="text-sm font-medium text-gray-700">ì „ì²´ ì„ íƒ</label>
                    </div>
                    <div class="flex space-x-2">
                        <button id="btn-delete-selected-unmatched" onclick="deleteSelectedUnmatchedItems()" 
                                class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed" 
                                disabled>
                            <i class="fas fa-trash mr-2"></i>ì„ íƒ í•­ëª© ì‚­ì œ (<span id="unmatched-delete-count">0</span>ê°œ)
                        </button>
                        <button id="btn-export-unmatched-excel" onclick="exportUnmatchedToExcel()" 
                                class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
                            <i class="fas fa-file-excel mr-2"></i>Excelë¡œ ë‚´ë³´ë‚´ê¸°
                        </button>
                    </div>
                </div>

                <!-- ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ í…Œì´ë¸” -->
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300 rounded-lg overflow-hidden">
                        <thead class="bg-orange-100">
                            <tr class="text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                <th class="px-2 py-2 border-r text-center">
                                    <input type="checkbox" id="header-select-all-unmatched" onchange="toggleAllUnmatchedSelection()" 
                                           class="w-4 h-4 text-blue-600 rounded">
                                </th>
                                <th class="px-2 py-2 border-r text-xs">Depth</th>
                                <th class="px-2 py-2 border-r text-xs">Name</th>
                                <th class="px-2 py-2 border-r text-xs">Number</th>
                                <th class="px-2 py-2 border-r text-xs">Version</th>
                                <th class="px-2 py-2 border-r text-xs">FindNumber</th>
                                <th class="px-2 py-2 border-r text-xs">Quantity</th>
                                <th class="px-2 py-2 border-r text-xs">Unit</th>
                                <th class="px-2 py-2 border-r text-xs">Weight</th>
                                <th class="px-2 py-2 text-xs">Material</th>
                            </tr>
                        </thead>
                        <tbody id="unmatched-items-body" class="bg-white divide-y divide-gray-200">
                            <!-- ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>

                <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
                <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    <strong>ì‚¬ìš© ë°©ë²•:</strong> 
                    1) ë„ë©´ì´ ì‹¤ì œë¡œ í•„ìš” ì—†ëŠ” í•­ëª©ì€ ì²´í¬ë°•ìŠ¤ë¡œ ì„ íƒ â†’ 2) "ì„ íƒ í•­ëª© ì‚­ì œ" í´ë¦­ â†’ 3) "Excelë¡œ ë‚´ë³´ë‚´ê¸°"ë¡œ ê³ ê°ì‚¬ ë³´ê³ ìš© íŒŒì¼ ìƒì„±
                </div>
            </div>

            <!-- ê¸°ì¡´ í”„ë¡œì íŠ¸ ëª©ë¡ -->
            <div id="projects-list" class="bg-white rounded-lg shadow">
                <!-- í”„ë¡œì íŠ¸ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- BOM ë¶„ì„ íƒ­ -->
        <div id="tab-bom" class="tab-content hidden">
            
            <!-- CEO ìŠ¹ì¸ ì™„ë£Œ íŒ¨í‚¤ì§€ ëª©ë¡ -->
            <div id="approved-packages-section" class="mb-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-green-200">
                <div class="p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-green-800 flex items-center">
                            <i class="fas fa-check-circle text-green-600 mr-2"></i>
                            CEO ìŠ¹ì¸ ì™„ë£Œ íŒ¨í‚¤ì§€
                        </h3>
                        <div class="flex items-center space-x-2">
                            <span id="approved-packages-count" class="text-sm bg-green-100 text-green-800 px-2 py-1 rounded-full font-medium">0ê°œ</span>
                            <button onclick="window.csWindApp?.advancedBOMManager?.updateApprovedPackagesUI()" class="text-green-600 hover:text-green-800 transition-colors" title="ìƒˆë¡œê³ ì¹¨">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div id="approved-packages-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <!-- ìŠ¹ì¸ ì™„ë£Œëœ íŒ¨í‚¤ì§€ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <!-- ë””ë²„ê¹… ì „ìš© í…ŒìŠ¤íŠ¸ ë²„íŠ¼ (ê°œë°œ ë‹¨ê³„ì—ì„œë§Œ í‘œì‹œ) -->
                    <div id="debug-test-section" class="mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg" style="display: none;">
                        <p class="text-sm text-gray-600 mb-2">
                            <i class="fas fa-bug mr-2"></i>ê°œë°œì ì „ìš©: ë””ë²„ê¹… ë„êµ¬
                        </p>
                        <button onclick="testCEOApproval()" class="px-3 py-1.5 bg-gray-500 text-white rounded text-xs hover:bg-gray-600 transition-colors mr-2">
                            <i class="fas fa-flask mr-1"></i>í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                        </button>
                        <button onclick="resetAllProjectData()" class="px-3 py-1.5 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors mr-2">
                            <i class="fas fa-trash mr-1"></i>í”„ë¡œì íŠ¸ ë°ì´í„° ì´ˆê¸°í™”
                        </button>
                        <button onclick="debugCurrentState()" class="px-3 py-1.5 bg-yellow-500 text-white rounded text-xs hover:bg-yellow-600 transition-colors">
                            <i class="fas fa-bug mr-1"></i>ìƒíƒœ í™•ì¸
                        </button>
                        <span class="ml-2 text-xs text-gray-500">(Ctrl+Shift+Dë¡œ í† ê¸€)</span>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">AI ê³ ê¸‰ BOM ë¶„ì„ ë° MTO ìƒì„±</h2>
                    <p class="text-sm text-gray-600 mt-1">Prod. TechíŒ€ ì „ìš©: AI ê¸°ë°˜ 8-way ìì¬ ë¶„ë¥˜ ë° ìë™ ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°</p>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium">Prod. TechíŒ€</span>
                </div>
            </div>
            
            <!-- 1. í”„ë¡œì íŠ¸ ì„ íƒ (SalesíŒ€ì´ ë“±ë¡í•œ í”„ë¡œì íŠ¸) -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-project-diagram text-blue-600 mr-2"></i>
                    SalesíŒ€ ë“±ë¡ í”„ë¡œì íŠ¸ ì„ íƒ
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ë¶„ì„í•  í”„ë¡œì íŠ¸ ì„ íƒ
                        </label>
                        <select id="project-select-prodtech" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="project-001">í’ë ¥íƒ€ì›Œ HUB-A (2025-Q1) - Siemens Gamesa</option>
                            <option value="project-002">í’ë ¥íƒ€ì›Œ HUB-B (2025-Q2) - Vestas</option>
                            <option value="project-003">í’ë ¥íƒ€ì›Œ HUB-C (2025-Q3) - GE Renewable Energy</option>
                            <option value="project-004">í’ë ¥íƒ€ì›Œ HUB-D (2025-Q4) - Ã˜rsted</option>
                        </select>
                    </div>
                    
                    <!-- ì„ íƒëœ í”„ë¡œì íŠ¸ ì •ë³´ -->
                    <div id="selected-project-info-prodtech" class="bg-blue-50 rounded-lg p-4 hidden">
                        <h4 class="font-medium text-gray-700 mb-2">ì„ íƒëœ í”„ë¡œì íŠ¸ ì •ë³´</h4>
                        <div id="project-info-content-prodtech" class="text-sm text-gray-600">
                            <!-- í”„ë¡œì íŠ¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. ë„ë©´ íŒ¨í‚¤ì§€ ëª©ë¡ -->
            <div id="drawing-package-list-prodtech" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-folder-open text-orange-600 mr-2"></i>
                    ë“±ë¡ëœ ë„ë©´ íŒ¨í‚¤ì§€ ëª©ë¡
                </h3>
                <div id="drawing-files-list-prodtech" class="space-y-2">
                    <!-- ë„ë©´ íŒŒì¼ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- 3. AI ë¶„ì„ ë° MTO ìƒì„± -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-robot text-purple-600 mr-2"></i>
                    AI ê¸°ë°˜ MTO ìƒì„± ë° 8-way ìì¬ ë¶„ë¥˜
                </h3>
                
                <!-- AI ë¶„ì„ ì†Œê°œ -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-brain text-2xl text-purple-600 mr-3"></i>
                        <h4 class="text-xl font-semibold text-gray-800">8-Way ìì¬ ë¶„ë¥˜ AI ì‹œìŠ¤í…œ</h4>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-clock text-red-500 mr-1"></i>LLT (Long Lead Time)
                        </div>
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-cubes text-blue-500 mr-1"></i>ëª¨ë“ˆë‹¨ìœ„ ì¡°ë¦½í’ˆ
                        </div>
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-hammer text-gray-700 mr-1"></i>ê³ ê°•ë„ ê°•ì¬
                        </div>
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-circle-notch text-orange-500 mr-1"></i>í”Œëœì§€ë¥˜
                        </div>
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-screwdriver text-green-500 mr-1"></i>Small Parts
                        </div>
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-weight-hanging text-purple-500 mr-1"></i>Large Parts
                        </div>
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-bolt text-yellow-500 mr-1"></i>ì „ì¥í’ˆ
                        </div>
                        <div class="bg-white rounded p-2 border border-gray-200">
                            <i class="fas fa-ellipsis-h text-gray-500 mr-1"></i>ê¸°íƒ€
                        </div>
                    </div>
                </div>
                
                <button id="btn-ai-mto-generation" onclick="startAIMTOGeneration()" 
                        class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-3 rounded-lg hover:from-purple-700 hover:to-blue-700 transition duration-200 disabled:from-gray-400 disabled:to-gray-400" disabled>
                    <i class="fas fa-magic mr-2"></i>AI ê¸°ë°˜ MTO ìƒì„± ë° ìì¬ ë¶„ë¥˜ ì‹œì‘
                </button>
                
                <!-- AI ë¶„ì„ ì§„í–‰ í‘œì‹œ -->
                <div id="ai-analysis-progress-prodtech" class="hidden mt-6 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center mb-3">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                        <h4 class="font-medium text-gray-700">AI ë¶„ì„ ì§„í–‰ ì¤‘...</h4>
                    </div>
                    <div class="text-sm text-gray-600 space-y-1">
                        <div id="analysis-step-1-prodtech" class="flex items-center">
                            <i class="fas fa-clock text-gray-400 mr-2"></i>
                            <span>BOM ë°ì´í„° êµ¬ì¡° ë¶„ì„ ì¤‘...</span>
                        </div>
                        <div id="analysis-step-2-prodtech" class="flex items-center">
                            <i class="fas fa-clock text-gray-400 mr-2"></i>
                            <span>ë„ë©´ íŒŒì¼ ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
                        </div>
                        <div id="analysis-step-3-prodtech" class="flex items-center">
                            <i class="fas fa-clock text-gray-400 mr-2"></i>
                            <span>8-way ìì¬ ë¶„ë¥˜ ì‹¤í–‰ ì¤‘...</span>
                        </div>
                        <div id="analysis-step-4-prodtech" class="flex items-center">
                            <i class="fas fa-clock text-gray-400 mr-2"></i>
                            <span>MTO ê²°ê³¼ ìƒì„± ì¤‘...</span>
                        </div>
                    </div>
                </div>
                
                <!-- MTO ë¶„ì„ ê²°ê³¼ ì˜ì—­ -->
                <div id="mto-results-section-prodtech" class="hidden mt-6 bg-white border border-gray-200 rounded-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        MTO ë¶„ì„ ê²°ê³¼
                    </h4>
                    <div id="mto-results-content-prodtech">
                        <!-- MTO ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    
                    <!-- ìŠ¹ì¸ ìš”ì²­ ë²„íŠ¼ -->
                    <div class="mt-6 flex justify-end">
                        <button id="btn-submit-approval-prodtech" onclick="submitApprovalRequestProdTech()" 
                                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                            <i class="fas fa-paper-plane mr-2"></i>ìŠ¹ì¸ ìš”ì²­ (3ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°)
                        </button>
                    </div>
                </div>
            </div>

            <!-- ê¸°ì¡´ ê¸°ë³¸ BOM ë¶„ì„ ì¸í„°í˜ì´ìŠ¤ëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ -->
            <div id="basic-bom-interface" style="display: none;">
                <!-- í”„ë¡œì íŠ¸ ì„ íƒ ì„¹ì…˜ -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-folder-open text-blue-600 mr-2"></i>
                            í”„ë¡œì íŠ¸ ì„ íƒ
                        </h3>
                        <button onclick="refreshProjectList()" class="text-blue-600 hover:text-blue-800 transition-colors" title="í”„ë¡œì íŠ¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- í”„ë¡œì íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ë¶„ì„í•  í”„ë¡œì íŠ¸ ì„ íƒ
                            </label>
                            <select id="project-select-bom" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="project-001">í’ë ¥íƒ€ì›Œ HUB-A (2025-Q1)</option>
                                <option value="project-002">í’ë ¥íƒ€ì›Œ HUB-B (2025-Q2)</option>
                                <option value="project-003">í’ë ¥íƒ€ì›Œ HUB-C (2025-Q3)</option>
                                <option value="project-004">í’ë ¥íƒ€ì›Œ HUB-D (2025-Q4)</option>
                            </select>
                        </div>
                        
                        <!-- ì„ íƒëœ í”„ë¡œì íŠ¸ ì •ë³´ -->
                        <div id="selected-project-info" class="bg-gray-50 rounded-lg p-4 hidden">
                            <h4 class="font-medium text-gray-700 mb-2">ì„ íƒëœ í”„ë¡œì íŠ¸</h4>
                            <div id="project-info-content" class="text-sm text-gray-600">
                                <!-- í”„ë¡œì íŠ¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-upload text-green-600 mr-2"></i>
                            íŒŒì¼ ì—…ë¡œë“œ
                        </h3>
                        <div class="text-sm text-gray-500">
                            BOM íŒŒì¼ + ë“œë¡œì‰ íŒ¨í‚¤ì§€ í´ë”
                        </div>
                    </div>
                    
                    <!-- ì—…ë¡œë“œ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                    <div class="flex mb-6 bg-gray-100 rounded-lg p-1" id="upload-tab-container">
                        <button id="tab-bom-upload" 
                                onclick="activateBOMTab()" 
                                class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm" 
                                style="cursor: pointer; z-index: 100; position: relative;">
                            <i class="fas fa-file-excel mr-2"></i>BOM íŒŒì¼
                        </button>
                        <button id="tab-drawing-upload" 
                                onclick="activateDrawingTab()" 
                                class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800" 
                                style="cursor: pointer; z-index: 100; position: relative;">
                            <i class="fas fa-folder-open mr-2"></i>ë“œë¡œì‰ íŒ¨í‚¤ì§€
                        </button>
                    </div>
                    
                    <!-- BOM íŒŒì¼ ì—…ë¡œë“œ íŒ¨ë„ -->
                    <div id="panel-bom-upload" class="upload-panel">
                        <div class="mb-4">
                            <div class="text-sm text-gray-600 mb-2">
                                ì§€ì› í˜•ì‹: Excel (.xlsx, .xls), CSV
                            </div>
                        </div>
                    
                    <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 mb-4">
                        <div class="text-center">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <div class="mb-4">
                                <label for="bom-file-input" class="cursor-pointer">
                                    <span class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 inline-block">
                                        <i class="fas fa-file-excel mr-2"></i>íŒŒì¼ ì„ íƒ
                                    </span>
                                    <input type="file" id="bom-file-input" accept=".xlsx,.xls,.csv" class="hidden">
                                </label>
                            </div>
                            <p class="text-sm text-gray-600">
                                ë˜ëŠ” íŒŒì¼ì„ ì´ ì˜ì—­ìœ¼ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”
                            </p>
                        </div>
                    </div>
                    
                    <!-- ì„ íƒëœ íŒŒì¼ ì •ë³´ -->
                    <div id="selected-file-info" class="hidden bg-blue-50 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-file-excel text-green-600 mr-3"></i>
                                <div>
                                    <p id="file-name" class="font-medium text-gray-700"></p>
                                    <p id="file-size" class="text-sm text-gray-500"></p>
                                </div>
                            </div>
                            <button onclick="clearSelectedFile()" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                        <!-- ì—…ë¡œë“œ ë²„íŠ¼ -->
                        <div class="flex justify-between items-center">
                            <div class="text-sm text-gray-600">
                                <i class="fas fa-info-circle mr-1"></i>
                                ì—…ë¡œë“œëœ íŒŒì¼ì—ì„œ 10ê°€ì§€ í•„ìˆ˜ ì»¬ëŸ¼ì„ ìë™ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤
                            </div>
                            <button id="upload-bom-btn" onclick="uploadBOMFileBasic()" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition duration-200 disabled:bg-gray-400" disabled>
                                <i class="fas fa-upload mr-2"></i>BOM ë¶„ì„ ì‹œì‘
                            </button>
                        </div>
                    </div>
                    
                    <!-- ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ íŒ¨ë„ -->
                    <div id="panel-drawing-upload" class="upload-panel hidden">
                        <div class="mb-4">
                            <div class="text-sm text-gray-600 mb-2">
                                ë“œë¡œì‰ íŒ¨í‚¤ì§€ í´ë”ì˜ PDF íŒŒì¼ë“¤ì„ ì—…ë¡œë“œí•˜ì—¬ BOM Numberì™€ ì—°ê²°í•©ë‹ˆë‹¤
                            </div>
                        </div>
                        
                        <!-- ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ ì˜ì—­ -->
                        <div class="border-2 border-dashed border-orange-300 rounded-lg p-6 mb-4">
                            <div class="text-center">
                                <i class="fas fa-folder-open text-4xl text-orange-400 mb-4"></i>
                                <div class="mb-4">
                                    <label for="drawing-package-input" class="cursor-pointer">
                                        <span class="bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 transition duration-200 inline-block">
                                            <i class="fas fa-folder-open mr-2"></i>í´ë” ì„ íƒ
                                        </span>
                                        <input type="file" id="drawing-package-input" webkitdirectory directory multiple accept=".pdf" class="hidden" onchange="handleDrawingFolderSelection(this)">
                                    </label>
                                </div>
                                <p class="text-sm text-gray-600">
                                    PDF ë„ë©´ íŒŒì¼ë“¤ì´ í¬í•¨ëœ ë“œë¡œì‰ íŒ¨í‚¤ì§€ í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”
                                </p>
                            </div>
                        </div>
                        
                        <!-- ì„ íƒëœ í´ë” ì •ë³´ -->
                        <div id="selected-drawing-info" class="hidden bg-orange-50 rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-folder-open text-orange-600 mr-3"></i>
                                    <div>
                                        <p id="drawing-folder-name" class="font-medium text-gray-700"></p>
                                        <p id="drawing-file-count" class="text-sm text-gray-500"></p>
                                    </div>
                                </div>
                                <button onclick="clearSelectedDrawings()" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- ì—…ë¡œë“œ ë²„íŠ¼ -->
                        <div class="flex justify-between items-center">
                            <div class="text-sm text-gray-600">
                                <i class="fas fa-info-circle mr-1"></i>
                                PDF íŒŒì¼ëª…ì—ì„œ ë„ë©´ë²ˆí˜¸ë¥¼ ì¶”ì¶œí•˜ì—¬ BOM Numberì™€ ìë™ ë§¤ì¹­ë©ë‹ˆë‹¤
                            </div>
                            <button id="upload-drawings-btn" onclick="uploadDrawingPackageHTML()" class="bg-orange-600 text-white px-6 py-2 rounded-md hover:bg-orange-700 transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-upload mr-2"></i>ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- BOM íŠ¸ë¦¬ êµ¬ì¡° í‘œì‹œ ì„¹ì…˜ -->
                <div id="bom-tree-section" class="bg-white rounded-lg shadow p-6 hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-sitemap text-purple-600 mr-2"></i>
                            BOM íŠ¸ë¦¬ êµ¬ì¡°
                        </h3>
                        <div class="flex flex-wrap gap-2">
                            <!-- ì „ì²´ ì œì–´ ë²„íŠ¼ -->
                            <div class="flex space-x-1">
                                <button onclick="expandAllTreeRows()" class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200">
                                    <i class="fas fa-expand-alt mr-1"></i>ì „ì²´ í¼ì¹˜ê¸°
                                </button>
                                <button onclick="collapseAllTreeRows()" class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded hover:bg-gray-200">
                                    <i class="fas fa-compress-alt mr-1"></i>ì „ì²´ ì ‘ê¸°
                                </button>
                            </div>
                            
                            <!-- ë ˆë²¨ë³„ í¼ì¹˜ê¸° ë²„íŠ¼ -->
                            <div class="flex space-x-1 border-l pl-2">
                                <span class="text-xs text-gray-500 self-center mr-1">ë ˆë²¨ë³„:</span>
                                <button onclick="expandToLevel(0)" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200">L0</button>
                                <button onclick="expandToLevel(1)" class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200">L1</button>
                                <button onclick="expandToLevel(2)" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200">L2</button>
                                <button onclick="expandToLevel(3)" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200">L3</button>
                                <button onclick="expandToLevel(4)" class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded hover:bg-yellow-200">L4</button>
                                <button onclick="expandToLevel(5)" class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded hover:bg-red-200">L5</button>
                            </div>
                            
                            <!-- CSV ë‚´ë³´ë‚´ê¸° -->
                            <div class="border-l pl-2">
                                <button onclick="exportVisibleItems()" class="text-sm bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200">
                                    <i class="fas fa-download mr-1"></i>í˜„ì¬ ë³´ê¸° ë‚´ë³´ë‚´ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- íŠ¸ë¦¬ í†µê³„ ì •ë³´ -->
                    <div id="tree-statistics" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 p-4 bg-gray-50 rounded-lg">
                        <div class="text-center">
                            <div id="total-items" class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-gray-600">ì´ ì•„ì´í…œ</div>
                        </div>
                        <div class="text-center">
                            <div id="visible-items" class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-sm text-gray-600">í‘œì‹œ ì¤‘</div>
                        </div>
                        <div class="text-center">
                            <div id="max-depth" class="text-2xl font-bold text-purple-600">0</div>
                            <div class="text-sm text-gray-600">ìµœëŒ€ ë ˆë²¨</div>
                        </div>
                        <div class="text-center">
                            <div id="parent-items" class="text-2xl font-bold text-orange-600">0</div>
                            <div class="text-sm text-gray-600">ë¶€ëª¨ ì•„ì´í…œ</div>
                        </div>
                    </div>
                    
                    <!-- BOM íŠ¸ë¦¬ í…Œì´ë¸” -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full border border-gray-300 rounded-lg overflow-hidden">
                            <thead class="bg-gray-100">
                                <tr class="text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                    <th class="px-2 py-2 border-r text-xs">Depth</th>
                                    <th class="px-2 py-2 border-r text-xs">Name</th>
                                    <th class="px-2 py-2 border-r text-xs">Number</th>
                                    <th class="px-2 py-2 border-r text-xs">Version</th>
                                    <th class="px-2 py-2 border-r text-xs">FindNumber</th>
                                    <th class="px-2 py-2 border-r text-xs">Quantity</th>
                                    <th class="px-2 py-2 border-r text-xs">Unit</th>
                                    <th class="px-2 py-2 border-r text-xs">Weight</th>
                                    <th class="px-2 py-2 border-r text-xs">Material</th>
                                    <th class="px-2 py-2 text-center text-xs">Drawing</th>
                                </tr>
                            </thead>
                            <tbody id="bom-tree-body" class="bg-white divide-y divide-gray-200">
                                <!-- BOM íŠ¸ë¦¬ í–‰ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ê³ ê¸‰ BOM ë¶„ì„ ì¸í„°í˜ì´ìŠ¤ -->
            <div id="advanced-bom-interface" class="hidden">
                <!-- ì œì–´ íŒ¨ë„ -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-cog text-blue-600 mr-2"></i>
                            AI BOM ë¶„ì„ ì œì–´íŒ¨ë„
                        </h3>
                        <div class="flex flex-wrap items-center gap-2">
                            <button id="btn-upload-bom-advanced" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                <i class="fas fa-upload mr-2"></i>BOM íŒŒì¼ ì—…ë¡œë“œ
                            </button>
                            <button id="btn-run-ai-analysis" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition duration-200 disabled:bg-gray-400" disabled>
                                <i class="fas fa-brain mr-2"></i>AI ë¶„ì„ ì‹¤í–‰
                            </button>
                            
                            <!-- ìŠ¹ì¸ ìš”ì²­ ë²„íŠ¼ -->
                            <button id="btn-submit-approval-request" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 disabled:bg-gray-400" disabled>
                                <i class="fas fa-paper-plane mr-2"></i>ìŠ¹ì¸ ìš”ì²­
                            </button>
                            
                            <!-- ê²°ì¬ë¼ì¸ ìƒíƒœ ì§„í–‰ì°½ -->
                            <div id="approval-progress-container" class="hidden bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg p-4 mt-3">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-semibold text-gray-700">ê²°ì¬ë¼ì¸ ì§„í–‰ ìƒí™©</h4>
                                    <div class="text-xs text-gray-500" id="approval-progress-time">
                                        ì§„í–‰ ì‹œê°„: 0ì´ˆ
                                    </div>
                                </div>
                                
                                <!-- ì§„í–‰ ë‹¨ê³„ -->
                                <div class="space-y-3">
                                    <!-- 1ë‹¨ê³„: ìƒì‚°ê¸°ìˆ ì -->
                                    <div class="flex items-center space-x-3" id="approval-step-1">
                                        <div class="flex-shrink-0">
                                            <div class="approval-step-icon w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center">
                                                <i class="fas fa-clock text-gray-500 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-700">ìƒì‚°ê¸°ìˆ ì</p>
                                                    <p class="text-xs text-gray-500">ê¹€ì„¤ê³„ (Production Engineer)</p>
                                                </div>
                                                <div class="approval-step-status text-xs text-gray-400">
                                                    ëŒ€ê¸°ì¤‘...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 2ë‹¨ê³„: SCMíŒ€ì¥ -->
                                    <div class="flex items-center space-x-3" id="approval-step-2">
                                        <div class="flex-shrink-0">
                                            <div class="approval-step-icon w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center">
                                                <i class="fas fa-clock text-gray-500 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-700">SCMíŒ€ì¥</p>
                                                    <p class="text-xs text-gray-500">ì´íŒ€ì¥ (SCM Team Leader)</p>
                                                </div>
                                                <div class="approval-step-status text-xs text-gray-400">
                                                    ëŒ€ê¸°ì¤‘...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 3ë‹¨ê³„: CEO -->
                                    <div class="flex items-center space-x-3" id="approval-step-3">
                                        <div class="flex-shrink-0">
                                            <div class="approval-step-icon w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center">
                                                <i class="fas fa-clock text-gray-500 text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-700">CEO (ìµœì¢…ìŠ¹ì¸)</p>
                                                    <p class="text-xs text-gray-500">ë°•ëŒ€í‘œ (Division Manager)</p>
                                                </div>
                                                <div class="approval-step-status text-xs text-gray-400">
                                                    ëŒ€ê¸°ì¤‘...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ì „ì²´ ì§„í–‰ë¥  ë°” -->
                                <div class="mt-4">
                                    <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                        <span>ì „ì²´ ì§„í–‰ë¥ </span>
                                        <span id="approval-overall-progress">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div id="approval-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    
                    <!-- ë¶„ì„ ìƒíƒœ -->
                    <div id="analysis-status" class="mb-4 p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">ë¶„ì„ ìƒíƒœ:</span>
                            <span id="analysis-status-text" class="text-sm font-medium text-gray-500">ëŒ€ê¸° ì¤‘</span>
                        </div>
                        <div class="mt-2 bg-gray-200 rounded-full h-2">
                            <div id="analysis-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- AI ë¶„ì„ ìš”ì•½ -->
                    <div id="ai-analysis-summary" class="hidden">
                        <h4 class="font-medium text-gray-800 mb-3">AI ë¶„ì„ ê²°ê³¼ ìš”ì•½</h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="bg-blue-50 p-3 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-600" id="total-items-count">0</div>
                                <div class="text-sm text-gray-600">ì´ BOM ì•„ì´í…œ</div>
                            </div>
                            <div class="bg-green-50 p-3 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-600" id="classified-items-count">0</div>
                                <div class="text-sm text-gray-600">ìë™ ë¶„ë¥˜</div>
                            </div>
                            <div class="bg-yellow-50 p-3 rounded-lg text-center">
                                <div class="text-2xl font-bold text-yellow-600" id="manual-review-count">0</div>
                                <div class="text-sm text-gray-600">ìˆ˜ë™ ê²€í†  í•„ìš”</div>
                            </div>
                            <div class="bg-purple-50 p-3 rounded-lg text-center">
                                <div class="text-2xl font-bold text-purple-600" id="material-packages-count">0</div>
                                <div class="text-sm text-gray-600">ìì¬ íŠ¹ì„±ë³„ íŒ¨í‚¤ì§€</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ë¶„í•  í™”ë©´ ì‘ì—… ê³µê°„ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- ì™¼ìª½: ì›ë³¸ BOM êµ¬ì¡° (ì½ê¸° ì „ìš©) -->
                    <div class="bg-white rounded-lg shadow-lg">
                        <div class="bg-gray-50 px-6 py-4 rounded-t-lg border-b">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                        <i class="fas fa-sitemap text-gray-600 mr-2"></i>
                                        ì „ì²˜ë¦¬ëœ BOM íŠ¸ë¦¬ êµ¬ì¡°
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">ê³„ì¸µì  êµ¬ì¡°ë¡œ ì •ë¦¬ëœ BOM (PDF ë„ë©´ ë§í¬ í¬í•¨)</p>
                                </div>
                                <button id="btn-toggle-original-excel" class="flex items-center space-x-2 bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                    <i class="fas fa-table mr-1"></i>
                                    <span>ì›ë³¸ ì—‘ì…€ ë³´ê¸°</span>
                                    <i id="excel-toggle-icon" class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- ì›ë³¸ ì—‘ì…€ ë“œë¡­ë‹¤ìš´ ì˜ì—­ -->
                        <div id="original-excel-dropdown" class="bg-yellow-50 border-b hidden">
                            <div class="px-6 py-3 border-b bg-yellow-100">
                                <h4 class="font-medium text-yellow-800 flex items-center">
                                    <i class="fas fa-file-excel text-yellow-600 mr-2"></i>
                                    ì—…ë¡œë“œëœ ì›ë³¸ ì—‘ì…€ BOM ë°ì´í„°
                                    <span id="original-row-count" class="ml-2 text-xs bg-yellow-200 px-2 py-1 rounded"></span>
                                </h4>
                            </div>
                            <div id="original-excel-table-container" class="p-4 max-h-96 overflow-auto custom-scrollbar">
                                <div id="original-excel-empty" class="text-center py-8 text-yellow-600">
                                    <i class="fas fa-table text-3xl mb-2"></i>
                                    <p>BOM íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ì›ë³¸ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì „ì²˜ë¦¬ëœ BOM íŠ¸ë¦¬ êµ¬ì¡° -->
                        <div id="processed-bom-container" class="p-6 max-h-screen overflow-y-auto custom-scrollbar">
                            <div id="processed-bom-empty" class="text-center py-12 text-gray-500">
                                <i class="fas fa-project-diagram text-4xl mb-3"></i>
                                <p>BOM íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ íŠ¸ë¦¬ êµ¬ì¡°ë¡œ ì •ë¦¬ëœ BOMì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                                <p class="text-xs mt-2">Depth/Level ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê³„ì¸µì ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì˜¤ë¥¸ìª½: ë¶„ë¥˜ íŒ¨í‚¤ì§€ë“¤ (í¸ì§‘ ê°€ëŠ¥) -->
                    <div class="bg-white rounded-lg shadow-lg">
                        <div class="bg-blue-50 px-6 py-4 rounded-t-lg border-b">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                        <i class="fas fa-boxes text-blue-600 mr-2"></i>
                                        ìë™ ë¶„ë¥˜ íŒ¨í‚¤ì§€ (ë“œë˜ê·¸ & ë“œë¡­)
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">AI ë¶„ë¥˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ìˆ˜ë™ìœ¼ë¡œ ì¡°ì •í•˜ì„¸ìš”</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button id="btn-toggle-module-packages" class="bg-purple-600 text-white px-3 py-1 rounded text-xs hover:bg-purple-700">
                                        ëª¨ë“ˆ íŒ¨í‚¤ì§€
                                    </button>
                                    <button id="btn-toggle-llt-packages" class="bg-orange-600 text-white px-3 py-1 rounded text-xs hover:bg-orange-700">
                                        Long Lead Time
                                    </button>
                                    <button id="btn-toggle-supplier-packages" class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700">
                                        ìì¬íŠ¹ì„±ë³„
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- íŠ¹ë³„ ë¶„ë¥˜ íŒ¨í‚¤ì§€ë“¤ -->
                        <div id="special-packages-container" class="p-6 max-h-screen overflow-y-auto custom-scrollbar">
                            
                            <!-- ëª¨ë“ˆ ë‹¨ìœ„ ì¡°ë¦½í’ˆ íŒ¨í‚¤ì§€ -->
                            <div id="module-packages-section" class="mb-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-purple-800 flex items-center">
                                        <i class="fas fa-puzzle-piece text-purple-600 mr-2"></i>
                                        ëª¨ë“ˆ ë‹¨ìœ„ ì¡°ë¦½í’ˆ íŒ¨í‚¤ì§€
                                        <span id="module-count-badge" class="ml-2 bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">0ê°œ</span>
                                    </h4>
                                </div>
                                <div id="module-packages-container">
                                    <div id="module-packages-empty" class="text-center py-8 text-gray-500 border-2 border-dashed border-gray-200 rounded-lg">
                                        <i class="fas fa-cubes text-3xl mb-2"></i>
                                        <p>ë ˆë²¨ 2 í•˜ìœ„ í•­ëª©ë“¤ì´ ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Long Lead Time íŒ¨í‚¤ì§€ -->
                            <div id="llt-packages-section" class="mb-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-orange-800 flex items-center">
                                        <i class="fas fa-clock text-orange-600 mr-2"></i>
                                        Long Lead Time ì•„ì´í…œ íŒ¨í‚¤ì§€
                                        <span id="llt-count-badge" class="ml-2 bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">0ê°œ</span>
                                    </h4>
                                </div>
                                <div id="llt-packages-container">
                                    <div id="llt-packages-empty" class="text-center py-8 text-gray-500 border-2 border-dashed border-gray-200 rounded-lg">
                                        <i class="fas fa-hourglass-half text-3xl mb-2"></i>
                                        <p>ì œì‘ ê¸°ê°„ì´ ê¸´ ê°•íŒ, í”Œëœì§€ë¥˜ê°€ ë¶„ë¥˜ë©ë‹ˆë‹¤</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ìì¬ íŠ¹ì„±ë³„ íŒ¨í‚¤ì§€ -->
                            <div id="material-packages-section">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-semibold text-blue-800 flex items-center">
                                        <i class="fas fa-truck text-blue-600 mr-2"></i>
                                        ìì¬ íŠ¹ì„±ë³„ ë¶„ë¥˜ íŒ¨í‚¤ì§€
                                        <span id="supplier-count-badge" class="ml-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">0ê°œ</span>
                                    </h4>
                                </div>
                                <div id="supplier-packages-container">
                                    <div id="supplier-packages-empty" class="text-center py-8 text-gray-500 border-2 border-dashed border-gray-200 rounded-lg">
                                        <i class="fas fa-robot text-3xl mb-2"></i>
                                        <p>AI ë¶„ì„ì„ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ìì¬ íŠ¹ì„±ë³„ íŒ¨í‚¤ì§€ê°€ ìƒì„±ë©ë‹ˆë‹¤</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI ë¶„ë¥˜ ê²€í†  íŒ¨ë„ -->
                <div id="ai-review-panel" class="hidden mt-6 bg-white rounded-lg shadow-lg">
                    <div class="bg-yellow-50 px-6 py-4 rounded-t-lg border-b">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                            AI ë¶„ë¥˜ ê²€í†  ë° ìˆ˜ì • í•„ìš” í•­ëª©
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">ë‚®ì€ ì‹ ë¢°ë„ë¡œ ë¶„ë¥˜ëœ í•­ëª©ë“¤ì„ ê²€í† í•˜ì„¸ìš”</p>
                    </div>
                    <div id="ai-review-items" class="p-6">
                        <!-- ê²€í† ê°€ í•„ìš”í•œ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
            
            <!-- íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
            <input type="file" id="bom-file-input-advanced" accept=".csv,.xlsx,.xls" class="hidden" />
            

        </div>

        <!-- ì„œí”Œë¼ì´ì–´ íƒ­ -->
        <div id="tab-suppliers" class="tab-content hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">ìì¬ íŠ¹ì„±ë³„ íŒ¨í‚¤ì§€ ê´€ë¦¬</h2>
                <div class="flex space-x-3">
                    <button id="btn-show-received-packages" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                        <i class="fas fa-inbox mr-2"></i>ìˆ˜ì‹  íŒ¨í‚¤ì§€ (<span id="received-packages-count">0</span>)
                    </button>
                    <button id="btn-show-supplier-list" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        <i class="fas fa-truck mr-2"></i>ì„œí”Œë¼ì´ì–´ ëª©ë¡
                    </button>
                </div>
            </div>

            <!-- ìˆ˜ì‹ ëœ íŒ¨í‚¤ì§€ ê´€ë¦¬ -->
            <div id="received-packages-section" class="mb-8">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-package-open text-green-600 mr-2"></i>
                        ìì¬ íŠ¹ì„±ë³„ ë¶„ë¥˜ íŒ¨í‚¤ì§€
                    </h3>
                    
                    <!-- íŒ¨í‚¤ì§€ ìƒíƒœ ëŒ€ì‹œë³´ë“œ -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-blue-600">ìˆ˜ì‹ ëœ íŒ¨í‚¤ì§€</p>
                                    <p class="text-2xl font-bold text-blue-800" id="total-received-packages">0</p>
                                </div>
                                <i class="fas fa-inbox text-blue-500 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-green-600">ì²˜ë¦¬ ì™„ë£Œ</p>
                                    <p class="text-2xl font-bold text-green-800" id="processed-packages">0</p>
                                </div>
                                <i class="fas fa-check-circle text-green-500 text-2xl"></i>
                            </div>
                        </div>
                        
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-orange-600">ëŒ€ê¸° ì¤‘</p>
                                    <p class="text-2xl font-bold text-orange-800" id="pending-packages">0</p>
                                </div>
                                <i class="fas fa-clock text-orange-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div id="received-packages-container">
                        <div id="received-packages-empty" class="text-center py-12 text-gray-500">
                            <i class="fas fa-inbox text-4xl mb-3"></i>
                            <p class="text-lg font-medium mb-2">ìˆ˜ì‹ ëœ íŒ¨í‚¤ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            <p>BOM ë¶„ì„ì—ì„œ ê²°ì¬ ì™„ë£Œëœ íŒ¨í‚¤ì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                            <div class="mt-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800">
                                    <i class="fas fa-lightbulb mr-1"></i>
                                    BOM ë¶„ì„ â†’ AI ë¶„ì„ â†’ ìŠ¹ì¸ â†’ íŒ¨í‚¤ì§€ ë‚´ë³´ë‚´ê¸° ìˆœìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- íŒ¨í‚¤ì§€ ìƒì„¸ ì •ë³´ í† ê¸€ ì˜ì—­ -->
                    <div id="package-detail-toggle" class="mt-6 hidden">
                        <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800" id="toggle-package-title">íŒ¨í‚¤ì§€ ìƒì„¸ ì •ë³´</h3>
                                        <p class="text-sm text-gray-600 mt-1">
                                            ê²°ì¬ì: <span id="toggle-package-requester"></span> | 
                                            ìˆ˜ì‹ ì¼: <span id="toggle-package-date"></span>
                                        </p>
                                    </div>
                                    <button onclick="closePackageDetail()" class="text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-times text-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="p-6">
                                <div id="toggle-package-bom-tree" class="max-h-96 overflow-y-auto"></div>
                                
                                <!-- íŒ¨í‚¤ì§€ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                                <div class="mt-6 pt-4 border-t border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <div class="text-sm text-gray-600">
                                            <span id="selected-suppliers-count">0</span>ê°œ ì•„ì´í…œì˜ ì„œí”Œë¼ì´ì–´ ì„ ì • ì™„ë£Œ
                                        </div>
                                        <div class="flex space-x-3">
                                            <button onclick="submitForApproval()" 
                                                    id="submit-approval-btn"
                                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                                                <i class="fas fa-paper-plane mr-2"></i>ê²°ì¬ ìš”ì²­
                                            </button>
                                            <button onclick="saveSupplierSelections()" 
                                                    class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 text-sm font-medium transition-colors">
                                                <i class="fas fa-save mr-2"></i>ì„ì‹œ ì €ì¥
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- ê²°ì¬ ìƒíƒœ í‘œì‹œ -->
                                    <div id="approval-status-section" class="mt-4 hidden">
                                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <h5 class="font-medium text-blue-800 mb-2 flex items-center">
                                                <i class="fas fa-route mr-2"></i>ê²°ì¬ ì§„í–‰ ìƒí™©
                                            </h5>
                                            <div id="approval-progress" class="space-y-2">
                                                <!-- ê²°ì¬ ë‹¨ê³„ë³„ ìƒíƒœ ë™ì  í‘œì‹œ -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì„œí”Œë¼ì´ì–´ ëª©ë¡ ê´€ë¦¬ -->
            <div id="supplier-list-section" class="hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-building text-blue-600 mr-2"></i>
                        ë“±ë¡ëœ ì„œí”Œë¼ì´ì–´ ëª©ë¡
                    </h3>
                    
                    <div id="supplier-list-container">
                        <!-- ì„œí”Œë¼ì´ì–´ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- PO ê´€ë¦¬ íƒ­ -->
        <div id="tab-mto" class="tab-content hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                <i class="fas fa-file-contract text-purple-600 mr-2"></i>
                PO ê´€ë¦¬ ë° ë‚©ê¸°ì¼ í˜‘ì˜
            </h2>
            
            <!-- ê²°ì¬ ì™„ë£Œ MTO ëŒ€ì‹œë³´ë“œ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-purple-600">ê²°ì¬ ì™„ë£Œ</p>
                            <p class="text-2xl font-bold text-purple-800" id="approved-mto-count">0</p>
                        </div>
                        <i class="fas fa-check-circle text-purple-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-blue-600">í˜‘ì˜ ì¤‘</p>
                            <p class="text-2xl font-bold text-blue-800" id="negotiating-po-count">0</p>
                        </div>
                        <i class="fas fa-handshake text-blue-500 text-2xl"></i>
                    </div>
                </div>
                
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-green-600">PO í™•ì •</p>
                            <p class="text-2xl font-bold text-green-800" id="confirmed-po-count">0</p>
                        </div>
                        <i class="fas fa-file-contract text-green-500 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- ê²°ì¬ ì™„ë£Œ MTO ëª©ë¡ -->
            <div id="approved-mto-container">
                <div id="approved-mto-empty" class="text-center py-12 text-gray-500">
                    <i class="fas fa-clipboard-list text-4xl mb-3"></i>
                    <p class="text-lg font-medium mb-2">ê²°ì¬ ì™„ë£Œëœ MTOê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    <p>ì„œí”Œë¼ì´ì–´ íƒ­ì—ì„œ ì—…ì²´ ì„ ì • ë° ê²°ì¬ê°€ ì™„ë£Œë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                    <div class="mt-4">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-800">
                            <i class="fas fa-route mr-1"></i>
                            ì„œí”Œë¼ì´ì–´ ì„ ì • â†’ ê²°ì¬ ìŠ¹ì¸ â†’ PO ê´€ë¦¬ ìˆœìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- MTO ìƒì„¸ í† ê¸€ ì˜ì—­ -->
            <div id="mto-detail-toggle" class="mt-6 hidden">
                <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
                    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800" id="toggle-mto-title">MTO ìƒì„¸ ì •ë³´</h3>
                                <p class="text-sm text-gray-600 mt-1">
                                    íŒ¨í‚¤ì§€: <span id="toggle-mto-package"></span> | 
                                    ê²°ì¬ ì™„ë£Œì¼: <span id="toggle-mto-date"></span>
                                </p>
                            </div>
                            <button onclick="closeMTODetail()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-lg"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <!-- ë‚©ê¸°ì¼ í˜‘ì˜ ì„¹ì…˜ -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 mb-3">
                                    <i class="fas fa-calendar-alt mr-2"></i>ğŸ”· í¬ë§ ë‚©ê¸°ì¼ í˜‘ì˜
                                </h4>
                                <div class="text-xs text-blue-700 mb-3">
                                    <i class="fas fa-info-circle mr-1"></i>ì „ì²´ MTO íŒ¨í‚¤ì§€ì— ëŒ€í•œ í¬ë§ ë‚©ê¸°ì¼ ì„¤ì •
                                </div>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">í¬ë§ ë‚©ê¸°ì¼</label>
                                        <input type="date" id="desired-delivery-date" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">ì„œí”Œë¼ì´ì–´ ì œì•ˆì¼</label>
                                        <input type="date" id="supplier-proposed-date" class="w-full px-3 py-2 border border-gray-300 rounded-md" readonly>
                                    </div>
                                    <button onclick="requestDeliveryNegotiation()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-paper-plane mr-2"></i>í˜‘ì˜ ìš”ì²­
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">
                                    <i class="fas fa-info-circle mr-2"></i>MTO ìš”ì•½
                                </h4>
                                <div id="mto-summary" class="space-y-2 text-sm">
                                    <!-- MTO ìš”ì•½ ì •ë³´ ë™ì  í‘œì‹œ -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì•„ì´í…œë³„ ë‚©ê¸° í˜‘ì˜ ëª©ë¡ -->
                        <div id="toggle-mto-items" class="space-y-4">
                            <!-- MTO ì•„ì´í…œ ëª©ë¡ ë™ì  í‘œì‹œ -->
                        </div>
                        
                        <!-- í˜‘ì˜ ì´ë ¥ -->
                        <div id="delivery-negotiation-history" class="mt-6 hidden">
                            <h4 class="font-semibold text-gray-800 mb-3">
                                <i class="fas fa-history mr-2"></i>í˜‘ì˜ ì´ë ¥
                            </h4>
                            <div id="negotiation-history-list" class="space-y-2">
                                <!-- í˜‘ì˜ ì´ë ¥ ë™ì  í‘œì‹œ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <div id="loading-spinner" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg flex items-center space-x-3">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <span class="text-gray-700">ì²˜ë¦¬ ì¤‘...</span>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2">
    </div>

    <!-- ê²°ì¬ë¼ì¸ ì§„í–‰ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ -->
    <style>
        /* ê²°ì¬ë¼ì¸ ìƒíƒœ ì§„í–‰ ì• ë‹ˆë©”ì´ì…˜ */
        .approval-step-icon {
            transition: all 0.3s ease-in-out;
        }
        
        .approval-step-pending .approval-step-icon {
            background-color: #f3f4f6;
            border: 2px solid #d1d5db;
        }
        
        .approval-step-in-progress .approval-step-icon {
            background-color: #3b82f6;
            border: 2px solid #1d4ed8;
            animation: pulse 2s infinite;
        }
        
        .approval-step-completed .approval-step-icon {
            background-color: #10b981;
            border: 2px solid #059669;
        }
        
        .approval-step-in-progress .approval-step-status {
            color: #3b82f6;
            font-weight: 500;
        }
        
        .approval-step-completed .approval-step-status {
            color: #10b981;
            font-weight: 500;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
        }
        
        /* ì§„í–‰ë¥  ë°” ì• ë‹ˆë©”ì´ì…˜ */
        #approval-progress-bar {
            transition: width 0.8s ease-in-out;
        }
        
        /* ìŠ¹ì¸ ì™„ë£Œ íš¨ê³¼ */
        .approval-completed-effect {
            animation: completedGlow 0.5s ease-in-out;
        }
        
        @keyframes completedGlow {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        /* íŒ¨í‚¤ì§€ ìƒì„¸ë³´ê¸° í† ê¸€ ì• ë‹ˆë©”ì´ì…˜ */
        .package-details {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .package-details.hidden {
            max-height: 0;
        }
        
        /* íŒ¨í‚¤ì§€ ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ ê°•í™” */
        .package-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* ìƒì„¸ë³´ê¸° ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
        .detail-toggle-btn {
            transition: all 0.2s ease-in-out;
        }
        
        .detail-toggle-btn:hover {
            transform: translateY(-1px);
        }
        
        /* BOM íŠ¸ë¦¬ êµ¬ì¡° ìŠ¤íƒ€ì¼ */
        .bom-tree-row {
            transition: all 0.2s ease-in-out;
        }
        
        .bom-tree-row.hidden-tree-row {
            display: none;
        }
        
        .tree-name-cell {
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }
        
        .tree-name-cell:hover {
            background-color: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
        }
        
        .tree-toggle-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            margin-right: 4px;
            font-size: 12px;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.15s ease, transform 0.15s ease;
        }
        
        .tree-toggle-icon:hover {
            color: #3b82f6;
            transform: scale(1.1);
        }
        
        .name-text {
            user-select: text;
        }
        
        /* ê³„ì¸µë³„ ë°°ê²½ìƒ‰ (Depth 0ë¶€í„° ì‹œì‘) */
        .depth-0 {
            background-color: #ffffff;
        }
        
        .depth-1 {
            background-color: #eff6ff;
        }
        
        .depth-2 {
            background-color: #e0e7ff;
        }
        
        .depth-3 {
            background-color: #fdf4ff;
        }
        
        .depth-4 {
            background-color: #fef7f0;
        }
        
        .depth-5 {
            background-color: #f0fdf4;
        }
        
        /* í˜¸ë²„ íš¨ê³¼ */
        .bom-tree-row:hover {
            background-color: rgba(59, 130, 246, 0.05) !important;
        }
        
        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .drag-drop-area {
            transition: all 0.2s ease;
        }
        
        .drag-drop-area.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>

    <!-- PDF ë·°ì–´ ëª¨ë‹¬ -->
    <div id="pdf-modal" class="pdf-modal">
        <div id="pdf-modal-window" class="bg-white rounded-lg shadow-2xl absolute" 
             style="top: 5%; left: 5%; width: 90vw; height: 90vh; min-width: 600px; min-height: 400px; resize: both; overflow: hidden;">
            <div id="pdf-modal-header-drag" class="bg-gray-800 text-white px-4 py-3 cursor-move flex justify-between items-center">
                <h3 id="pdf-modal-title" class="text-lg font-semibold">ë„ë©´ ë·°ì–´</h3>
                <button onclick="closePDFModal()" class="text-white hover:text-gray-300 text-2xl leading-none">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="pdf-modal-body" class="w-full h-[calc(100%-52px)] overflow-auto bg-gray-100">
                <div class="flex items-center justify-center h-full">
                    <div class="text-center py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">PDF ë„ë©´ì„ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‹œìŠ¤í…œ ë“±ë¡ í™•ì¸ ëª¨ë‹¬ -->
    <div id="system-registration-modal" class="pdf-modal">
        <div class="pdf-modal-content" style="max-width: 600px; max-height: 80vh;">
            <button class="pdf-modal-close" onclick="closeSystemRegistrationModal()">&times;</button>
            <div class="pdf-modal-header">
                <h3 id="system-modal-title">ì‹œìŠ¤í…œ ë“±ë¡ í™•ì¸</h3>
            </div>
            <div id="system-modal-body" class="space-y-4">
                <!-- ì‹œìŠ¤í…œ ë“±ë¡ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div class="flex justify-end space-x-3 mt-6 pt-4 border-t">
                <button onclick="closeSystemRegistrationModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition">
                    ì•„ë‹ˆì˜¤
                </button>
                <button id="confirm-system-registration" onclick="confirmSystemRegistration()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                    ì˜ˆ, ë“±ë¡í•©ë‹ˆë‹¤
                </button>
            </div>
        </div>
    </div>

    <!-- PO ê´€ë¦¬ ëª¨ë‹¬ (ë¹„í™œì„±í™”ë¨ - í† ê¸€ ë°©ì‹ìœ¼ë¡œ ë³€ê²½) -->
    <div id="po-management-modal" class="pdf-modal hidden">
        <div class="pdf-modal-content max-w-6xl">
            <button class="pdf-modal-close" onclick="closePOModal()">&times;</button>
            <div class="pdf-modal-header">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-file-contract text-purple-600 mr-3"></i>
                    PO ê´€ë¦¬ ë° ì…ê³  ì˜ˆì •ì¼ í˜‘ì˜
                </h3>
            </div>
            <div id="po-modal-body" class="space-y-6">
                
                <!-- PO ê¸°ë³¸ ì •ë³´ -->
                <div class="grid grid-cols-2 gap-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">PO ê¸°ë³¸ ì •ë³´</h4>
                        <div class="space-y-3 text-sm">
                            <div><strong>íŒ¨í‚¤ì§€ ë²ˆí˜¸:</strong> <span id="po-package-number"></span></div>
                            <div><strong>PO ë²ˆí˜¸:</strong> <span id="po-number">PO-2025-001</span></div>
                            <div><strong>ë°œí–‰ì¼:</strong> <span id="po-issue-date"></span></div>
                            <div><strong>ë‹´ë‹¹ì:</strong> ë°•ì˜í¬ (SCM Team Leader)</div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-3">ì…ê³  ì˜ˆì •ì¼ í˜‘ì˜</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">í¬ë§ ì…ê³ ì¼</label>
                                <input type="date" id="po-desired-date" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ì„œí”Œë¼ì´ì–´ ì œì•ˆì¼</label>
                                <input type="date" id="po-supplier-date" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- íŒ¨í‚¤ì§€ ì•„ì´í…œ ëª©ë¡ -->
                <div class="bg-white border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-4">ì£¼ë¬¸ ì•„ì´í…œ ëª©ë¡</h4>
                    <div id="po-items-list" class="max-h-64 overflow-y-auto">
                        <!-- PO ì•„ì´í…œ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- ì„œí”Œë¼ì´ì–´ ì‘ë‹µ ì„¹ì…˜ -->
                <div id="po-supplier-response" class="bg-green-50 border border-green-200 rounded-lg p-4 hidden">
                    <h4 class="font-semibold text-green-800 mb-2">ì„œí”Œë¼ì´ì–´ ì‘ë‹µ</h4>
                    <p class="text-sm text-green-700 mb-3">ì„œí”Œë¼ì´ì–´ê°€ ë‚©ê¸°ì¼ì„ ì œì•ˆí–ˆìŠµë‹ˆë‹¤. ìŠ¹ì¸í•˜ê±°ë‚˜ ì¬í˜‘ì˜í•´ì£¼ì„¸ìš”.</p>
                    <!-- í˜‘ì˜ ë²„íŠ¼ë“¤ì´ JavaScriptë¡œ ë™ì  ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>

                <!-- í˜‘ì˜ ì´ë ¥ -->
                <div id="po-negotiation-history" class="hidden">
                    <!-- í˜‘ì˜ ì´ë ¥ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <!-- í˜‘ì˜ ê²°ì¬ ë¼ì¸ -->
                <div class="bg-white border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-4">ì…ê³ ì¼ í˜‘ì˜ ê²°ì¬</h4>
                    <div class="flex items-center justify-between">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-2">
                                <i class="fas fa-user text-blue-600"></i>
                            </div>
                            <div class="text-xs font-medium">SCM ë‹´ë‹¹ì</div>
                            <div class="text-xs text-gray-500">ë°•ì˜í¬</div>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs mt-1 inline-block">ê²€í† ì™„ë£Œ</span>
                        </div>
                        
                        <div class="flex-1 h-px bg-gray-300 mx-4"></div>
                        
                        <div class="text-center">
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-2">
                                <i class="fas fa-truck text-orange-600"></i>
                            </div>
                            <div class="text-xs font-medium">ì„œí”Œë¼ì´ì–´</div>
                            <div class="text-xs text-gray-500">í˜‘ì˜ ì¤‘</div>
                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs mt-1 inline-block">ì‘ë‹µëŒ€ê¸°</span>
                        </div>
                        
                        <div class="flex-1 h-px bg-gray-300 mx-4"></div>
                        
                        <div class="text-center">
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-2">
                                <i class="fas fa-handshake text-purple-600"></i>
                            </div>
                            <div class="text-xs font-medium">ìµœì¢… í™•ì •</div>
                            <div class="text-xs text-gray-500">ì–‘ì¸¡ í•©ì˜</div>
                            <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs mt-1 inline-block">ëŒ€ê¸°</span>
                        </div>
                    </div>
                </div>

                <!-- LOT ë²ˆí˜¸ ë° QR ì½”ë“œ ê´€ë¦¬ -->
                <div class="bg-white border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-qrcode text-green-600 mr-2"></i>
                        LOT ë²ˆí˜¸ ë° QR ì½”ë“œ ê´€ë¦¬
                    </h4>
                    <div id="lot-management-section" class="space-y-4">
                        <!-- LOT ê´€ë¦¬ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        <div class="text-center py-8 text-gray-500 border-2 border-dashed border-gray-200 rounded-lg">
                            <i class="fas fa-barcode text-3xl mb-2"></i>
                            <p>PO í™•ì • í›„ ì„œí”Œë¼ì´ì–´ê°€ LOT ë²ˆí˜¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>

                <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button onclick="closePOModal()" 
                            class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        ë‹«ê¸°
                    </button>
                    <button id="btn-send-po-supplier" 
                            class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                        <i class="fas fa-paper-plane mr-2"></i>ì„œí”Œë¼ì´ì–´ ì „ì†¡
                    </button>
                    <button id="btn-finalize-po" 
                            class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                        <i class="fas fa-check mr-2"></i>PO í™•ì •
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ê²°ì¬ ë¼ì¸ ëª¨ë‹¬ -->
    <div id="approval-modal" class="pdf-modal">
        <div class="pdf-modal-content max-w-4xl">
            <button class="pdf-modal-close" onclick="closeApprovalModal()">&times;</button>
            <div class="pdf-modal-header">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-clipboard-check text-blue-600 mr-3"></i>
                    íŒ¨í‚¤ì§€ ìŠ¹ì¸ í™•ì¸
                </h3>
                <p class="text-sm text-gray-600 mt-2">ë¶„ì„ëœ íŒ¨í‚¤ì§€ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ì„œí”Œë¼ì´ì–´ì—ê²Œ ì „ì†¡í•˜ì„¸ìš”.</p>
            </div>
            <div id="approval-modal-body" class="space-y-6">
                
                <!-- íŒ¨í‚¤ì§€ ì •ë³´ -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-3">íŒ¨í‚¤ì§€ ì •ë³´</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>íŒ¨í‚¤ì§€ ìˆ˜:</strong> <span id="approval-package-count">0</span>ê°œ</div>
                        <div><strong>ì´ ì•„ì´í…œ:</strong> <span id="approval-total-items">0</span>ê°œ</div>
                        <div><strong>ì‘ì„±ì:</strong> ê¹€ì² ìˆ˜ (Production Engineer)</div>
                        <div><strong>ì‘ì„±ì¼ì‹œ:</strong> <span id="approval-created-date"></span></div>
                    </div>
                </div>

                <!-- ìŠ¹ì¸ ìƒíƒœ -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        ìŠ¹ì¸ ì¤€ë¹„ ì™„ë£Œ
                    </h4>
                    <div class="text-sm text-green-700">
                        <p class="mb-2">âœ… BOM ë¶„ì„ ì™„ë£Œ ë° íŒ¨í‚¤ì§€ ë¶„ë¥˜ ì™„ë£Œ</p>
                        <p class="mb-2">âœ… 3ë‹¨ê³„ ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ í†µê³¼ (Engineer â†’ Team Leader â†’ Division Leader)</p>
                        <p>âœ… ì„œí”Œë¼ì´ì–´ ì „ì†¡ ì¤€ë¹„ ì™„ë£Œ</p>
                    </div>

                </div>

                <!-- íŒ¨í‚¤ì§€ ëª©ë¡ -->
                <div class="bg-white border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-4">ê²°ì¬ ëŒ€ìƒ íŒ¨í‚¤ì§€</h4>
                    <div id="approval-packages-list" class="space-y-3 max-h-64 overflow-y-auto">
                        <!-- íŒ¨í‚¤ì§€ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- ìŠ¹ì¸ ì˜ê²¬ -->
                <div class="bg-white border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-3">ìŠ¹ì¸ ì˜ê²¬ (ì„ íƒì‚¬í•­)</h4>
                    <textarea id="approval-comment" 
                              class="w-full p-3 border border-gray-300 rounded-lg resize-none" 
                              rows="3" 
                              placeholder="ìŠ¹ì¸ ê´€ë ¨ ì˜ê²¬ì´ë‚˜ íŠ¹ì´ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>

                <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button onclick="closeApprovalModal()" 
                            class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        ì·¨ì†Œ
                    </button>
                    <button id="btn-submit-approval" 
                            class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        <i class="fas fa-check-circle mr-2"></i>ìŠ¹ì¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- íŒ¨í‚¤ì§€ ë‚´ë³´ë‚´ê¸° í™•ì¸ íŒì—… -->
    <div id="export-confirmation-modal" class="pdf-modal">
        <div class="pdf-modal-content" style="max-width: 500px;">
            <button class="pdf-modal-close" onclick="closeExportConfirmationModal()">&times;</button>
            <div class="text-center p-6">
                <div class="mb-4">
                    <i class="fas fa-question-circle text-6xl text-orange-500 mb-4"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-3">POR (êµ¬ë§¤ìš”ì²­ì„œ) ì „ì†¡ í™•ì¸</h3>
                <p class="text-gray-600 mb-6">
                    BOM ê²€í† ê°€ ì™„ë£Œëœ ìì¬ ëª©ë¡ìœ¼ë¡œ PORì„ ìƒì„±í•˜ì—¬ SCMíŒ€ì— ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                    ì „ì†¡ í›„ì—ëŠ” ì„œí”Œë¼ì´ì–´ íƒ­ì—ì„œ êµ¬ë§¤ í”„ë¡œì„¸ìŠ¤ê°€ ì§„í–‰ë©ë‹ˆë‹¤.
                </p>
                
                <!-- íŒ¨í‚¤ì§€ ì •ë³´ ìš”ì•½ -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
                    <h4 class="font-medium text-gray-800 mb-2">POR ëŒ€ìƒ ìì¬ ëª©ë¡</h4>
                    <div class="text-sm text-gray-600 space-y-1" id="export-package-summary">
                        <!-- íŒ¨í‚¤ì§€ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <div class="flex space-x-3 justify-center">
                    <button onclick="closeExportConfirmationModal()" 
                            class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">
                        ì•„ë‹ˆì˜¤
                    </button>
                    <button onclick="confirmPackageExport()" 
                            class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                        ì˜ˆ, POR ì „ì†¡í•˜ê² ìŠµë‹ˆë‹¤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- JavaScript -->
    <script>
        // ë¬¸ë²• ì˜¤ë¥˜ ë””ë²„ê¹…ì„ ìœ„í•œ window error handler
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error, 'File:', e.filename, 'Line:', e.lineno);
        });
    </script>
    <script src="js/main.js"></script>
    <script src="js/projects.js"></script>
    <script src="js/bom.js"></script>
    <script src="js/bom-advanced.js"></script>
    <script src="js/drawing-integration.js"></script>
    
    <!-- IndexedDB í—¬í¼ í•¨ìˆ˜ë“¤ (PDF íŒŒì¼ ì €ì¥ìš©) -->
    <script>
        // IndexedDB ì´ˆê¸°í™”
        const DB_NAME = 'cswind-mto-db';
        const DB_VERSION = 1;
        const STORE_NAME = 'drawing-files';
        
        let db = null;
        
        // IndexedDB ì—°ê²°
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    console.log('âœ… IndexedDB ì—°ê²° ì„±ê³µ');
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                        objectStore.createIndex('projectId', 'projectId', { unique: false });
                        objectStore.createIndex('bomNumber', 'bomNumber', { unique: false });
                        console.log('âœ… IndexedDB ìŠ¤í† ì–´ ìƒì„± ì™„ë£Œ');
                    }
                };
            });
        }
        
        // PDF íŒŒì¼ ì €ì¥
        function saveDrawingFile(projectId, bomNumber, fileName, file) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    console.error('âŒ IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                    reject(new Error('IndexedDB not initialized'));
                    return;
                }
                
                console.log(`ğŸ’¾ IndexedDB ì €ì¥ ì‹œë„: ${projectId}-${bomNumber} (${fileName})`);
                console.log(`ğŸ“Š íŒŒì¼ ì •ë³´:`, {
                    projectId,
                    bomNumber,
                    fileName,
                    fileSize: file.size,
                    fileType: file.type,
                    isFile: file instanceof File
                });
                
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                
                const data = {
                    id: `${projectId}-${bomNumber}`,
                    projectId: projectId,
                    bomNumber: bomNumber,
                    fileName: fileName,
                    file: file,
                    savedAt: new Date().toISOString()
                };
                
                const request = objectStore.put(data);
                request.onsuccess = () => {
                    console.log(`âœ… IndexedDB ì €ì¥ ì„±ê³µ: ${projectId}-${bomNumber}`);
                    resolve();
                };
                request.onerror = () => {
                    console.error(`âŒ IndexedDB ì €ì¥ ì‹¤íŒ¨: ${projectId}-${bomNumber}`, request.error);
                    reject(request.error);
                };
            });
        }
        
        // PDF íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadDrawingFile(projectId, bomNumber) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error('IndexedDB not initialized'));
                    return;
                }
                
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const objectStore = transaction.objectStore(STORE_NAME);
                
                const request = objectStore.get(`${projectId}-${bomNumber}`);
                request.onsuccess = () => {
                    if (request.result) {
                        resolve(request.result.file);
                    } else {
                        resolve(null);
                    }
                };
                request.onerror = () => reject(request.error);
            });
        }
        
        // í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ë“œë¡œì‰ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadAllDrawingFiles(projectId) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    console.error('âŒ IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    reject(new Error('IndexedDB not initialized'));
                    return;
                }
                
                console.log(`ğŸ” IndexedDB ì¿¼ë¦¬ ì‹œì‘: projectId=${projectId}`);
                
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const objectStore = transaction.objectStore(STORE_NAME);
                const index = objectStore.index('projectId');
                
                const request = index.getAll(projectId);
                request.onsuccess = () => {
                    const results = request.result || [];
                    console.log(`âœ… IndexedDB ì¿¼ë¦¬ ì„±ê³µ: ${results.length}ê°œ íŒŒì¼ ë°œê²¬`);
                    results.forEach(data => {
                        console.log(`  - ${data.bomNumber}: ${data.fileName} (Fileê°ì²´: ${data.file instanceof File})`);
                    });
                    resolve(results);
                };
                request.onerror = () => reject(request.error);
            });
        }
        
        // ğŸ” IndexedDB ì „ì²´ ë°ì´í„° í™•ì¸ (ë””ë²„ê¹…ìš©)
        function debugIndexedDB() {
            if (!db) {
                console.error('âŒ IndexedDBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                return;
            }
            
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const objectStore = transaction.objectStore(STORE_NAME);
            const request = objectStore.getAll();
            
            request.onsuccess = () => {
                const allData = request.result || [];
                console.log('ğŸ” ===== IndexedDB ì „ì²´ ë°ì´í„° =====');
                console.log(`ğŸ“Š ì´ ${allData.length}ê°œ í•­ëª© ì €ì¥ë¨`);
                allData.forEach((data, index) => {
                    console.log(`  ${index + 1}. ${data.id}`);
                    console.log(`     - projectId: ${data.projectId}`);
                    console.log(`     - bomNumber: ${data.bomNumber}`);
                    console.log(`     - fileName: ${data.fileName}`);
                    console.log(`     - file: ${data.file instanceof File ? 'File ê°ì²´ âœ…' : 'âŒ ì—†ìŒ'}`);
                    console.log(`     - savedAt: ${data.savedAt}`);
                });
                console.log('ğŸ” ================================');
            };
            request.onerror = () => {
                console.error('âŒ IndexedDB ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', request.error);
            };
        }
        
        // ì „ì—­ì— ë””ë²„ê¹… í•¨ìˆ˜ ë“±ë¡
        window.debugIndexedDB = debugIndexedDB;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ IndexedDB ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            initIndexedDB().then(() => {
                console.log('âœ… IndexedDB ì´ˆê¸°í™” ì™„ë£Œ - debugIndexedDB() í•¨ìˆ˜ë¡œ ë°ì´í„° í™•ì¸ ê°€ëŠ¥');
            }).catch(err => {
                console.error('âŒ IndexedDB ì´ˆê¸°í™” ì‹¤íŒ¨:', err);
            });
        });
    </script>
    
    <!-- ì¦‰ì‹œ ì‹¤í–‰ íƒ­ ì „í™˜ í•¨ìˆ˜ë“¤ -->
    <script>
        // ì¦‰ì‹œ ì •ì˜ë˜ëŠ” ì „ì—­ íƒ­ ì „í™˜ í•¨ìˆ˜ë“¤
        function activateBOMTab() {
            console.log('ğŸŸ¦ BOM íƒ­ í™œì„±í™” í•¨ìˆ˜ ì‹¤í–‰ë¨!');
            
            const bomTab = document.getElementById('tab-bom-upload');
            const drawingTab = document.getElementById('tab-drawing-upload');
            const bomPanel = document.getElementById('panel-bom-upload');
            const drawingPanel = document.getElementById('panel-drawing-upload');
            
            if (bomTab && drawingTab && bomPanel && drawingPanel) {
                // BOM íƒ­ ìŠ¤íƒ€ì¼ ì ìš©
                bomTab.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm';
                drawingTab.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800';
                
                // íŒ¨ë„ í‘œì‹œ/ìˆ¨ê¹€
                bomPanel.classList.remove('hidden');
                drawingPanel.classList.add('hidden');
                
                console.log('âœ… BOM íƒ­ í™œì„±í™” ì™„ë£Œ');
            } else {
                console.error('âŒ BOM íƒ­ ìš”ì†Œë“¤ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }
        
        function activateDrawingTab() {
            console.log('ğŸŸ§ ë“œë¡œì‰ íƒ­ í™œì„±í™” í•¨ìˆ˜ ì‹¤í–‰ë¨!');
            
            const bomTab = document.getElementById('tab-bom-upload');
            const drawingTab = document.getElementById('tab-drawing-upload');
            const bomPanel = document.getElementById('panel-bom-upload');
            const drawingPanel = document.getElementById('panel-drawing-upload');
            
            console.log('ìš”ì†Œ í™•ì¸:', {
                bomTab: !!bomTab,
                drawingTab: !!drawingTab,
                bomPanel: !!bomPanel,
                drawingPanel: !!drawingPanel
            });
            
            if (bomTab && drawingTab && bomPanel && drawingPanel) {
                // ë“œë¡œì‰ íƒ­ ìŠ¤íƒ€ì¼ ì ìš©
                drawingTab.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm';
                bomTab.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800';
                
                // íŒ¨ë„ í‘œì‹œ/ìˆ¨ê¹€
                drawingPanel.classList.remove('hidden');
                bomPanel.classList.add('hidden');
                
                console.log('âœ… ë“œë¡œì‰ íƒ­ í™œì„±í™” ì™„ë£Œ');
                
                // ì‹œê°ì  í”¼ë“œë°±
                drawingTab.style.backgroundColor = '#f59e0b';
                drawingTab.style.color = 'white';
                setTimeout(() => {
                    drawingTab.style.backgroundColor = '';
                    drawingTab.style.color = '';
                }, 200);
                
            } else {
                console.error('âŒ ë“œë¡œì‰ íƒ­ ìš”ì†Œë“¤ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                console.log('Missing elements:', {
                    bomTab: bomTab,
                    drawingTab: drawingTab,
                    bomPanel: bomPanel,
                    drawingPanel: drawingPanel
                });
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ë¡œê¹…ë§Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œë¨ - íƒ­ í•¨ìˆ˜ ì¤€ë¹„ ì™„ë£Œ');
            
            // í•¨ìˆ˜ë“¤ì„ ì „ì—­ ìŠ¤ì½”í”„ì— ëª…ì‹œì ìœ¼ë¡œ ë“±ë¡
            window.uploadBOMFileSales = uploadBOMFileSales;
            window.uploadDrawingPackageSales = uploadDrawingPackageSales;
            window.selectProjectForAnalysis = selectProjectForAnalysis;
            window.createProjectSales = createProjectSales;
            window.registerProjectToSystem = registerProjectToSystem;
            
            // BOM íŠ¸ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì „ì—­ ë“±ë¡ (ì €ì¥ì§€ì  86 ë³µì›)
            window.toggleBOMRowSales = toggleBOMRowSales;
            window.expandAllTreeRowsSales = expandAllTreeRowsSales;
            window.collapseAllTreeRowsSales = collapseAllTreeRowsSales;
            window.expandToLevelSales = expandToLevelSales;
            window.exportVisibleItemsSales = exportVisibleItemsSales;
            
            // PDF ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì „ì—­ ë“±ë¡
            window.showPDFModalSales = showPDFModalSales;
            window.closePDFModal = closePDFModal;
            
            console.log('âœ… Sales í•¨ìˆ˜ë“¤ì´ ì „ì—­ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // ğŸ”¥ ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ íƒ­ ì „í™˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.id.replace('nav-', 'tab-');
                    console.log('ğŸ”„ íƒ­ ì „í™˜:', tabId);
                    
                    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                    navTabs.forEach(t => {
                        t.classList.remove('active', 'border-blue-600', 'text-blue-600');
                        t.classList.add('border-transparent', 'text-gray-500');
                    });
                    
                    // ì„ íƒëœ íƒ­ í™œì„±í™”
                    this.classList.add('active', 'border-blue-600', 'text-blue-600');
                    this.classList.remove('border-transparent', 'text-gray-500');
                    
                    // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // ì„ íƒëœ ì»¨í…ì¸  í‘œì‹œ
                    const targetContent = document.getElementById(tabId);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                        console.log('âœ… íƒ­ ì»¨í…ì¸  í‘œì‹œ:', tabId);
                    } else {
                        console.error('âŒ íƒ­ ì»¨í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', tabId);
                    }
                });
            });
            
            console.log('âœ… ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        });
        
        // ë“œë¡œì‰ í´ë” ì„ íƒ í•¸ë“¤ëŸ¬
        function handleDrawingFolderSelection(input) {
            console.log('ğŸ“ ë“œë¡œì‰ í´ë” ì„ íƒë¨!');
            console.log('ì„ íƒëœ íŒŒì¼ë“¤:', input.files);
            
            if (!input.files || input.files.length === 0) {
                console.log('âŒ ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const files = Array.from(input.files);
            const pdfFiles = files.filter(file => file.name.toLowerCase().endsWith('.pdf'));
            
            console.log(`ğŸ“Š ì „ì²´ íŒŒì¼: ${files.length}ê°œ, PDF íŒŒì¼: ${pdfFiles.length}ê°œ`);
            
            // í´ë” ì •ë³´ ì—…ë°ì´íŠ¸
            updateDrawingFolderInfo(files, pdfFiles);
            
            // ì—…ë¡œë“œ ë²„íŠ¼ í™œì„±í™”
            const uploadBtn = document.getElementById('upload-drawings-btn');
            if (uploadBtn) {
                uploadBtn.disabled = pdfFiles.length === 0;
                console.log(`ğŸ”˜ ì—…ë¡œë“œ ë²„íŠ¼ ${pdfFiles.length > 0 ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
                
                if (pdfFiles.length > 0) {
                    // ì‹œê°ì  í”¼ë“œë°±
                    uploadBtn.style.backgroundColor = '#ea580c';
                    uploadBtn.style.borderColor = '#ea580c';
                    setTimeout(() => {
                        uploadBtn.style.backgroundColor = '';
                        uploadBtn.style.borderColor = '';
                    }, 300);
                }
            }
        }
        
        function updateDrawingFolderInfo(allFiles, pdfFiles) {
            const drawingInfo = document.getElementById('selected-drawing-info');
            const folderName = document.getElementById('drawing-folder-name');
            const fileCount = document.getElementById('drawing-file-count');
            
            if (!drawingInfo || !folderName || !fileCount) {
                console.log('âš ï¸ í´ë” ì •ë³´ í‘œì‹œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            if (allFiles.length === 0) {
                drawingInfo.classList.add('hidden');
                return;
            }
            
            // í´ë”ëª… ì¶”ì¶œ
            const firstFile = allFiles[0];
            const pathParts = firstFile.webkitRelativePath ? firstFile.webkitRelativePath.split('/') : [firstFile.name];
            const folderNameText = pathParts.length > 1 ? pathParts[0] : 'ì„ íƒëœ í´ë”';
            
            folderName.textContent = folderNameText;
            fileCount.textContent = `ì´ ${allFiles.length}ê°œ íŒŒì¼ (PDF: ${pdfFiles.length}ê°œ)`;
            
            drawingInfo.classList.remove('hidden');
            console.log(`ğŸ“‹ í´ë” ì •ë³´ ì—…ë°ì´íŠ¸: ${folderNameText}, PDF ${pdfFiles.length}ê°œ`);
        }
        
        function clearSelectedDrawings() {
            console.log('ğŸ—‘ï¸ ì„ íƒëœ ë“œë¡œì‰ íŒŒì¼ ì´ˆê¸°í™”');
            
            const drawingInput = document.getElementById('drawing-package-input');
            const drawingInfo = document.getElementById('selected-drawing-info');
            const uploadBtn = document.getElementById('upload-drawings-btn');
            
            if (drawingInput) drawingInput.value = '';
            if (drawingInfo) drawingInfo.classList.add('hidden');
            if (uploadBtn) {
                uploadBtn.disabled = true;
                console.log('ğŸ”˜ ì—…ë¡œë“œ ë²„íŠ¼ ë¹„í™œì„±í™”');
            }
        }
        
        // ì „ì—­ ì ‘ê·¼ì„ ìœ„í•œ window ê°ì²´ì— í• ë‹¹
        window.activateBOMTab = activateBOMTab;
        window.activateDrawingTab = activateDrawingTab;
        window.handleDrawingFolderSelection = handleDrawingFolderSelection;
        window.clearSelectedDrawings = clearSelectedDrawings;
        
        // í–¥ìƒëœ ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ í•¨ìˆ˜
        function uploadDrawingPackageHTML() {
            console.log('ğŸš€ HTMLì—ì„œ ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ ì‹œì‘!');
            
            const drawingInput = document.getElementById('drawing-package-input');
            
            if (!drawingInput || !drawingInput.files || drawingInput.files.length === 0) {
                alert('ë“œë¡œì‰ íŒ¨í‚¤ì§€ í´ë”ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const files = Array.from(drawingInput.files);
            const pdfFiles = files.filter(file => file.name.toLowerCase().endsWith('.pdf'));
            
            if (pdfFiles.length === 0) {
                alert('ì„ íƒí•œ í´ë”ì— PDF íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            const uploadBtn = document.getElementById('upload-drawings-btn');
            if (uploadBtn) {
                uploadBtn.disabled = true;
                uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ì—…ë¡œë“œ ì¤‘...';
            }
            
            console.log('=== BOM ë°ì´í„°ì™€ PDF ë§¤ì¹­ ì‹œì‘ ===');
            
            // í˜„ì¬ BOM íŠ¸ë¦¬ì—ì„œ Number ì»¬ëŸ¼ ê°’ë“¤ ìˆ˜ì§‘
            const bomNumbers = [];
            // SalesíŒ€ìš©ê³¼ Prod.TechíŒ€ìš© í…Œì´ë¸” ëª¨ë‘ì—ì„œ BOM Number ìˆ˜ì§‘
            const salesRows = document.querySelectorAll('#bom-tree-body-sales tr');
            const prodTechRows = document.querySelectorAll('#bom-tree-body tr');
            const bomRows = [...salesRows, ...prodTechRows];
            
            bomRows.forEach((row, index) => {
                const numberCell = row.cells[2]; // Number ì»¬ëŸ¼ (3ë²ˆì§¸ ì»¬ëŸ¼)
                if (numberCell) {
                    const bomNumber = numberCell.textContent.trim();
                    if (bomNumber && bomNumber !== '-' && bomNumber !== '') {
                        bomNumbers.push({
                            index: index,
                            bomNumber: bomNumber,
                            row: row
                        });
                    }
                }
            });
            
            console.log('ğŸ” BOMì—ì„œ ë°œê²¬ëœ ë„ë©´ë²ˆí˜¸ë“¤:', bomNumbers.map(item => item.bomNumber));
            
            // PDF íŒŒì¼ëª…ì—ì„œ ë„ë©´ë²ˆí˜¸ ì¶”ì¶œ ë° ë§¤ì¹­
            let matchedCount = 0;
            const drawingMap = new Map();
            
            pdfFiles.forEach(file => {
                const fileName = file.name;
                console.log(`ğŸ“„ PDF: ${fileName}`);
                
                // BOM Numberì™€ ì§ì ‘ ë¹„êµ ë§¤ì¹­ ì‹œë„
                const matchedBOM = bomNumbers.find(bomItem => 
                    isNumberMatch(bomItem.bomNumber, fileName)
                );
                
                if (matchedBOM) {
                    const blobUrl = URL.createObjectURL(file);
                    drawingMap.set(matchedBOM.bomNumber, {
                        file: file,
                        blobUrl: blobUrl,
                        fileName: fileName
                    });
                    
                    // í•´ë‹¹ í–‰ì˜ Drawing ì»¬ëŸ¼ ì—…ë°ì´íŠ¸
                    const drawingCell = matchedBOM.row.cells[9]; // Drawing ì»¬ëŸ¼ (10ë²ˆì§¸ - TotalQuantity ì œê±°)
                    if (drawingCell) {
                        drawingCell.innerHTML = `
                            <button onclick="viewPDF('${matchedBOM.bomNumber}')" 
                                    class="text-blue-600 hover:text-blue-800 text-xs font-medium">
                                <i class="fas fa-file-pdf mr-1"></i>ë³´ê¸°
                            </button>
                        `;
                    }
                    
                    matchedCount++;
                    console.log(`âœ… ë§¤ì¹­ ì„±ê³µ: ${matchedBOM.bomNumber} â†” ${fileName}`);
                } else {
                    console.log(`âŒ ë§¤ì¹­ ì‹¤íŒ¨: ${drawingNumber} (${fileName})`);
                    
                    // ë””ë²„ê¹…: E ì½”ë“œ prefix ê¸°ë°˜ìœ¼ë¡œ ìœ ì‚¬í•œ BOM Number ì°¾ê¸°
                    const similarBOMs = bomNumbers.filter(bomItem => {
                        const bom = bomItem.bomNumber.toUpperCase();
                        const pdf = drawingNumber.toUpperCase();
                        
                        // E ì½”ë“œë¼ë¦¬ prefix ë¹„êµ
                        if (bom.startsWith('E') && pdf.startsWith('E')) {
                            const bomPrefix = extractECodePrefix(bom);
                            const pdfPrefix = extractECodePrefix(pdf);
                            // ì• 8ìë¦¬ê°€ ê°™ì€ì§€ í™•ì¸ (ë¶€ë¶„ ìœ ì‚¬ë„)
                            return bomPrefix && pdfPrefix && 
                                   bomPrefix.substring(0, Math.min(8, bomPrefix.length)) === 
                                   pdfPrefix.substring(0, Math.min(8, pdfPrefix.length));
                        }
                        
                        // GST ì½”ë“œ ë¹„êµ
                        if (bom.startsWith('GST') && pdf.startsWith('GST')) {
                            return true;
                        }
                        
                        return false;
                    });
                    
                    if (similarBOMs.length > 0) {
                        console.log(`ğŸ” ìœ ì‚¬í•œ Eì½”ë“œ prefixë¥¼ ê°€ì§„ BOM Numbers:`, similarBOMs.map(b => b.bomNumber));
                        console.log(`ğŸ“„ ì¶”ì¶œëœ PDF prefix: ${extractECodePrefix(drawingNumber)}`);
                    }
                }
            });
            
            // ì „ì—­ drawingMap ì €ì¥
            window.drawingMap = drawingMap;
            
            // ê¸°ì¡´ BOM íŠ¸ë¦¬ì˜ ëª¨ë“  Drawing ì»¬ëŸ¼ ì—…ë°ì´íŠ¸
            updateAllDrawingLinksInBOMTree();
            
            console.log(`ğŸ“Š ë§¤ì¹­ ê²°ê³¼: ${matchedCount}/${pdfFiles.length}ê°œ ì„±ê³µ`);
            
            // ë²„íŠ¼ ë³µêµ¬
            if (uploadBtn) {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="fas fa-upload mr-2"></i>ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ';
            }
            
            // ê²°ê³¼ ì•Œë¦¼
            if (matchedCount > 0) {
                const successMessage = `âœ… ì„±ê³µ: ${matchedCount}ê°œì˜ ë„ë©´ì´ ë§¤ì¹­ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n` +
                    `ğŸ“Š ë§¤ì¹­ ê²°ê³¼: ${matchedCount}/${pdfFiles.length}ê°œ PDF ì—°ê²°ë¨\n\n` +
                    `ğŸ’¡ ë§¤ì¹­ëœ ë„ë©´ë“¤ì€ BOM íŠ¸ë¦¬ì˜ "Drawing" ì»¬ëŸ¼ì—ì„œ "ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
                
                if (matchedCount < pdfFiles.length) {
                    const unmatchedFiles = pdfFiles.filter(file => {
                        return !bomNumbers.find(bomItem => isNumberMatch(bomItem.bomNumber, file.name));
                    });
                    
                    const examples = unmatchedFiles.slice(0, 3).map(f => {
                        return `â€¢ ${f.name}`;
                    }).join('\n');
                    
                    alert(successMessage + `\n\nâš ï¸ ë§¤ì¹­ë˜ì§€ ì•Šì€ íŒŒì¼ ${pdfFiles.length - matchedCount}ê°œ:\n${examples}${unmatchedFiles.length > 3 ? '\nâ€¢ ...' : ''}`);
                } else {
                    alert(successMessage);
                }
            } else {
                // ë§¤ì¹­ ì‹¤íŒ¨ ìƒì„¸ ë¶„ì„
                const samplePDFs = pdfFiles.slice(0, 5).map(f => {
                    const extracted = extractDrawingNumber(f.name);
                    return `â€¢ ${f.name}\n  â†’ ì¶”ì¶œëœ ë²ˆí˜¸: ${extracted}`;
                }).join('\n');
                
                const sampleBOMs = bomNumbers.slice(0, 5).map(b => `â€¢ ${b.bomNumber}`).join('\n');
                
                alert(`âŒ ë§¤ì¹­ëœ ë„ë©´ì´ ì—†ìŠµë‹ˆë‹¤.\n\n` +
                      `ğŸ” ë§¤ì¹­ ì‹¤íŒ¨ ì›ì¸ ë¶„ì„:\n` +
                      `â€¢ BOM Numbersì™€ PDF íŒŒì¼ëª…ì—ì„œ ì¶”ì¶œëœ ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n` +
                      `ğŸ“ ì—…ë¡œë“œëœ PDF íŒŒì¼ë“¤ (ì²˜ìŒ 5ê°œ):\n${samplePDFs}${pdfFiles.length > 5 ? '\nâ€¢ ...' : ''}\n\n` +
                      `ğŸ“‹ BOM Numbers (ì²˜ìŒ 5ê°œ):\n${sampleBOMs}${bomNumbers.length > 5 ? '\nâ€¢ ...' : ''}\n\n` +
                      `ğŸ’¡ íŒŒì¼ëª…ì´ BOM Numberì™€ ìœ ì‚¬í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\n` +
                      `ì§€ì›ë˜ëŠ” íŒ¨í„´: GSTì½”ë“œ, E-ì‹œë¦¬ì¦ˆ ì½”ë“œ ë“±`);
            }
        }
        
        // ë„ë©´ë²ˆí˜¸ ì¶”ì¶œ í•¨ìˆ˜ (ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ê¸°ë°˜ ì§ì ‘ ë¹„êµ ë°©ì‹)
        function extractDrawingNumber(filename) {
            // í™•ì¥ì ì œê±°
            const nameWithoutExt = filename.replace(/\.[^/.]+$/, "");
            
            console.log(`ğŸ” PDF íŒŒì¼ëª…ì—ì„œ ë„ë©´ë²ˆí˜¸ ì¶”ì¶œ: "${filename}" -> "${nameWithoutExt}"`);
            
            // ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­:
            // 1. E0005476410-00 -> E0005476410 (í•˜ì´í”ˆ ì´ì „ ë¶€ë¶„)
            // 2. 30972 -> 30972 (ìˆ«ì ê·¸ëŒ€ë¡œ)
            // 3. ëª¨ë“  í˜•íƒœì˜ ë²ˆí˜¸ì— ëŒ€í•´ ì§ì ‘ ë¹„êµ
            
            return nameWithoutExt; // ì „ì²´ íŒŒì¼ëª…ì„ ë°˜í™˜í•˜ì—¬ ì§ì ‘ ë¹„êµì—ì„œ ë§¤ì¹­ë˜ë„ë¡
        }
        
        // ë²ˆí˜¸ ë§¤ì¹­ í•¨ìˆ˜ (ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ê¸°ë°˜ ì§ì ‘ ë²ˆí˜¸ ë¹„êµ)
        function isNumberMatch(bomNumber, pdfFileName) {
            if (!bomNumber || !pdfFileName) return false;
            
            const bom = bomNumber.toString().trim();
            const pdfFile = pdfFileName.toString().trim();
            
            console.log(`ğŸ” ì§ì ‘ ë²ˆí˜¸ ë§¤ì¹­ ì‹œë„: BOM[${bom}] â†” PDFíŒŒì¼ëª…[${pdfFile}]`);
            
            // ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ì— ë”°ë¥¸ ì§ì ‘ ë¹„êµ ë¡œì§:
            // 1. BOM Numberê°€ E0005476410-00ì´ë©´ -> E0005476410 ì¶”ì¶œí•˜ì—¬ PDF íŒŒì¼ëª…ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
            // 2. BOM Numberê°€ 30972ì´ë©´ -> 30972ê°€ PDF íŒŒì¼ëª…ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
            
            let searchNumber = bom;
            
            // E ì½”ë“œì¸ ê²½ìš° í•˜ì´í”ˆ ì´ì „ ë¶€ë¶„ë§Œ ì¶”ì¶œ
            if (bom.match(/^E\d+/i)) {
                const eMatch = bom.match(/^(E\d+)/i);
                if (eMatch) {
                    searchNumber = eMatch[1];
                    console.log(`ğŸ“‹ Eì½”ë“œì—ì„œ ê²€ìƒ‰í•  ë²ˆí˜¸ ì¶”ì¶œ: ${bom} -> ${searchNumber}`);
                }
            }
            // GST ì½”ë“œì¸ ê²½ìš° í•˜ì´í”ˆ ì´ì „ ë¶€ë¶„ ì¶”ì¶œ
            else if (bom.match(/^GST/i)) {
                const gstMatch = bom.match(/^([^-]+)/i);
                if (gstMatch) {
                    searchNumber = gstMatch[1];
                    console.log(`ğŸ“‹ GSTì½”ë“œì—ì„œ ê²€ìƒ‰í•  ë²ˆí˜¸ ì¶”ì¶œ: ${bom} -> ${searchNumber}`);
                }
            }
            // ê¸°íƒ€ ë²ˆí˜¸ì—ì„œ í•˜ì´í”ˆì´ ìˆìœ¼ë©´ í•˜ì´í”ˆ ì´ì „ ë¶€ë¶„ë§Œ ì¶”ì¶œ
            else if (bom.includes('-')) {
                const dashMatch = bom.match(/^([^-]+)/);
                if (dashMatch) {
                    searchNumber = dashMatch[1];
                    console.log(`ğŸ“‹ í•˜ì´í”ˆ ì´ì „ ë²ˆí˜¸ ì¶”ì¶œ: ${bom} -> ${searchNumber}`);
                }
            }
            
            // PDF íŒŒì¼ëª…ì— ì¶”ì¶œëœ ë²ˆí˜¸ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
            const isMatch = pdfFile.toUpperCase().includes(searchNumber.toUpperCase());
            
            if (isMatch) {
                console.log(`âœ… ì§ì ‘ ë²ˆí˜¸ ë§¤ì¹­ ì„±ê³µ: "${searchNumber}"ê°€ "${pdfFile}"ì— í¬í•¨ë¨`);
                return true;
            } else {
                console.log(`âŒ ì§ì ‘ ë²ˆí˜¸ ë§¤ì¹­ ì‹¤íŒ¨: "${searchNumber}"ê°€ "${pdfFile}"ì— ì—†ìŒ`);
                return false;
            }
            
            // 4. ì¼ë°˜ì ì¸ ë¶€ë¶„ ë§¤ì¹­ (ìˆ«ì ë¶€ë¶„ë§Œ, 6ìë¦¬ ì´ìƒ)
            const bomDigits = bom.replace(/[^0-9]/g, '');
            const pdfDigits = pdf.replace(/[^0-9]/g, '');
            if (bomDigits.length >= 6 && bomDigits === pdfDigits) return true;
            
            console.log(`âŒ ë§¤ì¹­ ì‹¤íŒ¨: ${bom} â†” ${pdf}`);
            return false;
        }
        
        // ë„ë©´ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ (ê°œë°œì ë„êµ¬ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
        function testDrawingMatch(bomNumber, pdfFileName) {
            console.log('=== ë„ë©´ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ (ì§ì ‘ ë¹„êµ ë°©ì‹) ===');
            console.log(`í…ŒìŠ¤íŠ¸ ëŒ€ìƒ: BOM[${bomNumber}] â†” PDFíŒŒì¼ëª…[${pdfFileName}]`);
            
            const isMatch = isNumberMatch(bomNumber, pdfFileName);
            console.log(`ë§¤ì¹­ ê²°ê³¼: ${isMatch ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}`);
            
            return isMatch;
        }
        
        // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • (ë””ë²„ê¹…ìš©)
        window.testDrawingMatch = testDrawingMatch;
        window.extractDrawingNumber = extractDrawingNumber;
        window.isNumberMatch = isNumberMatch;
        window.matchDrawingsWithBOMSales = matchDrawingsWithBOMSales;
        window.updateAllDrawingLinksInBOMTree = updateAllDrawingLinksInBOMTree;
        
        // ê°•ì œ ë§¤ì¹­ ì‹¤í–‰ í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
        window.forceMatchDrawings = function() {
            console.log('ğŸ”§ ê°•ì œ ë“œë¡œì‰ ë§¤ì¹­ ì‹¤í–‰...');
            console.log('í˜„ì¬ ìƒíƒœ:');
            console.log('- salesBOMData:', salesBOMData ? salesBOMData.length : 'null');
            console.log('- salesDrawingPackage:', salesDrawingPackage ? salesDrawingPackage.length : 'null');
            
            if (salesBOMData && salesDrawingPackage) {
                matchDrawingsWithBOMSales();
            } else {
                console.log('âŒ BOM ë°ì´í„°ë‚˜ ë“œë¡œì‰ íŒ¨í‚¤ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        };
        
        // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥ í•¨ìˆ˜
        window.debugDrawingMap = function() {
            console.log('=== Drawing Map ë””ë²„ê·¸ ì •ë³´ ===');
            console.log('window.drawingMap ì¡´ì¬:', !!window.drawingMap);
            console.log('window.drawingMap í¬ê¸°:', window.drawingMap ? window.drawingMap.size : 0);
            if (window.drawingMap && window.drawingMap.size > 0) {
                console.log('ì €ì¥ëœ ë„ë©´ë“¤:');
                window.drawingMap.forEach((value, key) => {
                    console.log(`  ${key} â†’ ${value.fileName}`);
                });
            }
            console.log('salesDrawingPackage ì¡´ì¬:', !!salesDrawingPackage);
            console.log('salesDrawingPackage í¬ê¸°:', salesDrawingPackage ? salesDrawingPackage.length : 0);
            console.log('salesBOMData ì¡´ì¬:', !!salesBOMData);
            console.log('salesBOMData í¬ê¸°:', salesBOMData ? salesBOMData.length : 0);
            
            // ìƒ˜í”Œ ë“œë¡œì‰ íŒŒì¼ëª…ë“¤ ì¶œë ¥
            if (salesDrawingPackage && salesDrawingPackage.length > 0) {
                console.log('ë“œë¡œì‰ íŒŒì¼ ìƒ˜í”Œ (ì²˜ìŒ 10ê°œ):');
                salesDrawingPackage.slice(0, 10).forEach((file, index) => {
                    const extracted = extractDrawingNumber(file.name);
                    console.log(`  ${index + 1}. ${file.name} â†’ ${extracted}`);
                });
            }
        };
        
        // ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì œê±°ë¨ - ì§ì ‘ ë²ˆí˜¸ ë¹„êµ ë°©ì‹ ì‚¬ìš©
        
        // ëª¨ë“  BOM íŠ¸ë¦¬ í–‰ì˜ Drawing ë§í¬ ì—…ë°ì´íŠ¸
        function updateAllDrawingLinksInBOMTree() {
            console.log('ğŸ”„ ëª¨ë“  BOM í–‰ì˜ Drawing ë§í¬ ì—…ë°ì´íŠ¸ ì‹œì‘');
            
            // SalesíŒ€ìš©ê³¼ Prod.TechíŒ€ìš© í…Œì´ë¸” ëª¨ë‘ ì²˜ë¦¬
            const salesRows = document.querySelectorAll('#bom-tree-body-sales tr');
            const prodTechRows = document.querySelectorAll('#bom-tree-body tr');
            const bomRows = [...salesRows, ...prodTechRows];
            let updatedCount = 0;
            
            bomRows.forEach((row, index) => {
                // Number ì»¬ëŸ¼ì—ì„œ ë„ë©´ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸° (3ë²ˆì§¸ ì»¬ëŸ¼, ì¸ë±ìŠ¤ 2)
                const numberCell = row.cells[2]; 
                if (numberCell) {
                    const bomNumber = numberCell.textContent.trim();
                    
                    // Drawing ì»¬ëŸ¼ (10ë²ˆì§¸ ì»¬ëŸ¼, ì¸ë±ìŠ¤ 9 - TotalQuantity ì œê±°ë¡œ ì¸í•œ ë³€ê²½)
                    const drawingCell = row.cells[9]; 
                    if (drawingCell && bomNumber && bomNumber !== '-' && bomNumber !== '') {
                        
                        // window.drawingMapì—ì„œ í•´ë‹¹ ë„ë©´ í™•ì¸
                        if (window.drawingMap && window.drawingMap.has(bomNumber)) {
                            drawingCell.innerHTML = `
                                <button onclick="viewPDF('${bomNumber}')" 
                                        class="text-blue-600 hover:text-blue-800 text-xs font-medium">
                                    <i class="fas fa-file-pdf mr-1"></i>ë³´ê¸°
                                </button>
                            `;
                            updatedCount++;
                            console.log(`âœ… Drawing ë§í¬ ì—…ë°ì´íŠ¸: ${bomNumber}`);
                        } else {
                            // ë„ë©´ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìƒíƒœë¡œ
                            drawingCell.innerHTML = `
                                <span class="text-gray-400 text-xs">
                                    <i class="fas fa-minus"></i>
                                </span>
                            `;
                        }
                    }
                }
            });
            
            console.log(`ğŸ‰ Drawing ë§í¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${updatedCount}ê°œ í–‰ ì—…ë°ì´íŠ¸ë¨`);
        }
        
        // PDF ë·°ì–´ í•¨ìˆ˜
        function viewPDF(bomNumber) {
            console.log(`ğŸ” PDF ë³´ê¸° ìš”ì²­: ${bomNumber}`);
            
            let drawingData = null;
            let fileName = '';
            let blobUrl = '';
            
            // 1. window.drawingMapì—ì„œ í™•ì¸ (ê¸°ë³¸ BOM ë¶„ì„)
            if (window.drawingMap && window.drawingMap.has(bomNumber)) {
                drawingData = window.drawingMap.get(bomNumber);
                fileName = drawingData.fileName;
                blobUrl = drawingData.blobUrl;
                console.log(`âœ… window.drawingMapì—ì„œ ì •í™• ë§¤ì¹­: ${bomNumber}`);
            }
            // Eì½”ë“œ prefix ë§¤ì¹­ ì‹œë„ (E0003589466-03 â†’ E0003589466)
            else if (window.drawingMap && bomNumber.startsWith('E') && bomNumber.includes('-')) {
                const prefix = bomNumber.split('-')[0]; // E0003589466-03 â†’ E0003589466
                if (window.drawingMap.has(prefix)) {
                    drawingData = window.drawingMap.get(prefix);
                    fileName = drawingData.fileName;
                    blobUrl = drawingData.blobUrl;
                    console.log(`âœ… window.drawingMapì—ì„œ Eì½”ë“œ prefix ë§¤ì¹­: ${bomNumber} â†’ ${prefix}`);
                }
            }
            // 2. window.bomAnalyzer.drawingFilesì—ì„œ í™•ì¸ (ê³ ê¸‰ BOM ë¶„ì„)
            else if (window.bomAnalyzer && window.bomAnalyzer.drawingFiles.has(bomNumber)) {
                const file = window.bomAnalyzer.drawingFiles.get(bomNumber);
                fileName = file.name;
                blobUrl = window.bomAnalyzer.drawingUrls.get(bomNumber);
                console.log(`âœ… bomAnalyzer.drawingFilesì—ì„œ ë„ë©´ ë°œê²¬: ${bomNumber}`);
            }
            else {
                console.log(`âŒ ë„ë©´ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${bomNumber}`, {
                    drawingMapExists: !!window.drawingMap,
                    drawingMapSize: window.drawingMap ? window.drawingMap.size : 0,
                    bomAnalyzerExists: !!window.bomAnalyzer,
                    bomAnalyzerDrawingFilesSize: window.bomAnalyzer ? window.bomAnalyzer.drawingFiles.size : 0
                });
                alert(`í•´ë‹¹ ë„ë©´ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${bomNumber}`);
                return;
            }
            
            if (blobUrl) {
                showPDFModal(bomNumber, blobUrl, fileName);
            } else {
                alert('ë„ë©´ íŒŒì¼ URLì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // PDF ëª¨ë‹¬ í‘œì‹œ
        function showPDFModal(bomNumber, pdfUrl, fileName) {
            const modal = document.createElement('div');
            modal.className = 'pdf-modal show';
            modal.id = 'pdf-viewer-modal';
            modal.innerHTML = `
                <div class="pdf-modal-content" style="max-width: 95%; max-height: 95%; width: 1200px;">
                    <button class="pdf-modal-close" onclick="closePDFModal()">&times;</button>
                    <div class="pdf-modal-header">
                        <h3 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-file-pdf text-red-600 mr-2"></i>
                            ë„ë©´: ${bomNumber} (${fileName})
                        </h3>
                    </div>
                    <div class="pdf-viewer-container" style="width: 100%; height: 80vh; background: #f3f4f6;">
                        <iframe src="${pdfUrl}#toolbar=1&navpanes=1&scrollbar=1" 
                                style="width: 100%; height: 100%; border: none;"
                                title="PDF ë„ë©´ ë·°ì–´">
                            <p style="padding: 20px; text-align: center;">
                                ë¸Œë¼ìš°ì €ê°€ PDFë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 
                                <a href="${pdfUrl}" download="${fileName}" 
                                   style="color: #2563eb; text-decoration: underline;">
                                   ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
                                </a>í•˜ì„¸ìš”.
                            </p>
                        </iframe>
                    </div>
                    <div class="flex justify-end mt-4 space-x-2">
                        <a href="${pdfUrl}" download="${fileName}" 
                           class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-download mr-2"></i>ë‹¤ìš´ë¡œë“œ
                        </a>
                        <button onclick="closePDFModal()" 
                                class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            console.log(`âœ… PDF ëª¨ë‹¬ í‘œì‹œ: ${bomNumber} - ${fileName}`, { pdfUrl });
        }
        
        // PDF ëª¨ë‹¬ ë‹«ê¸°
        function closePDFModal() {
            const modal = document.getElementById('pdf-viewer-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ë§¤ì¹­ ìƒíƒœ í™•ì¸ í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
        function checkMatchingStatus() {
            console.log('=== ë§¤ì¹­ ìƒíƒœ í™•ì¸ ===');
            
            const bomNumbers = [];
            // SalesíŒ€ìš©ê³¼ Prod.TechíŒ€ìš© í…Œì´ë¸” ëª¨ë‘ì—ì„œ í™•ì¸
            const salesRows = document.querySelectorAll('#bom-tree-body-sales tr');
            const prodTechRows = document.querySelectorAll('#bom-tree-body tr');
            const bomRows = [...salesRows, ...prodTechRows];
            
            bomRows.forEach((row, index) => {
                const numberCell = row.cells[2];
                if (numberCell) {
                    const bomNumber = numberCell.textContent.trim();
                    const drawingCell = row.cells[10];
                    const hasDrawing = drawingCell && drawingCell.innerHTML.includes('ë³´ê¸°');
                    
                    bomNumbers.push({
                        index: index,
                        bomNumber: bomNumber,
                        hasDrawing: hasDrawing
                    });
                }
            });
            
            console.log('BOM ë²ˆí˜¸ë“¤ê³¼ ë„ë©´ ì—°ê²° ìƒíƒœ:');
            bomNumbers.forEach(item => {
                console.log(`${item.bomNumber}: ${item.hasDrawing ? 'âœ… ì—°ê²°ë¨' : 'âŒ ë¯¸ì—°ê²°'}`);
            });
            
            const connectedCount = bomNumbers.filter(item => item.hasDrawing).length;
            console.log(`ğŸ“Š ì´ ${bomNumbers.length}ê°œ ì¤‘ ${connectedCount}ê°œ ì—°ê²°ë¨`);
            
            return {
                total: bomNumbers.length,
                connected: connectedCount,
                items: bomNumbers
            };
        }
        
        // ì „ì—­ í•¨ìˆ˜ ë“±ë¡
        window.viewPDF = viewPDF;
        window.closePDFModal = closePDFModal;
        window.checkMatchingStatus = checkMatchingStatus;
    </script>
    
    <!-- External JS files removed to prevent MIME type errors -->

    <!-- ìƒˆë¡œ ì¶”ê°€ëœ SalesíŒ€ ë° Prod. TechíŒ€ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let salesBOMData = [];
        let salesDrawingPackage = [];
        let salesProjectList = [];
        let selectedProjectForAnalysis = null; // ì„ íƒëœ í”„ë¡œì íŠ¸ ìƒíƒœ
        let prodTechApprovalProgress = {
            isInProgress: false,
            currentStep: 0,
            startTime: null,
            stepTimings: [3000, 5000, 7000] // ê° ë‹¨ê³„ë³„ ìŠ¹ì¸ ì‹œê°„ (ms)
        };
        
        // ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ ê´€ë¦¬
        function showWorkflowStep(stepName) {
            console.log('ğŸ”„ ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ ì „í™˜:', stepName);
            
            // ëª¨ë“  ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ ìˆ¨ê¸°ê¸°
            const steps = ['step-project-list', 'step-new-project', 'step-bom-drawing'];
            steps.forEach(step => {
                const element = document.getElementById(step);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            // ì„ íƒëœ ë‹¨ê³„ ë³´ì´ê¸°
            const targetStep = document.getElementById(stepName);
            if (targetStep) {
                targetStep.classList.remove('hidden');
                console.log('âœ… ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ í‘œì‹œ:', stepName);
            } else {
                console.error('âŒ ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', stepName);
            }
            
            // ë‹¨ê³„ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
            updateStepIndicator(stepName);
        }
        
        function updateStepIndicator(activeStep) {
            const stepMapping = {
                'step-project-list': 1,
                'step-new-project': 2,
                'step-bom-drawing': 3
            };
            
            const activeStepNumber = stepMapping[activeStep] || 1;
            
            // ëª¨ë“  ë‹¨ê³„ ì¸ë””ì¼€ì´í„° ì´ˆê¸°í™”
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step-indicator-${i}`);
                if (indicator) {
                    const circle = indicator.querySelector('.w-8');
                    const text = indicator.querySelector('span');
                    if (circle && text) {
                        if (i <= activeStepNumber) {
                            // í™œì„± ë˜ëŠ” ì™„ë£Œëœ ë‹¨ê³„
                            circle.className = 'w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-semibold';
                            text.className = 'text-sm font-medium text-blue-700';
                        } else {
                            // ë¹„í™œì„± ë‹¨ê³„
                            circle.className = 'w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-semibold';
                            text.className = 'text-sm text-gray-500';
                        }
                    }
                }
            }
        }
        
        // í”„ë¡œì íŠ¸ ì„ íƒ ë° ë¶„ì„ í™”ë©´ ì´ë™
        function selectProjectForAnalysis(project) {
            console.log('ğŸ” í”„ë¡œì íŠ¸ ì„ íƒ:', project.name, '(ID:', project.id, ')');
            
            selectedProjectForAnalysis = project;
            
            // ğŸ”¥ í”„ë¡œì íŠ¸ë³„ BOM ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            if (project.bomData && Array.isArray(project.bomData)) {
                console.log('ğŸ“¦ ì €ì¥ëœ BOM ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°:', project.bomData.length, 'ê°œ ì•„ì´í…œ');
                
                // BOM ë°ì´í„° ë³µì› ë° ì´ˆê¸°í™”
                salesBOMData = project.bomData.map(item => ({
                    ...item,
                    children: [], // children ë°°ì—´ ì´ˆê¸°í™”
                    parent: null, // parent ì°¸ì¡° ì´ˆê¸°í™”
                    isVisible: item.depth === 0 || item.isVisible // depth 0ì€ í•­ìƒ í‘œì‹œ
                }));
                
                // BOM ê³„ì¸µ êµ¬ì¡° ì¬êµ¬ì„±
                buildBOMHierarchySales();
                
                // âš ï¸ ì—¬ê¸°ì„œëŠ” BOM í…Œì´ë¸”ì„ ì•„ì§ í‘œì‹œí•˜ì§€ ì•ŠìŒ - IndexedDB ë³µì› í›„ í‘œì‹œ
                document.getElementById('basic-bom-analysis-section-sales').classList.remove('hidden');
                
                console.log('âœ… BOM ë°ì´í„° ë¡œë“œ ì™„ë£Œ - IndexedDB ë³µì› ëŒ€ê¸° ì¤‘...');
            } else {
                console.log('âš ï¸ ì €ì¥ëœ BOM ë°ì´í„° ì—†ìŒ - ì´ˆê¸°í™”');
                salesBOMData = [];
                document.getElementById('basic-bom-analysis-section-sales').classList.add('hidden');
            }
            
            // ğŸ”¥ IndexedDBì—ì„œ ë“œë¡œì‰ íŒŒì¼ ë³µì› (ì¬ì§„ì… ì‹œ PDF ì—´ê¸° ê°€ëŠ¥)
            if (project.drawingPackage && Array.isArray(project.drawingPackage)) {
                console.log('ğŸ“„ IndexedDBì—ì„œ ë“œë¡œì‰ íŒŒì¼ ë³µì› ì¤‘:', project.drawingPackage.length, 'ê°œ íŒŒì¼');
                
                // IndexedDBì—ì„œ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ë“œë¡œì‰ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
                loadAllDrawingFiles(project.id).then(drawingFiles => {
                    console.log(`âœ… IndexedDBì—ì„œ ${drawingFiles.length}ê°œ ë“œë¡œì‰ íŒŒì¼ ë¡œë“œë¨`);
                    
                    // BOM ë°ì´í„°ì— ë“œë¡œì‰ íŒŒì¼ ë§¤ì¹­
                    drawingFiles.forEach(data => {
                        const bomItem = salesBOMData.find(item => item.number === data.bomNumber);
                        if (bomItem && data.file) {
                            bomItem.hasDrawing = true;
                            bomItem.drawingFile = data.file;  // ğŸ”¥ ì‹¤ì œ File ê°ì²´ ë³µì›!
                            bomItem.drawingFileName = data.fileName;
                            console.log(`âœ… ë“œë¡œì‰ íŒŒì¼ ë³µì›: ${data.bomNumber} â†’ ${data.fileName}`);
                        }
                    });
                    
                    // ğŸ”¥ IndexedDB ë³µì› ì™„ë£Œ í›„ BOM í…Œì´ë¸” ë Œë”ë§ (íŒŒì¼ ê°ì²´ í¬í•¨)
                    displayBOMTableSales();
                    console.log('âœ… ë“œë¡œì‰ íŒŒì¼ ë³µì› ì™„ë£Œ - ì¬ì§„ì… í›„ì—ë„ PDF ì—´ê¸° ê°€ëŠ¥!');
                    
                }).catch(err => {
                    console.error('âŒ IndexedDBì—ì„œ ë“œë¡œì‰ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', err);
                    // ì‹¤íŒ¨ ì‹œ ë©”íƒ€ë°ì´í„°ë§Œ í‘œì‹œí•˜ê³  í…Œì´ë¸” ë Œë”ë§
                    restoreDrawingPackageMetadata(project.drawingPackage);
                    displayBOMTableSales();
                });
            } else {
                console.log('âš ï¸ ì €ì¥ëœ ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—†ìŒ');
                salesDrawingPackage = [];
                // ë“œë¡œì‰ íŒ¨í‚¤ì§€ê°€ ì—†ëŠ” ê²½ìš° ë°”ë¡œ í…Œì´ë¸” ë Œë”ë§
                displayBOMTableSales();
            }
            
            // ğŸ”¥ ì‹œìŠ¤í…œ ë“±ë¡ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            const systemRegisterSection = document.getElementById('system-register-section-sales');
            const systemRegisteredCompleteDiv = document.getElementById('system-registered-complete-message');
            
            if (systemRegisterSection) {
                // ì‹œìŠ¤í…œ ë“±ë¡ ì™„ë£Œ ë©”ì‹œì§€ ì˜ì—­ì´ ì—†ìœ¼ë©´ ìƒì„±
                if (!systemRegisteredCompleteDiv) {
                    const completeDiv = document.createElement('div');
                    completeDiv.id = 'system-registered-complete-message';
                    completeDiv.className = 'bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6 hidden';
                    systemRegisterSection.parentNode.insertBefore(completeDiv, systemRegisterSection);
                }
                
                const completeMsg = document.getElementById('system-registered-complete-message');
                
                console.log('ğŸ” í”„ë¡œì íŠ¸ ì‹œìŠ¤í…œ ë“±ë¡ ìƒíƒœ ì²´í¬:', {
                    projectId: project.id,
                    projectName: project.name,
                    systemRegistered: project.systemRegistered,
                    bomAnalyzed: project.bomAnalyzed,
                    drawingLinked: project.drawingLinked
                });
                
                if (project.systemRegistered) {
                    // âœ… ì‹œìŠ¤í…œ ë“±ë¡ ì™„ë£Œ â†’ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ, ë“±ë¡ ì„¹ì…˜ ìˆ¨ê¹€
                    console.log('âœ… ì‹œìŠ¤í…œ ë“±ë¡ ì™„ë£Œ ìƒíƒœ - ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ');
                    completeMsg.innerHTML = `
                        <div class="text-center">
                            <i class="fas fa-check-circle text-green-600 text-4xl mb-3"></i>
                            <h3 class="text-xl font-bold text-green-800 mb-2">ì‹œìŠ¤í…œ ë“±ë¡ ì™„ë£Œ</h3>
                            <p class="text-gray-600">ì´ í”„ë¡œì íŠ¸ëŠ” ì´ë¯¸ ì‹œìŠ¤í…œì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                            <p class="text-sm text-gray-500 mt-2">ë“±ë¡ì¼ì‹œ: ${project.systemRegisteredAt || project.registeredDate || 'ì •ë³´ ì—†ìŒ'}</p>
                        </div>
                    `;
                    completeMsg.classList.remove('hidden');
                    systemRegisterSection.classList.add('hidden');
                } else if (project.bomAnalyzed && project.drawingLinked) {
                    // BOM + ë“œë¡œì‰ ì™„ë£Œí–ˆì§€ë§Œ ì‹œìŠ¤í…œ ë¯¸ë“±ë¡ â†’ ë“±ë¡ ë²„íŠ¼ í‘œì‹œ
                    console.log('â³ ì‹œìŠ¤í…œ ë“±ë¡ ëŒ€ê¸° ìƒíƒœ - ë“±ë¡ ë²„íŠ¼ í‘œì‹œ');
                    completeMsg.classList.add('hidden');
                    systemRegisterSection.classList.remove('hidden');
                } else {
                    // ê·¸ ì™¸ ê²½ìš° ëª¨ë‘ ìˆ¨ê¹€
                    console.log('âŒ ë“±ë¡ ì¡°ê±´ ë¯¸ì¶©ì¡± - ëª¨ë‘ ìˆ¨ê¹€');
                    completeMsg.classList.add('hidden');
                    systemRegisterSection.classList.add('hidden');
                }
            }
            
            // ì„ íƒëœ í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
            const projectInfoElement = document.querySelector('#selected-project-info span');
            if (projectInfoElement) {
                projectInfoElement.textContent = `${project.name} (${project.customer})`;
            }
            
            // BOM ë¶„ì„ & ë“œë¡œì‰ ì—…ë¡œë“œ í™”ë©´ìœ¼ë¡œ ì´ë™
            showWorkflowStep('step-bom-drawing');
            
            console.log('âœ… í”„ë¡œì íŠ¸ ì„ íƒ ì™„ë£Œ:', {
                id: project.id,
                name: project.name,
                bomItems: salesBOMData.length,
                bomAnalyzed: project.bomAnalyzed,
                drawingLinked: project.drawingLinked,
                systemRegistered: project.systemRegistered
            });
        }

        // ë“œë¡œì‰ íŒ¨í‚¤ì§€ ë©”íƒ€ë°ì´í„° ë³µì› í•¨ìˆ˜
        function restoreDrawingPackageMetadata(drawingMetadata) {
            if (!drawingMetadata || !Array.isArray(drawingMetadata)) {
                console.log('âš ï¸ ë³µì›í•  ë“œë¡œì‰ ë©”íƒ€ë°ì´í„° ì—†ìŒ');
                return;
            }
            
            console.log('ğŸ“„ ë“œë¡œì‰ ë©”íƒ€ë°ì´í„° ë³µì› ì¤‘:', drawingMetadata.length, 'ê°œ íŒŒì¼');
            
            // BOM ë°ì´í„°ì— ë“œë¡œì‰ ì •ë³´ ë§¤ì¹­
            drawingMetadata.forEach(meta => {
                const bomNumber = meta.bomNumber;
                
                // salesBOMDataì—ì„œ í•´ë‹¹ ë²ˆí˜¸ë¥¼ ê°€ì§„ í•­ëª© ì°¾ê¸°
                const bomItem = salesBOMData.find(item => item.number === bomNumber);
                
                if (bomItem) {
                    bomItem.hasDrawing = true;
                    bomItem.drawingFileName = meta.fileName;
                    console.log('âœ… ë“œë¡œì‰ ë©”íƒ€ë°ì´í„° ë§¤ì¹­:', bomNumber, 'â†’', meta.fileName);
                }
            });
            
            // BOM í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ ë“œë¡œì‰ ì •ë³´ ë°˜ì˜
            displayBOMTableSales();
            
            console.log('âœ… ë“œë¡œì‰ ë©”íƒ€ë°ì´í„° ë³µì› ì™„ë£Œ');
        }

        // SalesíŒ€ ê¸°ëŠ¥ë“¤

        // í”„ë¡œì íŠ¸ ìƒì„±
        function createProjectSales() {
            const projectName = document.getElementById('project-name-sales').value;
            const projectType = document.getElementById('project-type-sales').value;
            const customerName = document.getElementById('customer-name-sales').value;
            const startDate = document.getElementById('project-start-date-sales').value;
            const endDate = document.getElementById('project-end-date-sales').value;
            
            if (!projectName || !projectType || !customerName || !startDate || !endDate) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const project = {
                id: Date.now(),
                number: salesProjectList.length + 1,
                name: projectName,
                type: projectType,
                customer: customerName,
                startDate: startDate,
                endDate: endDate,
                createdAt: new Date().toISOString(),
                bomAnalyzed: false,
                drawingLinked: false,
                systemRegistered: false,
                bomData: null,
                drawingData: null
            };
            
            // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
            salesProjectList.push(project);
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ìˆœí™˜ ì°¸ì¡° ë°©ì§€)
            saveProjectListToStorage();
            
            // ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateProjectListDisplay();
            
            // í”„ë¡œì íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            updateProjectSelectOptions();
            
            console.log('í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ. í˜„ì¬ salesProjectList:', salesProjectList);
            
            alert(`í”„ë¡œì íŠ¸ "${projectName}"ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\në‹¤ìŒ ë‹¨ê³„: BOM ë¶„ì„ íƒ­ì—ì„œ BOM íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.`);
            
            // í¼ ì´ˆê¸°í™”
            clearProjectForm();
            
            // ìë™ìœ¼ë¡œ BOM ë¶„ì„ íƒ­ìœ¼ë¡œ ì´ë™í•˜ê³  ìƒì„±ëœ í”„ë¡œì íŠ¸ ì„ íƒ
            setTimeout(() => {
                // BOM ë¶„ì„ íƒ­ìœ¼ë¡œ ìë™ ì „í™˜
                showTab('bom-analysis');
                
                // ë°©ê¸ˆ ìƒì„±ëœ í”„ë¡œì íŠ¸ë¥¼ ìë™ ì„ íƒ
                const bomProjectSelect = document.getElementById('project-select-for-bom');
                if (bomProjectSelect && project.id) {
                    bomProjectSelect.value = project.id;
                    
                    // ì„ íƒ ì´ë²¤íŠ¸ ìˆ˜ë™ íŠ¸ë¦¬ê±°
                    const changeEvent = new Event('change');
                    bomProjectSelect.dispatchEvent(changeEvent);
                    
                    console.log('âœ… ìë™ìœ¼ë¡œ BOM ë¶„ì„ íƒ­ ì´ë™ ë° í”„ë¡œì íŠ¸ ì„ íƒ ì™„ë£Œ:', project.name);
                }
            }, 1000); // 1ì´ˆ í›„ ìë™ ì „í™˜
            
            console.log('í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ:', project);
        }

        // í”„ë¡œì íŠ¸ í¼ ì´ˆê¸°í™”
        function clearProjectForm() {
            document.getElementById('project-name-sales').value = '';
            document.getElementById('project-type-sales').selectedIndex = 0;
            document.getElementById('customer-name-sales').value = '';
            document.getElementById('project-start-date-sales').value = '';
            document.getElementById('project-end-date-sales').value = '';
        }

        // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateProjectListDisplay() {
            const tbody = document.getElementById('project-list-body-sales');
            const noProjectsRow = document.getElementById('no-projects-row');
            const countElement = document.getElementById('project-count-sales');
            
            if (salesProjectList.length === 0) {
                if (noProjectsRow) noProjectsRow.style.display = 'table-row';
                if (countElement) countElement.textContent = '0ê°œ';
                return;
            }
            
            if (noProjectsRow) noProjectsRow.style.display = 'none';
            if (countElement) countElement.textContent = `${salesProjectList.length}ê°œ`;
            
            // ê¸°ì¡´ í”„ë¡œì íŠ¸ í–‰ë“¤ ì œê±° (no-projects-row ì œì™¸)
            Array.from(tbody.children).forEach(row => {
                if (row.id !== 'no-projects-row') {
                    row.remove();
                }
            });
            
            // í”„ë¡œì íŠ¸ í–‰ë“¤ ì¶”ê°€
            salesProjectList.forEach(project => {
                const row = document.createElement('tr');
                row.className = 'project-row hover:bg-gray-50';
                
                const bomStatus = project.bomAnalyzed ? 
                    '<span class="text-green-600 font-medium"><i class="fas fa-check mr-1"></i>ì™„ë£Œ</span>' : 
                    '<span class="text-gray-400"><i class="fas fa-minus mr-1"></i>ë¯¸ì™„ë£Œ</span>';
                
                // ğŸ”¥ ìƒíƒœ ì»¬ëŸ¼: BOM + ë“œë¡œì‰ ëª¨ë‘ ì™„ë£Œ ì‹œ "ì™„ë£Œ" í‘œì‹œ
                const statusDisplay = (project.bomAnalyzed && project.drawingLinkedComplete) ? 
                    '<span class="text-green-600 font-medium"><i class="fas fa-check-circle mr-1"></i>ì™„ë£Œ</span>' : 
                    (project.bomAnalyzed ? 
                        '<span class="text-blue-600"><i class="fas fa-hourglass-half mr-1"></i>ì§„í–‰ì¤‘</span>' : 
                        '<span class="text-gray-400"><i class="fas fa-minus mr-1"></i>ëŒ€ê¸°</span>');
                
                row.innerHTML = `
                    <td class="px-3 py-2 border-r text-center">
                        <input type="checkbox" class="project-checkbox w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" 
                               data-project-id="${project.id}" 
                               onchange="updateDeleteButtonState()"
                               onclick="event.stopPropagation()">
                    </td>
                    <td class="px-3 py-2 border-r text-center text-sm font-medium">${project.number}</td>
                    <td class="px-3 py-2 border-r text-sm font-medium">${project.name}</td>
                    <td class="px-3 py-2 border-r text-center text-sm">${project.type}</td>
                    <td class="px-3 py-2 border-r text-sm">${project.customer}</td>
                    <td class="px-3 py-2 border-r text-center text-xs">${project.startDate}</td>
                    <td class="px-3 py-2 border-r text-center text-xs">${project.endDate}</td>
                    <td class="px-3 py-2 border-r text-center text-xs">${bomStatus}</td>
                    <td class="px-3 py-2 border-r text-center text-xs">${statusDisplay}</td>
                    <td class="px-3 py-2 text-center">
                        <button onclick="editProject(${project.id}); event.stopPropagation();" 
                                class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 bg-blue-50 rounded hover:bg-blue-100 transition-colors"
                                title="í”„ë¡œì íŠ¸ ìˆ˜ì •">
                            <i class="fas fa-edit"></i> ìˆ˜ì •
                        </button>
                    </td>
                `;
                
                // ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                row.style.cursor = 'pointer';
                row.addEventListener('dblclick', (e) => {
                    // ì²´í¬ë°•ìŠ¤ë‚˜ ë²„íŠ¼ í´ë¦­ ì‹œì—ëŠ” ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸ ë¬´ì‹œ
                    if (e.target.type === 'checkbox' || e.target.closest('button')) {
                        return;
                    }
                    console.log('âœ… í”„ë¡œì íŠ¸ ë”ë¸”í´ë¦­ë¨:', project.name);
                    selectProjectForAnalysis(project);
                });
                
                // í˜¸ë²„ íš¨ê³¼ë¥¼ ìœ„í•œ ì œëª© ì¶”ê°€
                row.title = `ë”ë¸”í´ë¦­í•˜ì—¬ "${project.name}" í”„ë¡œì íŠ¸ ì‘ì—… ì‹œì‘`;
                
                tbody.appendChild(row);
            });
        }

        // í”„ë¡œì íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateProjectSelectOptions() {
            console.log('í”„ë¡œì íŠ¸ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸:', salesProjectList);
            
            const bomSelect = document.getElementById('project-select-for-bom');
            const drawingSelect = document.getElementById('project-select-for-drawing');
            
            // BOM ì—…ë¡œë“œìš© í”„ë¡œì íŠ¸ ì„ íƒ
            if (bomSelect) {
                bomSelect.innerHTML = '<option value="">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                salesProjectList.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = `${project.name} (${project.customer})`;
                    bomSelect.appendChild(option);
                    console.log('BOM ë“œë¡­ë‹¤ìš´ì— ì¶”ê°€ëœ ì˜µì…˜:', project.id, project.name);
                });
            }
            
            // ë“œë¡œì‰ ì—…ë¡œë“œìš© í”„ë¡œì íŠ¸ ì„ íƒ (BOM ë¶„ì„ ì™„ë£Œëœ ê²ƒë§Œ)
            if (drawingSelect) {
                drawingSelect.innerHTML = '<option value="">í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                salesProjectList.filter(project => project.bomAnalyzed).forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = `${project.name} (${project.customer}) - BOM ë¶„ì„ ì™„ë£Œ`;
                    drawingSelect.appendChild(option);
                });
            }
        }

        // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        function refreshProjectListSales() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedProjects = localStorage.getItem('cswind-sales-projects');
            if (savedProjects) {
                salesProjectList = JSON.parse(savedProjects);
            }
            updateProjectListDisplay();
            updateProjectSelectOptions();
            console.log('í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì „ì²´ í”„ë¡œì íŠ¸ ì„ íƒ/í•´ì œ
        function toggleAllProjectSelection() {
            const selectAllCheckbox = document.getElementById('select-all-projects');
            const projectCheckboxes = document.querySelectorAll('.project-checkbox');
            
            projectCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateDeleteButtonState();
        }

        // ì‚­ì œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateDeleteButtonState() {
            const selectedCheckboxes = document.querySelectorAll('.project-checkbox:checked');
            const deleteButton = document.getElementById('btn-delete-selected-projects');
            const selectedCountSpan = document.getElementById('selected-count');
            const selectAllCheckbox = document.getElementById('select-all-projects');
            
            const selectedCount = selectedCheckboxes.length;
            
            if (selectedCountSpan) {
                selectedCountSpan.textContent = selectedCount;
            }
            
            if (deleteButton) {
                deleteButton.disabled = selectedCount === 0;
            }
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            const allCheckboxes = document.querySelectorAll('.project-checkbox');
            if (selectAllCheckbox && allCheckboxes.length > 0) {
                selectAllCheckbox.checked = selectedCount === allCheckboxes.length;
                selectAllCheckbox.indeterminate = selectedCount > 0 && selectedCount < allCheckboxes.length;
            }
        }

        // ì„ íƒëœ í”„ë¡œì íŠ¸ ì‚­ì œ
        function deleteSelectedProjects() {
            const selectedCheckboxes = document.querySelectorAll('.project-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                alert('ì‚­ì œí•  í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const selectedProjectIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.dataset.projectId));
            const selectedProjects = salesProjectList.filter(p => selectedProjectIds.includes(p.id));
            
            const projectNames = selectedProjects.map(p => `â€¢ ${p.name} (${p.customer})`).join('\n');
            const confirmMessage = `ë‹¤ìŒ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${projectNames}\n\nâš ï¸ ì‚­ì œëœ í”„ë¡œì íŠ¸ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            // ì„ íƒëœ í”„ë¡œì íŠ¸ ì‚­ì œ
            salesProjectList = salesProjectList.filter(p => !selectedProjectIds.includes(p.id));
            
            // í”„ë¡œì íŠ¸ ë²ˆí˜¸ ì¬ì •ë ¬
            salesProjectList.forEach((project, index) => {
                project.number = index + 1;
            });
            
            // localStorageì— ì €ì¥
            saveProjectListToStorage();
            
            // UI ì—…ë°ì´íŠ¸
            updateProjectListDisplay();
            updateProjectSelectOptions();
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ í•´ì œ
            const selectAllCheckbox = document.getElementById('select-all-projects');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
            }
            
            updateDeleteButtonState();
            
            alert(`âœ… ${selectedCheckboxes.length}ê°œì˜ í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            console.log('âœ… í”„ë¡œì íŠ¸ ì‚­ì œ ì™„ë£Œ:', selectedProjectIds);
        }

        // í”„ë¡œì íŠ¸ ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
        function editProject(projectId) {
            const project = salesProjectList.find(p => p.id === projectId);
            
            if (!project) {
                alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('âœï¸ í”„ë¡œì íŠ¸ ìˆ˜ì •:', project.name);
            
            // ìˆ˜ì • ëª¨ë‹¬ ìƒì„± (ë™ì ìœ¼ë¡œ ìƒì„±)
            const modal = document.createElement('div');
            modal.id = 'edit-project-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">
                            <i class="fas fa-edit text-blue-600 mr-2"></i>í”„ë¡œì íŠ¸ ìˆ˜ì •
                        </h3>
                        <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">í”„ë¡œì íŠ¸ëª…</label>
                            <input type="text" id="edit-project-name" value="${project.name}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">í”„ë¡œì íŠ¸ íƒ€ì…</label>
                            <select id="edit-project-type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="TOWER" ${project.type === 'TOWER' ? 'selected' : ''}>TOWER</option>
                                <option value="FOUNDATION" ${project.type === 'FOUNDATION' ? 'selected' : ''}>FOUNDATION</option>
                                <option value="HUB" ${project.type === 'HUB' ? 'selected' : ''}>HUB</option>
                                <option value="ê¸°íƒ€" ${project.type === 'ê¸°íƒ€' ? 'selected' : ''}>ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê³ ê°ì‚¬</label>
                            <input type="text" id="edit-customer-name" value="${project.customer}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì‹œì‘ì¼</label>
                            <input type="date" id="edit-start-date" value="${project.startDate}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì™„ë£Œì¼</label>
                            <input type="date" id="edit-end-date" value="${project.endDate}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeEditModal()" 
                                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors">
                            <i class="fas fa-times mr-1"></i>ì·¨ì†Œ
                        </button>
                        <button onclick="saveProjectEdit(${projectId})" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                            <i class="fas fa-save mr-1"></i>ì €ì¥
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // í”„ë¡œì íŠ¸ ìˆ˜ì • ì €ì¥
        function saveProjectEdit(projectId) {
            const project = salesProjectList.find(p => p.id === projectId);
            
            if (!project) {
                alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const name = document.getElementById('edit-project-name').value.trim();
            const type = document.getElementById('edit-project-type').value;
            const customer = document.getElementById('edit-customer-name').value.trim();
            const startDate = document.getElementById('edit-start-date').value;
            const endDate = document.getElementById('edit-end-date').value;
            
            if (!name || !type || !customer || !startDate || !endDate) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
            project.name = name;
            project.type = type;
            project.customer = customer;
            project.startDate = startDate;
            project.endDate = endDate;
            
            // localStorageì— ì €ì¥
            saveProjectListToStorage();
            
            // UI ì—…ë°ì´íŠ¸
            updateProjectListDisplay();
            updateProjectSelectOptions();
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeEditModal();
            
            alert(`âœ… í”„ë¡œì íŠ¸ "${name}"ì´(ê°€) ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            console.log('âœ… í”„ë¡œì íŠ¸ ìˆ˜ì • ì™„ë£Œ:', project);
        }

        // ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditModal() {
            const modal = document.getElementById('edit-project-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ===== ë„ë©´ ì¡°íšŒ (Find) ê¸°ëŠ¥ =====
        
        let searchResults = [];
        let currentSearchIndex = 0;

        // ë„ë©´ ì¡°íšŒ ëª¨ë‹¬ ì—´ê¸°
        function openDrawingSearchModal() {
            // BOM í…Œì´ë¸”ì´ í‘œì‹œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const bomSection = document.getElementById('basic-bom-analysis-section-sales');
            if (!bomSection || bomSection.classList.contains('hidden')) {
                console.log('âš ï¸ BOM ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ - ë„ë©´ ì¡°íšŒ ë¶ˆê°€');
                return;
            }

            if (!salesBOMData || salesBOMData.length === 0) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }

            const modal = document.getElementById('drawing-search-modal');
            if (modal) {
                modal.classList.remove('hidden');
                // ì²« ë²ˆì§¸ ê²€ìƒ‰ì–´ ì…ë ¥ë€ì— í¬ì»¤ìŠ¤
                setTimeout(() => {
                    const firstInput = document.getElementById('search-value-1');
                    if (firstInput) firstInput.focus();
                }, 100);
            }
            
            console.log('ğŸ” ë„ë©´ ì¡°íšŒ ëª¨ë‹¬ ì—´ë¦¼ (BOM í•­ëª©:', salesBOMData.length, 'ê°œ)');
        }

        // ë„ë©´ ì¡°íšŒ ëª¨ë‹¬ ë‹«ê¸°
        function closeDrawingSearchModal() {
            const modal = document.getElementById('drawing-search-modal');
            if (modal) {
                modal.classList.add('hidden');
            }
            
            // í•˜ì´ë¼ì´íŠ¸ ì œê±°
            clearSearchHighlights();
        }

        // ê²€ìƒ‰ ì¡°ê±´ ì´ˆê¸°í™”
        function clearSearchConditions() {
            for (let i = 1; i <= 3; i++) {
                const field = document.getElementById(`search-field-${i}`);
                const value = document.getElementById(`search-value-${i}`);
                if (field) field.value = '';
                if (value) value.value = '';
            }
            
            const resultInfo = document.getElementById('search-result-info');
            if (resultInfo) resultInfo.textContent = '';
            
            searchResults = [];
            currentSearchIndex = 0;
            clearSearchHighlights();
            
            console.log('ğŸ§¹ ê²€ìƒ‰ ì¡°ê±´ ì´ˆê¸°í™”');
        }

        // ë„ë©´ ê²€ìƒ‰ ì‹¤í–‰
        function executeDrawingSearch() {
            console.log('ğŸ” ë„ë©´ ê²€ìƒ‰ ì‹¤í–‰');
            
            // ê²€ìƒ‰ ì¡°ê±´ ìˆ˜ì§‘
            const conditions = [];
            for (let i = 1; i <= 3; i++) {
                const field = document.getElementById(`search-field-${i}`);
                const value = document.getElementById(`search-value-${i}`);
                
                if (field && value && field.value && value.value.trim()) {
                    conditions.push({
                        field: field.value,
                        value: value.value.trim().toLowerCase()
                    });
                }
            }
            
            if (conditions.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ê²€ìƒ‰ ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('ğŸ“‹ ê²€ìƒ‰ ì¡°ê±´:', conditions);
            
            // BOM ë°ì´í„°ì—ì„œ ê²€ìƒ‰
            searchResults = [];
            salesBOMData.forEach((item, index) => {
                // ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸ (AND ì¡°ê±´)
                const matchesAll = conditions.every(condition => {
                    const itemValue = String(item[condition.field] || '').toLowerCase();
                    return itemValue.includes(condition.value);
                });
                
                if (matchesAll) {
                    searchResults.push({
                        item: item,
                        index: index
                    });
                }
            });
            
            console.log(`âœ… ê²€ìƒ‰ ì™„ë£Œ: ${searchResults.length}ê°œ ê²°ê³¼ ë°œê²¬`);
            
            // ê²°ê³¼ í‘œì‹œ
            const resultInfo = document.getElementById('search-result-info');
            if (resultInfo) {
                if (searchResults.length > 0) {
                    resultInfo.innerHTML = `<span class="text-green-600 font-medium"><i class="fas fa-check-circle mr-1"></i>${searchResults.length}ê°œì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤</span>`;
                } else {
                    resultInfo.innerHTML = `<span class="text-red-600 font-medium"><i class="fas fa-times-circle mr-1"></i>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</span>`;
                }
            }
            
            if (searchResults.length > 0) {
                currentSearchIndex = 0;
                highlightAndScrollToResult(0);
            } else {
                alert('ê²€ìƒ‰ ì¡°ê±´ê³¼ ì¼ì¹˜í•˜ëŠ” í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹¤ìŒ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì´ë™
        function findNextResult() {
            if (searchResults.length === 0) {
                alert('ë¨¼ì € ê²€ìƒ‰ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            currentSearchIndex = (currentSearchIndex + 1) % searchResults.length;
            highlightAndScrollToResult(currentSearchIndex);
            
            console.log(`â¡ï¸ ë‹¤ìŒ ê²°ê³¼ë¡œ ì´ë™: ${currentSearchIndex + 1}/${searchResults.length}`);
        }

        // ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸ ë° ìŠ¤í¬ë¡¤
        function highlightAndScrollToResult(index) {
            if (!searchResults[index]) {
                console.error('âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ê²€ìƒ‰ ê²°ê³¼ ì¸ë±ìŠ¤:', index);
                return;
            }
            
            const result = searchResults[index];
            const item = result.item;
            
            // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            clearSearchHighlights();
            
            // í•´ë‹¹ í•­ëª©ì´ ë³´ì´ë„ë¡ í™•ì¥
            expandParentsToShowItem(item);
            
            // BOM í…Œì´ë¸” ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            displayBOMTableSales();
            
            // ì ì‹œ ëŒ€ê¸° í›„ ìŠ¤í¬ë¡¤ ë° í•˜ì´ë¼ì´íŠ¸
            setTimeout(() => {
                const row = document.getElementById(`row-${item.id}`);
                if (row) {
                    // ê°•ë ¬í•œ í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€ (CSSë¡œ ìŠ¤íƒ€ì¼ ìë™ ì ìš©)
                    row.setAttribute('data-search-highlight', 'true');
                    
                    // í™”ë©´ ì¤‘ì•™ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // ê²°ê³¼ ì •ë³´ ì—…ë°ì´íŠ¸
                    const resultInfo = document.getElementById('search-result-info');
                    if (resultInfo) {
                        resultInfo.innerHTML = `<span class="text-orange-600 font-bold"><i class="fas fa-search-location mr-1"></i>${index + 1} / ${searchResults.length}</span>`;
                    }
                    
                    console.log(`âœ… ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ: ${item.number} (${index + 1}/${searchResults.length})`);
                } else {
                    console.error('âŒ í–‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', item.id);
                }
            }, 100);
        }

        // ìƒìœ„ í•­ëª©ë“¤ì„ í¼ì³ì„œ í•­ëª©ì´ ë³´ì´ë„ë¡ í•¨
        function expandParentsToShowItem(item) {
            // ë¶€ëª¨ë¥¼ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ë©° ëª¨ë‘ í¼ì¹¨
            let parent = item.parent;
            while (parent) {
                // ë¶€ëª¨ì˜ ëª¨ë“  ìì‹ì„ í‘œì‹œ
                parent.children.forEach(child => {
                    child.isVisible = true;
                });
                parent = parent.parent;
            }
            
            // í•´ë‹¹ í•­ëª© ìì²´ë„ í‘œì‹œ
            item.isVisible = true;
        }

        // ê²€ìƒ‰ í•˜ì´ë¼ì´íŠ¸ ì œê±°
        function clearSearchHighlights() {
            const highlightedRows = document.querySelectorAll('[data-search-highlight="true"]');
            highlightedRows.forEach(row => {
                row.classList.remove('bg-yellow-200', 'border-4', 'border-yellow-500');
                row.removeAttribute('data-search-highlight');
            });
        }

        // ===== ëª¨ë‹¬ ë“œë˜ê·¸ & ë¦¬ì‚¬ì´ì¦ˆ ê¸°ëŠ¥ =====
        
        function makeDraggable(modalId, headerId) {
            const modal = document.getElementById(modalId);
            const header = document.getElementById(headerId);
            
            if (!modal || !header) return;
            
            let isDragging = false;
            let currentX, currentY, initialX, initialY;
            
            header.addEventListener('mousedown', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'I') return;
                
                isDragging = true;
                initialX = e.clientX - modal.offsetLeft;
                initialY = e.clientY - modal.offsetTop;
                
                header.style.cursor = 'grabbing';
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì œí•œ
                const maxX = window.innerWidth - modal.offsetWidth;
                const maxY = window.innerHeight - modal.offsetHeight;
                
                currentX = Math.max(0, Math.min(currentX, maxX));
                currentY = Math.max(0, Math.min(currentY, maxY));
                
                modal.style.left = currentX + 'px';
                modal.style.top = currentY + 'px';
                modal.style.right = 'auto';
                modal.style.bottom = 'auto';
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    header.style.cursor = 'move';
                }
            });
        }
        
        // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ë“œë˜ê·¸ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            makeDraggable('drawing-search-window', 'drawing-search-header');
            makeDraggable('pdf-modal-window', 'pdf-modal-header-drag');
        });

        // Ctrl+F í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('keydown', function(event) {
            // Ctrl+F ë˜ëŠ” Cmd+F (Mac)
            if ((event.ctrlKey || event.metaKey) && event.key === 'f') {
                // BOM ë¶„ì„ ì„¹ì…˜ì´ í‘œì‹œë˜ì–´ ìˆì„ ë•Œë§Œ ì‘ë™
                const bomSection = document.getElementById('basic-bom-analysis-section-sales');
                if (bomSection && !bomSection.classList.contains('hidden')) {
                    event.preventDefault(); // ë¸Œë¼ìš°ì € ê¸°ë³¸ Find ê¸°ëŠ¥ ë¹„í™œì„±í™”
                    openDrawingSearchModal();
                }
            }
            
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            if (event.key === 'Escape') {
                const modal = document.getElementById('drawing-search-modal');
                if (modal && !modal.classList.contains('hidden')) {
                    closeDrawingSearchModal();
                }
            }
            
            // Enter í‚¤ë¡œ ë‹¤ìŒ ê²°ê³¼ ì°¾ê¸° (ëª¨ë‹¬ ë‚´ì—ì„œ)
            if (event.key === 'Enter') {
                const modal = document.getElementById('drawing-search-modal');
                if (modal && !modal.classList.contains('hidden')) {
                    event.preventDefault();
                    
                    // ê²€ìƒ‰ì–´ ì…ë ¥ë€ì— í¬ì»¤ìŠ¤ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰ ì‹¤í–‰
                    const activeElement = document.activeElement;
                    if (activeElement && activeElement.id && activeElement.id.startsWith('search-value-')) {
                        executeDrawingSearch();
                    } else {
                        // ê·¸ ì™¸ì—ëŠ” ë‹¤ìŒ ê²°ê³¼ë¡œ ì´ë™
                        findNextResult();
                    }
                }
            }
        });

        // BOM íŒŒì¼ ì„ íƒ ì²˜ë¦¬ (SalesíŒ€)
        document.addEventListener('DOMContentLoaded', function() {
            // ì›Œí¬í”Œë¡œìš° ë‚´ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë“±ë¡
            console.log('ğŸ”§ ì›Œí¬í”Œë¡œìš° ì´ë²¤íŠ¸ ë“±ë¡ ì‹œì‘');
            
            // ìƒˆ í”„ë¡œì íŠ¸ ë²„íŠ¼
            const newProjectBtn = document.getElementById('btn-new-project');
            if (newProjectBtn) {
                newProjectBtn.addEventListener('click', () => {
                    console.log('âœ… ìƒˆ í”„ë¡œì íŠ¸ ë²„íŠ¼ í´ë¦­ë¨');
                    showWorkflowStep('step-new-project');
                });
                console.log('âœ… ìƒˆ í”„ë¡œì íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ');
            } else {
                console.error('âŒ ìƒˆ í”„ë¡œì íŠ¸ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ë“¤
            const backToListBtn = document.getElementById('btn-back-to-list');
            if (backToListBtn) {
                backToListBtn.addEventListener('click', () => {
                    console.log('âœ… ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ë¨');
                    showWorkflowStep('step-project-list');
                });
                console.log('âœ… ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ');
            }
            
            const backToListFromAnalysisBtn = document.getElementById('btn-back-to-list-from-analysis');
            if (backToListFromAnalysisBtn) {
                backToListFromAnalysisBtn.addEventListener('click', () => {
                    console.log('âœ… ë¶„ì„ í™”ë©´ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ë¨');
                    selectedProjectForAnalysis = null;
                    showWorkflowStep('step-project-list');
                });
                console.log('âœ… ë¶„ì„ í™”ë©´ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ');
            }
            
            // ì´ˆê¸° ë¡œë“œ ì‹œ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ í™”ë©´ í‘œì‹œ
            showWorkflowStep('step-project-list');
            console.log('âœ… ì›Œí¬í”Œë¡œìš° ì´ˆê¸°í™” ì™„ë£Œ');
            
            const bomFileInput = document.getElementById('bom-file-input-sales');
            const drawingInput = document.getElementById('drawing-package-input-sales');
            
            if (bomFileInput) {
                bomFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('bom-file-name-sales').textContent = file.name;
                        document.getElementById('bom-file-size-sales').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                        document.getElementById('selected-bom-file-info-sales').classList.remove('hidden');
                        
                        // ë²„íŠ¼ ì‹œê°ì  ê°•ì¡°
                        const bomBtn = document.getElementById('upload-bom-btn-sales');
                        if (bomBtn) {
                            bomBtn.classList.add('ring-2', 'ring-blue-300', 'ring-offset-2');
                            bomBtn.style.animation = 'pulse 2s infinite';
                        }
                        
                        console.log('âœ… BOM íŒŒì¼ ì„ íƒë¨:', file.name);
                    }
                });
            }
            
            // BOM í”„ë¡œì íŠ¸ ì„ íƒ ì²˜ë¦¬
            const bomProjectSelect = document.getElementById('project-select-for-bom');
            if (bomProjectSelect) {
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                bomProjectSelect.removeEventListener('change', bomProjectSelect._changeHandler);
                
                const changeHandler = function(e) {
                    const uploadSection = document.getElementById('bom-upload-section');
                    const selectedProjectId = e.target.value;
                    
                    console.log('ğŸ”„ BOM í”„ë¡œì íŠ¸ ì„ íƒ ì´ë²¤íŠ¸ ë°œìƒ:', {
                        timestamp: new Date().toLocaleTimeString(),
                        selectedProjectId: selectedProjectId,
                        selectedProjectIdType: typeof selectedProjectId,
                        eventTarget: e.target,
                        eventTargetValue: e.target.value,
                        salesProjectList: salesProjectList,
                        projectCount: salesProjectList.length,
                        allOptions: Array.from(e.target.options).map(opt => ({value: opt.value, text: opt.textContent, selected: opt.selected}))
                    });
                    
                    if (selectedProjectId && selectedProjectId !== '') {
                        uploadSection.classList.remove('hidden');
                        
                        // ì„ íƒëœ í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
                        const project = salesProjectList.find(p => p.id == selectedProjectId);
                        if (project) {
                            console.log('âœ… ì„ íƒëœ í”„ë¡œì íŠ¸ ì •ë³´:', project);
                            // ì„ íƒ ìƒíƒœ ì €ì¥ (ê¸€ë¡œë²Œ ë³€ìˆ˜ë¡œ)
                            window.selectedBOMProject = project;
                        } else {
                            console.log('âŒ í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', selectedProjectId);
                        }
                    } else {
                        uploadSection.classList.add('hidden');
                        window.selectedBOMProject = null;
                        // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
                        if (bomFileInput) {
                            bomFileInput.value = '';
                            document.getElementById('selected-bom-file-info-sales').classList.add('hidden');
                            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ìœ ì§€
                        }
                    }
                };
                
                bomProjectSelect._changeHandler = changeHandler;
                bomProjectSelect.addEventListener('change', changeHandler);
                console.log('âœ… BOM í”„ë¡œì íŠ¸ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
            }

            if (drawingInput) {
                drawingInput.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    if (files.length > 0) {
                        document.getElementById('drawing-folder-name-sales').textContent = `ë“œë¡œì‰ íŒ¨í‚¤ì§€ (${files.length}ê°œ íŒŒì¼)`;
                        document.getElementById('drawing-file-count-sales').textContent = `PDF íŒŒì¼ ${files.length}ê°œ ì„ íƒë¨`;
                        document.getElementById('selected-drawing-info-sales').classList.remove('hidden');
                        
                        // ë²„íŠ¼ ì‹œê°ì  ê°•ì¡°
                        const drawingBtn = document.getElementById('upload-drawings-btn-sales');
                        if (drawingBtn) {
                            drawingBtn.classList.add('ring-2', 'ring-orange-300', 'ring-offset-2');
                            drawingBtn.style.animation = 'pulse 2s infinite';
                        }
                        
                        console.log('âœ… ë“œë¡œì‰ íŒŒì¼ë“¤ ì„ íƒë¨:', files.length, 'ê°œ');
                    }
                });
            }
            
            // ë“œë¡œì‰ í”„ë¡œì íŠ¸ ì„ íƒ ì²˜ë¦¬
            const drawingProjectSelect = document.getElementById('project-select-for-drawing');
            if (drawingProjectSelect) {
                drawingProjectSelect.addEventListener('change', function(e) {
                    const uploadSection = document.getElementById('drawing-upload-section');
                    if (e.target.value) {
                        uploadSection.classList.remove('hidden');
                    } else {
                        uploadSection.classList.add('hidden');
                        // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
                        if (drawingInput) {
                            drawingInput.value = '';
                            document.getElementById('selected-drawing-info-sales').classList.add('hidden');
                            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ìœ ì§€
                        }
                    }
                });
            }

            // Prod. Tech í”„ë¡œì íŠ¸ ì„ íƒ ì²˜ë¦¬
            const prodTechSelect = document.getElementById('project-select-prodtech');
            if (prodTechSelect) {
                prodTechSelect.addEventListener('change', function(e) {
                    const selectedValue = e.target.value;
                    const selectedText = e.target.options[e.target.selectedIndex].text;
                    
                    if (selectedValue) {
                        // í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
                        document.getElementById('project-info-content-prodtech').innerHTML = `
                            <div class="text-sm space-y-1">
                                <div><strong>í”„ë¡œì íŠ¸:</strong> ${selectedText}</div>
                                <div><strong>ìƒíƒœ:</strong> <span class="text-green-600">BOM ë¶„ì„ ì™„ë£Œ</span></div>
                                <div><strong>ë“±ë¡ì¼:</strong> ${new Date().toLocaleDateString('ko-KR')}</div>
                                <div><strong>SalesíŒ€ ë‹´ë‹¹:</strong> ê¹€ì˜ì—… ê³¼ì¥</div>
                            </div>
                        `;
                        document.getElementById('selected-project-info-prodtech').classList.remove('hidden');
                        
                        // ë„ë©´ íŒ¨í‚¤ì§€ ëª©ë¡ í‘œì‹œ
                        showDrawingPackageListProdTech();
                        
                        // AI ë¶„ì„ ë²„íŠ¼ í™œì„±í™”
                        document.getElementById('btn-ai-mto-generation').disabled = false;
                    } else {
                        document.getElementById('selected-project-info-prodtech').classList.add('hidden');
                        document.getElementById('drawing-package-list-prodtech').classList.add('hidden');
                        document.getElementById('btn-ai-mto-generation').disabled = true;
                    }
                });
            }
            
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closePDFModal();
                }
            });
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
            const pdfModal = document.getElementById('pdf-modal');
            if (pdfModal) {
                pdfModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closePDFModal();
                    }
                });
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ í”„ë¡œì íŠ¸ ë°ì´í„° ë³µì›
            setTimeout(() => {
                initializeSalesProjectData();
            }, 100);

            console.log('SalesíŒ€ ë° Prod. TechíŒ€ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // SalesíŒ€ í”„ë¡œì íŠ¸ ë°ì´í„° ì´ˆê¸°í™”
        function initializeSalesProjectData() {
            try {
                // ğŸ”¥ localStorage ì´ˆê¸°í™” ì œê±° - ê¸°ì¡´ ë°ì´í„° ìœ ì§€
                // ğŸ”¥ ë””ë²„ê¹…ìš© ìƒ˜í”Œ í”„ë¡œì íŠ¸ ìƒì„± ì œê±°
                
                const savedProjects = localStorage.getItem('cswind-sales-projects');
                if (savedProjects) {
                    salesProjectList = JSON.parse(savedProjects);
                    
                    // ğŸ”¥ ë””ë²„ê¹…ìš© ìƒ˜í”Œ í”„ë¡œì íŠ¸ ìë™ ì œê±°
                    const beforeCount = salesProjectList.length;
                    salesProjectList = salesProjectList.filter(p => 
                        p.id !== 'debug-excel-project' && 
                        !p.name?.includes('ë””ë²„ê¹…') && 
                        !p.customer?.includes('ë””ë²„ê¹…')
                    );
                    
                    if (beforeCount !== salesProjectList.length) {
                        console.log(`ğŸ—‘ï¸ ë””ë²„ê¹… ìƒ˜í”Œ í”„ë¡œì íŠ¸ ì œê±°: ${beforeCount} â†’ ${salesProjectList.length}ê°œ`);
                        // localStorageì— ì¦‰ì‹œ ì €ì¥í•˜ì—¬ ë””ë²„ê¹… í”„ë¡œì íŠ¸ ì˜êµ¬ ì œê±°
                        saveProjectListToStorage();
                    }
                    
                    console.log('ê¸°ì¡´ í”„ë¡œì íŠ¸ ë°ì´í„° ë³µì›ë¨:', salesProjectList.length, 'ê°œ');
                } else {
                    salesProjectList = [];
                    console.log('ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì‹œì‘ - ë¹ˆ ë°°ì—´ ì´ˆê¸°í™”');
                }

                

                

                
                // UI ì´ˆê¸°í™”
                updateProjectListDisplay();
                updateProjectSelectOptions();
                
                // ê°œë°œ ë‹¨ê³„ì—ì„œ ë””ë²„ê·¸ ì„¹ì…˜ í‘œì‹œ
                const debugSection = document.getElementById('debug-test-section');
                if (debugSection) {
                    debugSection.style.display = 'block';
                }
                
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ë°ì´í„° ë³µì› ì‹¤íŒ¨:', error);
                salesProjectList = [];
            }
        }
        
        // ê°œë°œìš©: ëª¨ë“  í”„ë¡œì íŠ¸ ë°ì´í„° ì´ˆê¸°í™”
        function resetAllProjectData() {
            if (confirm('ëª¨ë“  í”„ë¡œì íŠ¸ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('cswind-sales-projects');
                salesProjectList = [];
                updateProjectListDisplay();
                updateProjectSelectOptions();
                alert('ëª¨ë“  í”„ë¡œì íŠ¸ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.log('í”„ë¡œì íŠ¸ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
            }
        }
        
        // ë””ë²„ê·¸ìš©: í˜„ì¬ ìƒíƒœ í™•ì¸
        function debugCurrentState() {
            const projectSelect = document.getElementById('project-select-for-bom');
            console.log('=== í˜„ì¬ ìƒíƒœ ë””ë²„ê·¸ ===');
            console.log('salesProjectList:', salesProjectList);
            console.log('projectSelect element:', projectSelect);
            console.log('projectSelect value:', projectSelect ? projectSelect.value : 'null');
            console.log('projectSelect options:', projectSelect ? Array.from(projectSelect.options).map(opt => ({value: opt.value, text: opt.textContent})) : 'null');
            console.log('window.selectedBOMProject:', window.selectedBOMProject);
        }

        /* ë³µì¡í•œ BOM íŒŒì‹± ë¡œì§ ì„ì‹œ ì£¼ì„ ì²˜ë¦¬
                    for (const sheetName of workbook.SheetNames) {
                        if (sheetName.toLowerCase().includes('full') && sheetName.toLowerCase().includes('bom')) {
                            targetSheetName = sheetName;
                            break;
                        }
                    }
                    
                    if (!targetSheetName) {
                        // Full BOMì´ ì—†ìœ¼ë©´ BOMì´ í¬í•¨ëœ ì‹œíŠ¸ ì°¾ê¸°
                        for (const sheetName of workbook.SheetNames) {
                            if (sheetName.toLowerCase().includes('bom')) {
                                targetSheetName = sheetName;
                                break;
                            }
                        }
                    }
                    
                    if (!targetSheetName) {
                        alert('Full BOM ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì‚¬ìš© ê°€ëŠ¥í•œ ì‹œíŠ¸: ' + workbook.SheetNames.join(', '));
                        return;
                    }
                    
                    console.log('âœ… ì„ íƒëœ ì‹œíŠ¸:', targetSheetName);
                    
                    const worksheet = workbook.Sheets[targetSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    console.log('ğŸ“Š Full BOM ë°ì´í„° íŒŒì‹± ì™„ë£Œ:', jsonData.length, 'í–‰');
                    
                    if (jsonData.length < 2) {
                        alert('Full BOM ì‹œíŠ¸ì— ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    // BOM ë°ì´í„° ë³€í™˜
                    const bomTreeData = parseBOMDataFromFullBOM(jsonData, project);
                    
                    if (bomTreeData.length === 0) {
                        alert('Full BOM ë°ì´í„°ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„° í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    console.log('ğŸŒ² Full BOM íŠ¸ë¦¬ ë°ì´í„° ìƒì„± ì™„ë£Œ:', bomTreeData.length, 'ê°œ ì•„ì´í…œ');
                    
                    // í”„ë¡œì íŠ¸ì— BOM ë¶„ì„ ìƒíƒœë§Œ ì €ì¥ (ì „ì²´ ë°ì´í„°ëŠ” ë©”ëª¨ë¦¬ì—ë§Œ ë³´ê´€)
                    project.bomAnalyzed = true;
                    project.bomItemCount = bomTreeData.length; // ì•„ì´í…œ ê°œìˆ˜ë§Œ ì €ì¥
                    project.bomAnalyzedAt = new Date().toISOString();
                    
                    // BOM ë°ì´í„°ëŠ” ì „ì—­ ë³€ìˆ˜ë¡œë§Œ ê´€ë¦¬ (localStorage ìš©ëŸ‰ ì ˆì•½)
                    window.currentProjectBOMData = {
                        projectId: project.id,
                        data: bomTreeData,
                        analyzedAt: project.bomAnalyzedAt
                    };
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸ (BOM ë°ì´í„° ì œì™¸)
                    try {
                        saveProjectListToStorage();
                        console.log('âœ… í”„ë¡œì íŠ¸ ì •ë³´ localStorage ì €ì¥ ì™„ë£Œ');
                    } catch (error) {
                        console.warn('âš ï¸ localStorage ì €ì¥ ì‹¤íŒ¨, ë©”ëª¨ë¦¬ ëª¨ë“œë¡œ ë™ì‘:', error.message);
                        // localStorage ì‹¤íŒ¨í•´ë„ ê¸°ëŠ¥ì€ ê³„ì† ë™ì‘í•˜ë„ë¡ í•¨
                    }
                    
                    // UI ì—…ë°ì´íŠ¸
                    updateProjectListDisplay();
                    updateProjectSelectOptions();
                    
                    // ê¸°ì¡´ BOM íŠ¸ë¦¬ ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ (ëª¨ë“  ê¸°ëŠ¥ í¬í•¨)
                    console.log('ğŸ” ë Œë”ë§ í•¨ìˆ˜ í™•ì¸:', typeof window.renderBasicBOMTreeTable);
                    console.log('ğŸ” BOM ë°ì´í„° í™•ì¸:', bomTreeData.length, 'ê°œ ì•„ì´í…œ');
                    console.log('ğŸ” ì²« ë²ˆì§¸ BOM ì•„ì´í…œ:', bomTreeData[0]);
                    
                    // í…Œì´ë¸” ìš”ì†Œ ì¡´ì¬ í™•ì¸
                    const targetTable = document.getElementById('bom-tree-body-sales');
                    console.log('ğŸ” ëŒ€ìƒ í…Œì´ë¸” ìš”ì†Œ í™•ì¸:', targetTable ? 'ì¡´ì¬í•¨' : 'ì¡´ì¬í•˜ì§€ ì•ŠìŒ');
                    
                    if (window.renderBasicBOMTreeTable) {
                        console.log('âœ… window.renderBasicBOMTreeTable í•¨ìˆ˜ ë°œê²¬, ë Œë”ë§ ì‹œì‘...');
                        try {
                            // SalesíŒ€ìš© í…Œì´ë¸”ì— ë Œë”ë§
                            window.renderBasicBOMTreeTable(bomTreeData, 'bom-tree-body-sales');
                            console.log('âœ… BOM íŠ¸ë¦¬ ë Œë”ë§ ì™„ë£Œ');
                        } catch (renderError) {
                            console.error('âŒ BOM íŠ¸ë¦¬ ë Œë”ë§ ì¤‘ ì˜¤ë¥˜:', renderError);
                            alert('BOM íŠ¸ë¦¬ ë Œë”ë§ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + renderError.message);
                        }
                    } else {
                        console.log('âŒ window.renderBasicBOMTreeTable í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, í•¨ìˆ˜ ì§ì ‘ ë“±ë¡ ì‹œë„...');
                        
                        // í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ ì ì‹œ í›„ ì¬ì‹œë„
                        setTimeout(() => {
                            if (window.renderBasicBOMTreeTable) {
                                console.log('âœ… ì§€ì—° í›„ í•¨ìˆ˜ ë°œê²¬, ë Œë”ë§ ì‹œì‘...');
                                window.renderBasicBOMTreeTable(bomTreeData, 'bom-tree-body-sales');
                            } else {
                                console.log('âŒ ì—¬ì „íˆ í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, ë°±ì—… í•¨ìˆ˜ ì‚¬ìš©');
                                renderBOMTreeSalesTeam(bomTreeData);
                            }
                        }, 500);
                    }
                    
                    // ğŸ”¥ BOM ë¶„ì„ ì™„ë£Œ alert ì œê±° - ì½˜ì†” ë¡œê·¸ë§Œ ìœ ì§€
                    console.log(`âœ… BOM ë¶„ì„ ì™„ë£Œ: ${bomTreeData.length}ê°œ ì•„ì´í…œ`);
                    
                } catch (error) {
                    console.error('âŒ Full BOM íŒŒì¼ ë¶„ì„ ì¤‘ ì˜¤ë¥˜:', error);
                    alert('Full BOM íŒŒì¼ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            
            reader.onerror = function() {
                console.error('âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜');
                alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            };
            
            console.log('ğŸ“– íŒŒì¼ ì½ê¸° ì‹œì‘:', file.name);
            reader.readAsArrayBuffer(file);
        */ // ë³µì¡í•œ BOM íŒŒì‹± ë¡œì§ ì£¼ì„ ì²˜ë¦¬ ë

        // SalesíŒ€ BOM íŠ¸ë¦¬ ë Œë”ë§ í•¨ìˆ˜
        function renderBOMTreeSalesTeam(bomData) {
            console.log('SalesíŒ€ BOM íŠ¸ë¦¬ ë Œë”ë§ ì‹œì‘:', bomData.length, 'ê°œ ì•„ì´í…œ');
            
            // BOM ë¶„ì„ ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('basic-bom-analysis-section-sales').classList.remove('hidden');
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('total-items-sales').textContent = bomData.length;
            document.getElementById('visible-items-sales').textContent = bomData.length;
            document.getElementById('max-depth-sales').textContent = Math.max(...bomData.map(item => item.depth || 0));
            document.getElementById('parent-items-sales').textContent = bomData.filter(item => (item.depth || 0) === 0).length;
            
            // í…Œì´ë¸” ë³¸ë¬¸ì— ë°ì´í„° ë Œë”ë§
            const tbody = document.getElementById('bom-tree-body-sales');
            tbody.innerHTML = '';
            
            bomData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'project-row hover:bg-gray-50';
                
                const depth = item.depth || 0;
                const indent = 'ã€€'.repeat(depth * 2); // ì „ê° ê³µë°±ìœ¼ë¡œ ë“¤ì—¬ì“°ê¸°
                
                row.innerHTML = `
                    <td class="px-2 py-2 border-r text-xs text-center">${depth}</td>
                    <td class="px-2 py-2 border-r text-xs">${indent}${item.name || '-'}</td>
                    <td class="px-2 py-2 border-r text-xs font-mono">${item.number || '-'}</td>
                    <td class="px-2 py-2 border-r text-xs">${item.version || '-'}</td>
                    <td class="px-2 py-2 border-r text-xs">${item.findNumber || '-'}</td>
                    <td class="px-2 py-2 border-r text-xs text-right">${item.quantity || '-'}</td>
                    <td class="px-2 py-2 border-r text-xs">${item.unit || '-'}</td>
                    <td class="px-2 py-2 border-r text-xs text-right">${item.weight || '-'}</td>
                    <td class="px-2 py-2 border-r text-xs">${item.material || '-'}</td>
                    <td class="px-2 py-2 text-center text-xs">
                        <span class="text-gray-400 text-xs">ë“œë¡œì‰ ëŒ€ê¸°</span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log('âœ… SalesíŒ€ BOM íŠ¸ë¦¬ ë Œë”ë§ ì™„ë£Œ');
        }


        
        // SalesíŒ€ ì „ìš© ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ (ë‹¨ìˆœ ë²„ì „)
        // ì „ì²´ í¼ì¹˜ê¸° í•¨ìˆ˜
        function expandAllTreeRowsSales() {
            console.log('SalesíŒ€: ì „ì²´ íŠ¸ë¦¬ í¼ì¹˜ê¸°');
            
            if (!window.processedBasicTreeData) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const tableId = 'bom-tree-body-sales';
            const allRows = document.querySelectorAll(`#${tableId} tr`);
            let expandedCount = 0;
            
            // ëª¨ë“  í–‰ì„ í‘œì‹œ
            allRows.forEach(row => {
                if (row.classList.contains('hidden-tree-row')) {
                    row.classList.remove('hidden-tree-row');
                    expandedCount++;
                }
            });
            
            // ëª¨ë“  í† ê¸€ ì•„ì´ì½˜ì„ í¼ì¹¨ ìƒíƒœë¡œ ë³€ê²½
            const toggleIcons = document.querySelectorAll(`#${tableId} .tree-toggle-icon`);
            toggleIcons.forEach(icon => {
                icon.setAttribute('data-expanded', 'true');
                icon.textContent = 'â–¼';
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (window.updateBasicTreeStatistics) {
                window.updateBasicTreeStatistics();
            }
            
            console.log(`âœ… ì „ì²´ í¼ì¹˜ê¸° ì™„ë£Œ: ${expandedCount}ê°œ í–‰ì´ í‘œì‹œë¨`);
        }
        
        // ì „ì²´ ì ‘ê¸° í•¨ìˆ˜
        function collapseAllTreeRowsSales() {
            console.log('SalesíŒ€: ì „ì²´ íŠ¸ë¦¬ ì ‘ê¸°');
            
            if (!window.processedBasicTreeData) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const tableId = 'bom-tree-body-sales';
            const allRows = document.querySelectorAll(`#${tableId} tr`);
            let collapsedCount = 0;
            
            // Depth 0ì´ ì•„ë‹Œ ëª¨ë“  í–‰ì„ ìˆ¨ê¹€
            allRows.forEach((row, index) => {
                const depth = parseInt(row.getAttribute('data-level') || 0);
                if (depth > 0) {
                    row.classList.add('hidden-tree-row');
                    collapsedCount++;
                }
            });
            
            // ëª¨ë“  í† ê¸€ ì•„ì´ì½˜ì„ ì ‘í˜ ìƒíƒœë¡œ ë³€ê²½
            const toggleIcons = document.querySelectorAll(`#${tableId} .tree-toggle-icon`);
            toggleIcons.forEach(icon => {
                icon.setAttribute('data-expanded', 'false');
                icon.textContent = 'â–¶';
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (window.updateBasicTreeStatistics) {
                window.updateBasicTreeStatistics();
            }
            
            console.log(`âœ… ì „ì²´ ì ‘ê¸° ì™„ë£Œ: ${collapsedCount}ê°œ í–‰ì´ ìˆ¨ê¹€ë¨`);
        }
        
        // ë ˆë²¨ë³„ í¼ì¹˜ê¸° í•¨ìˆ˜
        function expandToLevelSales(maxLevel) {
            console.log(`SalesíŒ€: ë ˆë²¨ ${maxLevel}ê¹Œì§€ í¼ì¹˜ê¸°`);
            
            if (!window.processedBasicTreeData) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const tableId = 'bom-tree-body-sales';
            const allRows = document.querySelectorAll(`#${tableId} tr`);
            let shownCount = 0;
            let hiddenCount = 0;
            
            // ëª¨ë“  í–‰ì„ ìˆœíšŒí•˜ë©° ë ˆë²¨ì— ë”°ë¼ í‘œì‹œ/ìˆ¨ê¹€
            allRows.forEach((row, index) => {
                const depth = parseInt(row.getAttribute('data-level') || 0);
                
                if (depth <= maxLevel) {
                    // maxLevel ì´í•˜ëŠ” í‘œì‹œ
                    if (row.classList.contains('hidden-tree-row')) {
                        row.classList.remove('hidden-tree-row');
                        shownCount++;
                    }
                } else {
                    // maxLevel ì´ˆê³¼ëŠ” ìˆ¨ê¹€
                    if (!row.classList.contains('hidden-tree-row')) {
                        row.classList.add('hidden-tree-row');
                        hiddenCount++;
                    }
                }
            });
            
            // í† ê¸€ ì•„ì´ì½˜ ìƒíƒœ ì—…ë°ì´íŠ¸
            window.processedBasicTreeData.forEach((item, index) => {
                if (item.isParent) {
                    const row = document.getElementById(item.rowId);
                    if (row) {
                        const toggleIcon = row.querySelector('.tree-toggle-icon');
                        if (toggleIcon) {
                            // í˜„ì¬ í•­ëª©ì˜ depthê°€ maxLevelë³´ë‹¤ ì‘ê³ , í•˜ìœ„ì— í‘œì‹œë˜ëŠ” í•­ëª©ì´ ìˆìœ¼ë©´ í¼ì¹¨ ìƒíƒœ
                            const hasVisibleChildren = window.processedBasicTreeData.some((childItem, childIndex) => 
                                childIndex > index && 
                                childItem.depth > item.depth && 
                                childItem.depth <= maxLevel
                            );
                            
                            if (item.depth < maxLevel && hasVisibleChildren) {
                                toggleIcon.setAttribute('data-expanded', 'true');
                                toggleIcon.textContent = 'â–¼';
                            } else {
                                toggleIcon.setAttribute('data-expanded', 'false');
                                toggleIcon.textContent = 'â–¶';
                            }
                        }
                    }
                }
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (window.updateBasicTreeStatistics) {
                window.updateBasicTreeStatistics();
            }
            
            console.log(`âœ… ë ˆë²¨ ${maxLevel} í¼ì¹˜ê¸° ì™„ë£Œ: ${shownCount}ê°œ í–‰ í‘œì‹œ, ${hiddenCount}ê°œ í–‰ ìˆ¨ê¹€`);
        }
        
        // Prod.TechíŒ€ìš© ì „ì²´ í¼ì¹˜ê¸° í•¨ìˆ˜
        function expandAllTreeRows() {
            console.log('Prod.TechíŒ€: ì „ì²´ íŠ¸ë¦¬ í¼ì¹˜ê¸°');
            
            if (!window.processedBasicTreeData) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const tableId = 'bom-tree-body';
            const allRows = document.querySelectorAll(`#${tableId} tr`);
            let expandedCount = 0;
            
            // ëª¨ë“  í–‰ì„ í‘œì‹œ
            allRows.forEach(row => {
                if (row.classList.contains('hidden-tree-row')) {
                    row.classList.remove('hidden-tree-row');
                    expandedCount++;
                }
            });
            
            // ëª¨ë“  í† ê¸€ ì•„ì´ì½˜ì„ í¼ì¹¨ ìƒíƒœë¡œ ë³€ê²½
            const toggleIcons = document.querySelectorAll(`#${tableId} .tree-toggle-icon`);
            toggleIcons.forEach(icon => {
                icon.setAttribute('data-expanded', 'true');
                icon.textContent = 'â–¼';
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (window.updateBasicTreeStatistics) {
                window.updateBasicTreeStatistics();
            }
            
            console.log(`âœ… ì „ì²´ í¼ì¹˜ê¸° ì™„ë£Œ: ${expandedCount}ê°œ í–‰ì´ í‘œì‹œë¨`);
        }
        
        // Prod.TechíŒ€ìš© ì „ì²´ ì ‘ê¸° í•¨ìˆ˜
        function collapseAllTreeRows() {
            console.log('Prod.TechíŒ€: ì „ì²´ íŠ¸ë¦¬ ì ‘ê¸°');
            
            if (!window.processedBasicTreeData) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const tableId = 'bom-tree-body';
            const allRows = document.querySelectorAll(`#${tableId} tr`);
            let collapsedCount = 0;
            
            // Depth 0ì´ ì•„ë‹Œ ëª¨ë“  í–‰ì„ ìˆ¨ê¹€
            allRows.forEach((row, index) => {
                const depth = parseInt(row.getAttribute('data-level') || 0);
                if (depth > 0) {
                    row.classList.add('hidden-tree-row');
                    collapsedCount++;
                }
            });
            
            // ëª¨ë“  í† ê¸€ ì•„ì´ì½˜ì„ ì ‘í˜ ìƒíƒœë¡œ ë³€ê²½
            const toggleIcons = document.querySelectorAll(`#${tableId} .tree-toggle-icon`);
            toggleIcons.forEach(icon => {
                icon.setAttribute('data-expanded', 'false');
                icon.textContent = 'â–¶';
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (window.updateBasicTreeStatistics) {
                window.updateBasicTreeStatistics();
            }
            
            console.log(`âœ… ì „ì²´ ì ‘ê¸° ì™„ë£Œ: ${collapsedCount}ê°œ í–‰ì´ ìˆ¨ê¹€ë¨`);
        }
        
        // Prod.TechíŒ€ìš© ë ˆë²¨ë³„ í¼ì¹˜ê¸° í•¨ìˆ˜
        function expandToLevel(maxLevel) {
            console.log(`Prod.TechíŒ€: ë ˆë²¨ ${maxLevel}ê¹Œì§€ í¼ì¹˜ê¸°`);
            
            if (!window.processedBasicTreeData) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const tableId = 'bom-tree-body';
            const allRows = document.querySelectorAll(`#${tableId} tr`);
            let shownCount = 0;
            let hiddenCount = 0;
            
            // ëª¨ë“  í–‰ì„ ìˆœíšŒí•˜ë©° ë ˆë²¨ì— ë”°ë¼ í‘œì‹œ/ìˆ¨ê¹€
            allRows.forEach((row, index) => {
                const depth = parseInt(row.getAttribute('data-level') || 0);
                
                if (depth <= maxLevel) {
                    // maxLevel ì´í•˜ëŠ” í‘œì‹œ
                    if (row.classList.contains('hidden-tree-row')) {
                        row.classList.remove('hidden-tree-row');
                        shownCount++;
                    }
                } else {
                    // maxLevel ì´ˆê³¼ëŠ” ìˆ¨ê¹€
                    if (!row.classList.contains('hidden-tree-row')) {
                        row.classList.add('hidden-tree-row');
                        hiddenCount++;
                    }
                }
            });
            
            // í† ê¸€ ì•„ì´ì½˜ ìƒíƒœ ì—…ë°ì´íŠ¸
            window.processedBasicTreeData.forEach((item, index) => {
                if (item.isParent) {
                    const row = document.getElementById(item.rowId);
                    if (row) {
                        const toggleIcon = row.querySelector('.tree-toggle-icon');
                        if (toggleIcon) {
                            // í˜„ì¬ í•­ëª©ì˜ depthê°€ maxLevelë³´ë‹¤ ì‘ê³ , í•˜ìœ„ì— í‘œì‹œë˜ëŠ” í•­ëª©ì´ ìˆìœ¼ë©´ í¼ì¹¨ ìƒíƒœ
                            const hasVisibleChildren = window.processedBasicTreeData.some((childItem, childIndex) => 
                                childIndex > index && 
                                childItem.depth > item.depth && 
                                childItem.depth <= maxLevel
                            );
                            
                            if (item.depth < maxLevel && hasVisibleChildren) {
                                toggleIcon.setAttribute('data-expanded', 'true');
                                toggleIcon.textContent = 'â–¼';
                            } else {
                                toggleIcon.setAttribute('data-expanded', 'false');
                                toggleIcon.textContent = 'â–¶';
                            }
                        }
                    }
                }
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (window.updateBasicTreeStatistics) {
                window.updateBasicTreeStatistics();
            }
            
            console.log(`âœ… ë ˆë²¨ ${maxLevel} í¼ì¹˜ê¸° ì™„ë£Œ: ${shownCount}ê°œ í–‰ í‘œì‹œ, ${hiddenCount}ê°œ í–‰ ìˆ¨ê¹€`);
        }
        
        function exportVisibleItemsSales() {
            console.log('SalesíŒ€: CSV ë‚´ë³´ë‚´ê¸°');
            alert('CSV ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
        }
        

        
        // BomCube ì—´ì—ì„œ ë“¤ì—¬ì“°ê¸° ê¸°ë°˜ Depth ê³„ì‚° í•¨ìˆ˜
        function calculateDepthFromBomCube(bomCubeText) {
            if (!bomCubeText || typeof bomCubeText !== 'string') return 0;
            
            // ì•ìª½ ê³µë°± ë¬¸ìë“¤ì„ ê³„ì‚°í•˜ì—¬ ë“¤ì—¬ì“°ê¸° ë ˆë²¨ íŒŒì•…
            // Excelì—ì„œ ë³µì‚¬ëœ ë°ì´í„°ëŠ” ì¼ë°˜ ê³µë°±(' '), íƒ­('\t'), ë˜ëŠ” ë¹„í‘œì‹œ ë¬¸ìì¼ ìˆ˜ ìˆìŒ
            let leadingSpaceCount = 0;
            
            for (let i = 0; i < bomCubeText.length; i++) {
                const char = bomCubeText[i];
                if (char === ' ' || char === '\t' || char === '\u00A0' || char === '\u2009') {
                    // ì¼ë°˜ ê³µë°±, íƒ­, Non-breaking space, Thin space ë“±
                    leadingSpaceCount++;
                } else {
                    break; // ì²« ë²ˆì§¸ non-space ë¬¸ìë¥¼ ë§Œë‚˜ë©´ ì¤‘ë‹¨
                }
            }
            
            // Excelì—ì„œëŠ” ë³´í†µ ê° ë ˆë²¨ë§ˆë‹¤ 1-4ê°œ ê³µë°± ë¬¸ì ì‚¬ìš©
            // ì‹¤ì œ íŒ¨í„´ì— ë”°ë¼ ì¡°ì • (ë³´í†µ 1-2ê°œ ê³µë°±ì´ í•œ ë ˆë²¨)
            let depth = 0;
            if (leadingSpaceCount > 0) {
                // ê³µë°± 1~2ê°œ: depth 1, 3~4ê°œ: depth 2, ë“±ë“±
                depth = Math.max(1, Math.ceil(leadingSpaceCount / 2));
            }
            
            console.log(`BomCube ë“¤ì—¬ì“°ê¸° ë¶„ì„: "${bomCubeText}" â†’ ê³µë°± ${leadingSpaceCount}ê°œ â†’ Depth ${depth}`);
            return depth;
        }

        // Full BOM ì‹œíŠ¸ ì „ìš© íŒŒì‹± í•¨ìˆ˜
        function parseBOMDataFromFullBOM(jsonData, project) {
            console.log('ğŸ”„ Full BOM ì‹œíŠ¸ ë°ì´í„° íŒŒì‹± ì‹œì‘');
            
            if (jsonData.length < 2) {
                console.log('âŒ ë°ì´í„°ê°€ ë¶€ì¡±í•¨');
                return [];
            }
            
            console.log('ğŸ“‹ Full BOM ì›ë³¸ ë°ì´í„°:', jsonData.slice(0, 5)); // ì²˜ìŒ 5í–‰ë§Œ ë¡œê¹…
            
            // ì œê³µí•´ì£¼ì‹  í—¤ë” êµ¬ì¡°ì— ë”°ë¼ íŒŒì‹±
            const expectedHeaders = ['Depth', 'BOMCube', 'Lev', 'FindNumber', 'Identity', 'Number', 'Name', 'Name1', 'Name2', 'Version', 'Quantity', 'TotalQuantity', 'Unit', 'Weight (KG)', 'Material'];
            const headers = jsonData[0];
            
            console.log('ğŸ“‹ í—¤ë”:', headers);
            console.log('ğŸ“‹ ì˜ˆìƒ í—¤ë”:', expectedHeaders);
            
            const bomTreeData = [];
            let processedCount = 0;
            
            // í—¤ë” ë‹¤ìŒ í–‰ë¶€í„° ì²˜ë¦¬
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                
                if (!row || row.length === 0) {
                    continue;
                }
                
                // ëª¨ë“  ì…€ì´ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const hasContent = row.some(cell => cell && cell.toString().trim() !== '');
                if (!hasContent) {
                    continue;
                }
                
                // Depth ê³„ì‚°: Depth ì—´ì´ ë¹„ì–´ìˆìœ¼ë©´ BomCube ë“¤ì—¬ì“°ê¸°ë¡œ ê³„ì‚°
                const explicitDepth = parseInt(row[0]); // Depth ì—´ ê°’
                const bomCubeText = (row[1] || '').toString(); // BomCube ì—´ ê°’
                let calculatedDepth = 0;
                
                if (!isNaN(explicitDepth) && explicitDepth >= 0) {
                    // Depth ì—´ì— ëª…ì‹œì ì¸ ê°’ì´ ìˆìœ¼ë©´ ì‚¬ìš©
                    calculatedDepth = explicitDepth;
                    console.log(`í–‰ ${i}: ëª…ì‹œì  Depth ì‚¬ìš© = ${calculatedDepth}`);
                } else {
                    // Depth ì—´ì´ ë¹„ì–´ìˆìœ¼ë©´ BomCube ë“¤ì—¬ì“°ê¸°ë¡œ ê³„ì‚°
                    calculatedDepth = calculateDepthFromBomCube(bomCubeText);
                    console.log(`í–‰ ${i}: BomCube ë“¤ì—¬ì“°ê¸°ë¡œ Depth ê³„ì‚° = ${calculatedDepth} (BomCube: "${bomCubeText}")`);
                }
                
                // Full BOM êµ¬ì¡°ë¥¼ ê¸°ì¡´ BOM ì‹œìŠ¤í…œ í˜•íƒœë¡œ ë³€í™˜
                const bomItem = {
                    project_id: project.id,
                    rowIndex: i,
                    // ê¸°ì¡´ ì‹œìŠ¤í…œì´ ê¸°ëŒ€í•˜ëŠ” 10ê°€ì§€ í•„ìˆ˜ ì»¬ëŸ¼
                    depth: calculatedDepth,  // ê³„ì‚°ëœ Depth
                    name: (row[6] || '').toString().trim(),  // Name
                    number: (row[5] || '').toString().trim(),  // Number  
                    version: (row[9] || '').toString().trim(),  // Version
                    findNumber: (row[3] || i).toString(),  // FindNumber
                    quantity: parseFloat(row[10]) || 1,  // Quantity
                    totalQuantity: parseFloat(row[11]) || 1,  // TotalQuantity
                    unit: (row[12] || 'each').toString().trim(),  // Unit
                    weight: parseFloat(row[13]) || 0,  // Weight (KG) - ìˆ«ìë¡œ ë³€í™˜
                    material: (row[14] || '-').toString().trim(),  // Material
                    
                    // ì¶”ê°€ ì •ë³´ (ê¸°ì¡´ ì‹œìŠ¤í…œ í˜¸í™˜ì„±)
                    bomCube: (row[1] || '').toString().trim(),  // BOMCube
                    identity: (row[4] || '').toString().trim(),  // Identity
                    name1: (row[7] || '').toString().trim(),  // Name1 (German)
                    name2: (row[8] || '').toString().trim(),   // Name2 (Description)
                    
                    // ê¸°ì¡´ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¶”ê°€ í•„ë“œë“¤
                    id: `bom-item-${i}`,
                    parentNumber: null, // ê³„ì¸µ êµ¬ì¡°ì—ì„œ ì„¤ì •ë¨
                    isVisible: true,
                    hasDrawing: false,
                    drawingFile: null,
                    children: []
                };
                
                // ì˜ë¯¸ìˆëŠ” ë°ì´í„°ê°€ ìˆëŠ” í–‰ë§Œ ì²˜ë¦¬
                // Name ë˜ëŠ” Numberê°€ ìˆì–´ì•¼ í•˜ë©°, "Documentation for steel tower supplier" ê°™ì€ ì„¤ëª… í…ìŠ¤íŠ¸ëŠ” ì œì™¸
                const hasValidName = bomItem.name && bomItem.name.length > 0;
                const hasValidNumber = bomItem.number && bomItem.number.length > 0;
                const isDocumentationLine = bomItem.name && bomItem.name.toLowerCase().includes('documentation');
                const isBomCubeOnly = !hasValidName && !hasValidNumber && bomItem.bomCube;
                
                if ((hasValidName || hasValidNumber) && !isDocumentationLine && !isBomCubeOnly) {
                    bomTreeData.push(bomItem);
                    processedCount++;
                    
                    // ì²˜ìŒ 5ê°œ í–‰ë§Œ ë¡œê·¸ë¡œ í™•ì¸
                    if (processedCount <= 5) {
                        console.log(`âœ… Full BOM ì•„ì´í…œ ${processedCount}:`, {
                            depth: bomItem.depth,
                            name: bomItem.name,
                            number: bomItem.number,
                            quantity: bomItem.quantity
                        });
                    }
                }
            }
            
            console.log('ğŸ“Š Full BOM íŒŒì‹± ê²°ê³¼:', {
                totalRows: jsonData.length - 1,
                processedCount,
                finalBomTreeCount: bomTreeData.length
            });
            
            console.log('âœ… Full BOM ë°ì´í„° íŒŒì‹± ì™„ë£Œ:', bomTreeData.length, 'ê°œ ì•„ì´í…œ');
            
            return bomTreeData;
        }

        // BOM ë°ì´í„° íŒŒì‹± í•¨ìˆ˜ (SalesíŒ€ìš©) - ê¸°ì¡´ ì˜ ì‘ë™í•˜ë˜ ë¡œì§ ì ìš©
        function parseBOMDataSales(jsonData) {
            console.log('ğŸ”„ SalesíŒ€ BOM ë°ì´í„° íŒŒì‹± ì‹œì‘');
            
            if (jsonData.length < 2) {
                console.log('âŒ ë°ì´í„°ê°€ ë¶€ì¡±í•¨');
                return [];
            }
            
            console.log('ğŸ“‹ ì›ë³¸ ë°ì´í„°:', jsonData);
            
            // í—¤ë” ì°¾ê¸° - ì²« ë²ˆì§¸ ë¹„ì–´ìˆì§€ ì•Šì€ í–‰ì„ í—¤ë”ë¡œ ì‚¬ìš©
            let headers = null;
            let headerRowIndex = -1;
            
            for (let i = 0; i < jsonData.length; i++) {
                if (jsonData[i] && jsonData[i].length > 0 && jsonData[i].some(cell => cell && cell.toString().trim() !== '')) {
                    headers = jsonData[i];
                    headerRowIndex = i;
                    console.log('ğŸ“‹ í—¤ë” ë°œê²¬ (í–‰ ' + i + '):', headers);
                    break;
                }
            }
            
            if (!headers || headers.length === 0) {
                console.log('âŒ ìœ íš¨í•œ í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return [];
            }
            
            const bomTreeData = [];
            let processedCount = 0;
            
            // ë°ì´í„° í–‰ ì²˜ë¦¬ (í—¤ë” ë‹¤ìŒ í–‰ë¶€í„°)
            for (let i = headerRowIndex + 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                
                if (!row || row.length === 0) {
                    console.log(`ê±´ë„ˆë›°ê¸° - ë¹ˆ í–‰ ${i}`);
                    continue;
                }
                
                // ëª¨ë“  ì…€ì´ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                const hasContent = row.some(cell => cell && cell.toString().trim() !== '');
                if (!hasContent) {
                    console.log(`ê±´ë„ˆë›°ê¸° - ë‚´ìš© ì—†ëŠ” í–‰ ${i}`);
                    continue;
                }
                
                // ê¸°ì¡´ ì˜ ì‘ë™í•˜ë˜ ë¡œì§ ì ìš© - ë‹¤ì–‘í•œ ì»¬ëŸ¼ëª… ì§€ì›
                const rowObj = {};
                headers.forEach((header, index) => {
                    if (header && row[index] !== undefined && row[index] !== null) {
                        rowObj[header.toString().trim()] = row[index];
                    }
                });
                
                console.log(`í–‰ ${i} ë§¤í•‘:`, {
                    originalRow: row,
                    mappedObject: rowObj,
                    headerCount: headers.length,
                    dataCount: row.length
                });
                
                const bomItem = {
                    rowIndex: i,
                    // 10ê°€ì§€ í•„ìˆ˜ ì»¬ëŸ¼ - ë‹¤ì–‘í•œ ì»¬ëŸ¼ëª… ì§€ì›
                    depth: extractDepthBasicSales(rowObj),
                    name: findColumnValueSales(rowObj, ['BOM Cube', 'BOMCube', 'BOM_Cube', 'Name', 'ë¶€í’ˆëª…', 'ì•„ì´í…œëª…', 'Item Name', 'Part Name', 'Component Name', 'Description', 'í’ˆëª…', 'ItemName']),
                    number: findColumnValueSales(rowObj, ['Number', 'ë¶€í’ˆë²ˆí˜¸', 'Part Number', 'Drawing Number', 'Item Number', 'P/N', 'PN', 'ë„ë²ˆ', 'í’ˆë²ˆ', 'DRAWING NO']),
                    version: findColumnValueSales(rowObj, ['Version', 'ë²„ì „', 'Ver', 'Rev', 'Revision', 'ê°œì •', 'V', 'REV']) || '1.0',
                    findNumber: findColumnValueSales(rowObj, ['FindNumber', 'Find Number', 'Find#', 'Find No', 'ìˆœë²ˆ', 'ë²ˆí˜¸', 'No', 'Item No', '#']) || i,
                    quantity: parseNumberBasicSales(findColumnValueSales(rowObj, ['Quantity', 'ìˆ˜ëŸ‰', 'Qty', 'Q\'ty', 'Amount', 'ê°œìˆ˜', 'EA', 'Pcs'])) || 1,
                    unit: findColumnValueSales(rowObj, ['Unit', 'ë‹¨ìœ„', 'UOM', 'U/M', 'Units', 'Measure']) || 'each',
                    weight: parseWeightBasicSales(findColumnValueSales(rowObj, ['Weight', 'ë¬´ê²Œ', 'ì¤‘ëŸ‰', 'Mass', 'Wt', 'W', 'ì§ˆëŸ‰', 'KG', 'kg', 'WEIGHT', 'Weight(KG)', 'ë¬´ê²Œ(KG)', 'Unit Weight'])) || '-',
                    material: findColumnValueSales(rowObj, ['Material', 'ì¬ì§ˆ', 'Material Type', 'ì¬ë£Œ', 'Mat\'l', 'Grade', 'ë“±ê¸‰', 'Steel Grade', 'ê°•ì¢…', 'MATERIAL', 'Mat.', 'Steel', 'ì†Œì¬']) || '-'
                };
                
                // ë¹ˆ ì´ë¦„ê³¼ ë²ˆí˜¸ë¥¼ ê°€ì§„ í–‰ì€ ê±´ë„ˆë›°ê¸°
                if (!bomItem.name && !bomItem.number) {
                    console.log(`ê±´ë„ˆë›°ê¸° - ì´ë¦„/ë²ˆí˜¸ ì—†ìŒ í–‰ ${i}`);
                    continue;
                }
                
                console.log(`âœ… ì²˜ë¦¬ëœ BOM ì•„ì´í…œ ${processedCount + 1}:`, bomItem);
                
                bomTreeData.push(bomItem);
                processedCount++;
                
                // ì²˜ìŒ 3ê°œ í–‰ë§Œ ë¡œê·¸ë¡œ í™•ì¸
                if (i <= 3) {
                    console.log(`ğŸ” Sample row ${i}:`, rowObj, 'â†’', bomItem);
                }
            }
            
            console.log('ğŸ“Š íŒŒì‹± ê²°ê³¼ ìš”ì•½:', {
                totalRows: jsonData.length - 1,
                processedCount,
                finalBomTreeCount: bomTreeData.length
            });
            
            console.log('âœ… BOM ë°ì´í„° íŒŒì‹± ì™„ë£Œ:', bomTreeData.length, 'ê°œ ì•„ì´í…œ');
            console.log('ğŸ” ì²« 5ê°œ ì•„ì´í…œ:', bomTreeData.slice(0, 5));
            
            return bomTreeData;
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ (ê¸°ì¡´ ë¡œì§ì—ì„œ ê°€ì ¸ì˜¨ ê²ƒë“¤)
        function findColumnValueSales(row, columnNames) {
            for (const name of columnNames) {
                for (const key in row) {
                    if (key.toLowerCase().includes(name.toLowerCase()) && row[key] != null && row[key] !== '') {
                        return row[key].toString().trim();
                    }
                }
            }
            return null;
        }
        
        function extractDepthBasicSales(row) {
            // Depth ì»¬ëŸ¼ ì°¾ê¸°
            const depthValue = findColumnValueSales(row, ['Depth', 'Level', 'ë ˆë²¨', 'ê³„ì¸µ', 'Lv']);
            if (depthValue) {
                const parsed = parseInt(depthValue);
                return isNaN(parsed) ? 0 : parsed;
            }
            
            // Name ì»¬ëŸ¼ì—ì„œ ë“¤ì—¬ì“°ê¸°ë¡œ Depth ê³„ì‚°
            const nameValue = findColumnValueSales(row, ['BOM Cube', 'Name', 'ë¶€í’ˆëª…', 'í’ˆëª…']);
            if (nameValue && typeof nameValue === 'string') {
                const leadingSpaces = nameValue.match(/^(\s*)/)[1].length;
                const leadingTabs = nameValue.match(/^(\t*)/)[1].length;
                return leadingTabs > 0 ? leadingTabs : Math.floor(leadingSpaces / 4);
            }
            
            return 0;
        }
        
        function parseNumberBasicSales(value) {
            if (!value) return null;
            const parsed = parseFloat(value.toString().replace(/[^\d.-]/g, ''));
            return isNaN(parsed) ? null : parsed;
        }
        
        function parseWeightBasicSales(value) {
            if (!value) return null;
            const numericValue = parseNumberBasicSales(value);
            return numericValue !== null ? numericValue.toString() : null;
        }



        // SalesíŒ€ ë„ë©´ íŒŒì¼ê³¼ BOM ë§¤ì¹­ (ì €ì¥ì§€ì  58 ë¡œì§ ë³µì›)
        function matchDrawingsWithBOMSales() {
            console.log('ğŸš¨ğŸš¨ğŸš¨ matchDrawingsWithBOMSales í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸš¨ğŸš¨ğŸš¨');
            let matchCount = 0;
            
            // ì•ˆì „ ê²€ì‚¬ (ì €ì¥ì§€ì  57 í˜¸í™˜ì„±ì„ ìœ„í•´ ì™„í™”)
            if (!salesBOMData || salesBOMData.length === 0) {
                console.log('âš ï¸ salesBOMDataê°€ ì—†ìŠµë‹ˆë‹¤. í˜„ì¬ í™”ë©´ì˜ BOM íŠ¸ë¦¬ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                
                // í˜„ì¬ í™”ë©´ì— ë Œë”ë§ëœ BOM íŠ¸ë¦¬ ë°ì´í„° ì‚¬ìš© (ì €ì¥ì§€ì  57 í˜¸í™˜ì„±)
                if (window.currentBasicBOMData && window.currentBasicBOMData.length > 0) {
                    salesBOMData = window.currentBasicBOMData;
                    console.log(`âœ… í™”ë©´ BOM ë°ì´í„° ì‚¬ìš©: ${salesBOMData.length}ê°œ ì•„ì´í…œ`);
                } else {
                    console.log('âš ï¸ í™”ë©´ BOM ë°ì´í„°ë„ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ë°°ì—´ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.');
                    salesBOMData = [];
                }
            }
            
            if (!salesDrawingPackage || salesDrawingPackage.length === 0) {
                console.log('âŒ ë“œë¡œì‰ íŒ¨í‚¤ì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log(`ğŸ” SalesíŒ€ ë„ë©´ ë§¤ì¹­ ì‹œì‘: BOM ${salesBOMData.length}ê°œ í•­ëª©, PDF ${salesDrawingPackage.length}ê°œ íŒŒì¼`);
            
            // window.drawingMap ì´ˆê¸°í™”
            if (!window.drawingMap) {
                window.drawingMap = new Map();
            }
            
            // ë¨¼ì € ëª¨ë“  ì•„ì´í…œì˜ ë„ë©´ ìƒíƒœë¥¼ ì´ˆê¸°í™”
            salesBOMData.forEach(item => {
                item.hasDrawing = false;
                item.drawingFile = null;
            });
            
            salesBOMData.forEach((item, index) => {
                if (item.number && item.number.trim() !== '') {
                    const bomNumber = item.number.trim();
                    let matchingDrawing = null;
                    
                    // ì§„í–‰ë¥  í‘œì‹œ
                    if (index % 10 === 0 || index === salesBOMData.length - 1) {
                        console.log(`ğŸ“Š ë§¤ì¹­ ì§„í–‰ë¥ : ${index + 1}/${salesBOMData.length} (${Math.round(((index + 1) / salesBOMData.length) * 100)}%)`);
                    }
                    
                    console.log(`ğŸ” BOM í•­ëª© ì²˜ë¦¬: ${bomNumber}`);
                    
                    // PDF íŒŒì¼ë“¤ì—ì„œ ë§¤ì¹­ ì‹œë„ (ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ë°˜ì˜ ì§ì ‘ ë¹„êµ ë°©ì‹)
                    for (const file of salesDrawingPackage) {
                        // ë””ë²„ê¹… ë¡œê·¸ ì¤„ì´ê¸° (ì²« 5ê°œì™€ ë§¤ì¹­ëœ ê²ƒë§Œ)
                        if (index < 5 || isNumberMatch(bomNumber, file.name)) {
                            console.log(`  ğŸ“„ PDF ê²€ì‚¬: ${file.name}`);
                        }
                        
                        // ìƒˆë¡œìš´ ì§ì ‘ ë²ˆí˜¸ ë¹„êµ ë°©ì‹ ì‚¬ìš©
                        if (isNumberMatch(bomNumber, file.name)) {
                            matchingDrawing = file;
                            console.log(`  âœ… ë§¤ì¹­ ì„±ê³µ: ${bomNumber} â†” ${file.name}`);
                            break;
                        }
                    }
                    
                    if (matchingDrawing) {
                        // BOM ë°ì´í„° ì—…ë°ì´íŠ¸
                        item.hasDrawing = true;
                        item.drawingFile = matchingDrawing;
                        item.drawingFileName = matchingDrawing.name; // ğŸ”¥ íŒŒì¼ëª… ì €ì¥ (ì‹œìŠ¤í…œ ë“±ë¡ ì‹œ í•„ìš”)
                        
                        // ğŸ”¥ IndexedDBì— PDF íŒŒì¼ ì €ì¥ (ì¬ì§„ì… ì‹œ ë³µì›ìš©)
                        if (selectedProjectForAnalysis && selectedProjectForAnalysis.id) {
                            saveDrawingFile(
                                selectedProjectForAnalysis.id,
                                bomNumber,
                                matchingDrawing.name,
                                matchingDrawing
                            ).then(() => {
                                console.log(`ğŸ’¾ IndexedDB ì €ì¥: ${bomNumber} â†’ ${matchingDrawing.name}`);
                            }).catch(err => {
                                console.error(`âŒ IndexedDB ì €ì¥ ì‹¤íŒ¨: ${bomNumber}`, err);
                            });
                        }
                        
                        // window.drawingMap ì—…ë°ì´íŠ¸ (ì¤‘ìš”!)
                        const blobUrl = URL.createObjectURL(matchingDrawing);
                        window.drawingMap.set(bomNumber, {
                            file: matchingDrawing,
                            fileName: matchingDrawing.name,
                            drawingNumber: matchingDrawing.name.replace(/\.[^/.]+$/, ""), // í™•ì¥ì ì œê±°ë§Œ ìˆ˜í–‰
                            bomNumber: bomNumber,
                            blobUrl: blobUrl
                        });
                        
                        matchCount++;
                        console.log(`âœ… ë§¤ì¹­ ì„±ê³µ ë° drawingMap ì €ì¥: ${bomNumber} â†” ${matchingDrawing.name}`);
                    } else {
                        console.log(`âŒ ë§¤ì¹­ ì‹¤íŒ¨: ${bomNumber} (ë„ë©´ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ)`);
                    }
                }
            });
            
            console.log(`ğŸ‰ SalesíŒ€ ë„ë©´ ë§¤ì¹­ ì™„ë£Œ: ${matchCount}ê°œ BOM ì•„ì´í…œì´ ë„ë©´ê³¼ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            console.log(`ğŸ“Š window.drawingMap í¬ê¸°: ${window.drawingMap ? window.drawingMap.size : 0}`);
            
            // ë§¤ì¹­ ê²°ê³¼ ìƒì„¸ ì •ë³´ ì¶œë ¥
            console.log('=== ë§¤ì¹­ ê²°ê³¼ ìƒì„¸ ì •ë³´ ===');
            if (window.drawingMap && window.drawingMap.size > 0) {
                console.log('ë§¤ì¹­ëœ BOM ë²ˆí˜¸ë“¤:');
                window.drawingMap.forEach((value, key) => {
                    console.log(`  ${key} â†’ ${value.fileName}`);
                });
            }
            
            // ì§ì ‘ ë²ˆí˜¸ ë¹„êµ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
            console.log('=== ì§ì ‘ ë²ˆí˜¸ ë¹„êµ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ===');
            console.log('BOM: E0005476410-00 â†’ PDFíŒŒì¼ëª…: E0005476410_drawing.pdf ë§¤ì¹­ í…ŒìŠ¤íŠ¸:');
            const testResult = isNumberMatch('E0005476410-00', 'E0005476410_drawing.pdf');
            console.log('í…ŒìŠ¤íŠ¸ ê²°ê³¼:', testResult ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨');
            
            console.log('BOM: 30972 â†’ PDFíŒŒì¼ëª…: 30972-Rev1.pdf ë§¤ì¹­ í…ŒìŠ¤íŠ¸:');
            const testResult2 = isNumberMatch('30972', '30972-Rev1.pdf');
            console.log('í…ŒìŠ¤íŠ¸ ê²°ê³¼:', testResult2 ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨');
            
            // í…Œì´ë¸” ì—…ë°ì´íŠ¸ - BOM íŠ¸ë¦¬ì— ë„ë©´ ë§í¬ ì—…ë°ì´íŠ¸
            console.log('ğŸ”„ BOM íŠ¸ë¦¬ ë„ë©´ ë§í¬ ì—…ë°ì´íŠ¸ ì‹œì‘...');
            updateAllDrawingLinksInBOMTree();
            
            // Sales íŒ€ BOM íŠ¸ë¦¬ê°€ ìˆìœ¼ë©´ ë‹¤ì‹œ ë Œë”ë§
            if (window.renderBasicBOMTreeTable && salesBOMData && salesBOMData.length > 0) {
                console.log('ğŸ”„ Sales íŒ€ BOM íŠ¸ë¦¬ ë‹¤ì‹œ ë Œë”ë§...');
                renderBasicBOMTreeTable(salesBOMData, 'bom-tree-body-sales');
            }
            
            // BOM íŠ¸ë¦¬ì— ë„ë©´ ë§í¬ ì—…ë°ì´íŠ¸
            updateAllDrawingLinksInBOMTree();
        }

        // SalesíŒ€ ë„ë©´ë²ˆí˜¸ ì¶”ì¶œ
        function extractDrawingNumberSales(filename) {
            // GST íŒ¨í„´
            const gstMatch = filename.match(/GST\d{5}-\d{3}/i);
            if (gstMatch) return gstMatch[0];
            
            // E ì‹œë¦¬ì¦ˆ íŒ¨í„´
            const eMatch = filename.match(/E\d{10}(-\d{2})?/i);
            if (eMatch) return eMatch[0];
            
            // ì¼ë°˜ íŒ¨í„´
            const generalMatch = filename.match(/([A-Z0-9]{8,})/i);
            if (generalMatch) return generalMatch[0];
            
            return '';
        }

        // SalesíŒ€ PDF ëª¨ë‹¬ í‘œì‹œ
        function showPDFModalSales(itemId) {
            const item = salesBOMData.find(i => i.id === itemId);
            if (!item) {
                alert('BOM í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!item.hasDrawing) {
                alert('ì´ í•­ëª©ì— ì—°ê²°ëœ ë„ë©´ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // drawingFileì´ ì‹¤ì œ File ê°ì²´ì¸ì§€ í™•ì¸
            const hasValidFile = item.drawingFile && (item.drawingFile instanceof File || item.drawingFile instanceof Blob);
            
            if (!hasValidFile) {
                // íŒŒì¼ ê°ì²´ê°€ ì—†ìœ¼ë©´ ì¬ì—…ë¡œë“œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
                if (item.drawingFileName) {
                    showDrawingNotAvailableMessage(item.drawingFileName, item.number);
                } else {
                    alert('ë„ë©´ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                return;
            }
            
            const modal = document.getElementById('pdf-modal');
            const title = document.getElementById('pdf-modal-title');
            const body = document.getElementById('pdf-modal-body');
            
            if (!modal || !title || !body) {
                alert('PDF ë·°ì–´ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            title.textContent = `ë„ë©´: ${item.drawingFile.name}`;
            
            const url = URL.createObjectURL(item.drawingFile);
            
            // iframe ë°©ì‹ìœ¼ë¡œ ë³€ê²½ (ë” ë‚˜ì€ í˜¸í™˜ì„±)
            body.innerHTML = `
                <div style="width: 100%; height: 600px; background: #f3f4f6;">
                    <iframe src="${url}#toolbar=1&navpanes=1&scrollbar=1" 
                            type="application/pdf" 
                            width="100%" 
                            height="100%" 
                            style="border: none;">
                        <p>ë¸Œë¼ìš°ì €ê°€ PDFë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 
                           <a href="${url}" download="${item.drawingFile.name}" 
                              class="text-blue-600 hover:underline">ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì—¬ ë‹¤ìš´ë¡œë“œ</a>í•˜ì„¸ìš”.
                        </p>
                    </iframe>
                </div>
            `;
            
            modal.classList.add('show');
            
            // í˜„ì¬ PDF URL ì €ì¥ (ë‹¤ìš´ë¡œë“œìš©)
            window.currentPDFUrl = url;
            window.currentPDFName = item.drawingFile.name;
            
            console.log(`âœ… PDF ëª¨ë‹¬ í‘œì‹œ: ${item.drawingFile.name}`, { url, itemId });
        }

        // PDF ëª¨ë‹¬ ë‹«ê¸°
        function closePDFModal() {
            const modal = document.getElementById('pdf-modal');
            if (modal) {
                modal.classList.remove('show');
            }
            
            // URL ì •ë¦¬
            if (window.currentPDFUrl) {
                URL.revokeObjectURL(window.currentPDFUrl);
                window.currentPDFUrl = null;
                window.currentPDFName = null;
            }
        }

        // PDF ë‹¤ìš´ë¡œë“œ
        function downloadCurrentPDF() {
            if (!window.currentPDFUrl || !window.currentPDFName) {
                alert('ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const link = document.createElement('a');
            link.href = window.currentPDFUrl;
            link.download = window.currentPDFName;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ë“œë¡œì‰ íŒŒì¼ ì¬ì—…ë¡œë“œ ì•ˆë‚´ ë©”ì‹œì§€
        function showDrawingNotAvailableMessage(fileName, bomNumber) {
            const message = `ğŸ“„ ë“œë¡œì‰ íŒŒì¼ ì •ë³´\n\n` +
                `íŒŒì¼ëª…: ${fileName}\n` +
                `BOM ë²ˆí˜¸: ${bomNumber}\n\n` +
                `âš ï¸ ì´ ë“œë¡œì‰ì€ ì´ì „ì— ì—…ë¡œë“œë˜ì—ˆì§€ë§Œ, ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ ë˜ëŠ”\n` +
                `í”„ë¡œì íŠ¸ ì¬ì§„ì…ìœ¼ë¡œ ì¸í•´ íŒŒì¼ ê°ì²´ê°€ ì†ì‹¤ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n` +
                `ğŸ’¡ í•´ê²° ë°©ë²•:\n` +
                `1. í”„ë¡œì íŠ¸ë¥¼ ë‹¤ì‹œ ì„ íƒí•˜ì—¬ "BOM ë¶„ì„ & ë“œë¡œì‰ ì—…ë¡œë“œ" í™”ë©´ìœ¼ë¡œ ì´ë™\n` +
                `2. ë“œë¡œì‰ íŒ¨í‚¤ì§€ë¥¼ ë‹¤ì‹œ ì—…ë¡œë“œí•˜ì—¬ íŒŒì¼ ì—°ê²°ì„ ë³µì›\n` +
                `3. ì—…ë¡œë“œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”\n\n` +
                `â€» ë“œë¡œì‰ ë§¤ì¹­ ì •ë³´ëŠ” ì €ì¥ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ê°™ì€ íŒŒì¼ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•˜ë©´\n` +
                `   ìë™ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.`;
            
            alert(message);
        }

        // ì‹œìŠ¤í…œ ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ
        function showSystemRegistrationModal(projectId) {
            const project = salesProjectList.find(p => p.id == projectId);
            if (!project) {
                alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!project.bomAnalyzed || !project.drawingLinked) {
                alert('BOM ë¶„ì„ê³¼ ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const modal = document.getElementById('system-registration-modal');
            const title = document.getElementById('system-modal-title');
            const body = document.getElementById('system-modal-body');
            
            title.textContent = `ì‹œìŠ¤í…œ ë“±ë¡ í™•ì¸ - ${project.name}`;
            
            const bomItemCount = project.bomData ? project.bomData.length : 0;
            const drawingCount = project.drawingData ? project.drawingData.length : 0;
            const matchedCount = project.bomData ? project.bomData.filter(item => item.hasDrawing).length : 0;
            
            body.innerHTML = `
                <div class="bg-blue-50 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                        í”„ë¡œì íŠ¸ ì •ë³´ ìš”ì•½
                    </h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>í”„ë¡œì íŠ¸ëª…:</strong> ${project.name}</div>
                        <div><strong>í”„ë¡œì íŠ¸ íƒ€ì…:</strong> ${project.type}</div>
                        <div><strong>ê³ ê°ì‚¬:</strong> ${project.customer}</div>
                        <div><strong>ì‹œì‘ì¼:</strong> ${project.startDate}</div>
                        <div><strong>ì™„ë£Œì˜ˆì •ì¼:</strong> ${project.endDate}</div>
                        <div><strong>ë“±ë¡ì¼:</strong> ${new Date(project.createdAt).toLocaleDateString('ko-KR')}</div>
                    </div>
                </div>
                
                <div class="bg-green-50 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        BOM ë¶„ì„ ì™„ë£Œ ìƒíƒœ
                    </h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>ì´ BOM ì•„ì´í…œ:</strong> ${bomItemCount}ê°œ</div>
                        <div><strong>ë¶„ì„ ì™„ë£Œ:</strong> <span class="text-green-600 font-medium">ì™„ë£Œ</span></div>
                        <div><strong>ìµœëŒ€ Depth:</strong> ${project.bomData ? Math.max(...project.bomData.map(item => item.depth)) : 0}</div>
                        <div><strong>ë¶€ëª¨ ì•„ì´í…œ:</strong> ${project.bomData ? project.bomData.filter(item => item.children && item.children.length > 0).length : 0}ê°œ</div>
                    </div>
                </div>
                
                <div class="bg-orange-50 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-file-pdf text-orange-600 mr-2"></i>
                        ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—°ê²° ìƒíƒœ
                    </h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><strong>ì—…ë¡œë“œëœ ë„ë©´:</strong> ${drawingCount}ê°œ</div>
                        <div><strong>ì—°ê²° ì™„ë£Œ:</strong> <span class="text-blue-600 font-medium">ì™„ë£Œ</span></div>
                        <div><strong>ë§¤ì¹­ëœ BOM:</strong> ${matchedCount}ê°œ</div>
                        <div><strong>ë§¤ì¹­ë¥ :</strong> ${bomItemCount > 0 ? Math.round((matchedCount / bomItemCount) * 100) : 0}%</div>
                    </div>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                        ì‹œìŠ¤í…œ ë“±ë¡ ì•ˆë‚´
                    </h4>
                    <p class="text-sm text-gray-700 mb-2">
                        ì‹œìŠ¤í…œ ë“±ë¡ì„ ì™„ë£Œí•˜ë©´ ì´ í”„ë¡œì íŠ¸ì˜ ì •ë³´ê°€ <strong>BOM ë¶„ì„ íƒ­ (Prod. TechíŒ€)</strong>ìœ¼ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.
                    </p>
                    <ul class="text-xs text-gray-600 space-y-1">
                        <li>â€¢ ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì „ì²˜ë¦¬ê°€ ì™„ë£Œë©ë‹ˆë‹¤</li>
                        <li>â€¢ Prod. TechíŒ€ì—ì„œ AI ê³ ê¸‰ ë¶„ì„ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        <li>â€¢ ë“±ë¡ í›„ì—ëŠ” BOMì´ë‚˜ ë“œë¡œì‰ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</li>
                    </ul>
                </div>
                
                <div class="text-center">
                    <p class="text-gray-700 font-medium">ì •ë§ë¡œ ì‹œìŠ¤í…œì— ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                </div>
            `;
            
            // ëª¨ë‹¬ í‘œì‹œ
            modal.classList.add('show');
            
            // í™•ì¸ ë²„íŠ¼ì— í”„ë¡œì íŠ¸ ID ì €ì¥
            document.getElementById('confirm-system-registration').setAttribute('data-project-id', projectId);
        }

        // ì‹œìŠ¤í…œ ë“±ë¡ ëª¨ë‹¬ ë‹«ê¸°
        function closeSystemRegistrationModal() {
            const modal = document.getElementById('system-registration-modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // ì‹œìŠ¤í…œ ë“±ë¡ í™•ì¸
        function confirmSystemRegistration() {
            const button = document.getElementById('confirm-system-registration');
            const projectId = button.getAttribute('data-project-id');
            const project = salesProjectList.find(p => p.id == projectId);
            
            if (!project) {
                alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í”„ë¡œì íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
            project.systemRegistered = true;
            project.registeredAt = new Date().toISOString();
            
            // Prod. TechíŒ€ìœ¼ë¡œ ë°ì´í„° ì „ì†¡ (ê¸€ë¡œë²Œ ë³€ìˆ˜ì— ì €ì¥)
            window.prodTechProjects = window.prodTechProjects || [];
            window.prodTechProjects.push({
                ...project,
                transferredAt: new Date().toISOString(),
                status: 'ready_for_ai_analysis'
            });
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
            saveProjectListToStorage();
            localStorage.setItem('cswind-prodtech-projects', JSON.stringify(window.prodTechProjects));
            
            // UI ì—…ë°ì´íŠ¸
            updateProjectListDisplay();
            updateProjectSelectOptions();
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeSystemRegistrationModal();
            
            alert(`í”„ë¡œì íŠ¸ "${project.name}"ì´ ì„±ê³µì ìœ¼ë¡œ ì‹œìŠ¤í…œì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nProd. TechíŒ€ì˜ BOM ë¶„ì„ íƒ­ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
            
            console.log('í”„ë¡œì íŠ¸ ì‹œìŠ¤í…œ ë“±ë¡ ì™„ë£Œ:', project);
        }

        // ==========================================
        // BOM ë° ë“œë¡œì‰ ì—…ë¡œë“œ í•¨ìˆ˜ë“¤ (ì™„ì „ ë³µì›)
        // ==========================================
        
        // BOM íŒŒì¼ ì—…ë¡œë“œ (ì™„ì „í•œ ë²„ì „)
        function uploadBOMFileSales() {
            console.log('ğŸš€ BOM íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘');
            
            // ì„ íƒëœ í”„ë¡œì íŠ¸ í™•ì¸
            if (!selectedProjectForAnalysis) {
                alert('ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const fileInput = document.getElementById('bom-file-input-sales');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('BOM íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('BOM íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    
                    // ğŸ”¥ ì¤‘ìš”: cellStyles ì˜µì…˜ìœ¼ë¡œ Excel ë“¤ì—¬ì“°ê¸° ì •ë³´ ë³´ì¡´!
                    const workbook = XLSX.read(data, { 
                        type: 'array',
                        cellStyles: true,  // Excel ì…€ ìŠ¤íƒ€ì¼ ì •ë³´ ìœ ì§€
                        cellDates: true,   // ë‚ ì§œ í¬ë§· ìœ ì§€
                        cellNF: true       // ìˆ«ì í¬ë§· ìœ ì§€
                    });
                    
                    // "Full BOM" ì‹œíŠ¸ ì°¾ê¸°
                    let sheetName = workbook.SheetNames.find(name => 
                        name.toLowerCase().includes('bom') || 
                        name.toLowerCase().includes('full')
                    ) || workbook.SheetNames[0];
                    
                    console.log('ì„ íƒëœ ì‹œíŠ¸:', sheetName);
                    
                    const worksheet = workbook.Sheets[sheetName];
                    
                    // ğŸ”¥ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ë°ì´í„° ì½ê¸° - ìŠ¤íƒ€ì¼ ì •ë³´ í¬í•¨
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                        header: 1,
                        raw: false,        // í¬ë§·ëœ ê°’ ì‚¬ìš©
                        defval: ''         // ê¸°ë³¸ê°’ ì„¤ì •
                    });
                    
                    // ğŸ”¥ ì…€ ìŠ¤íƒ€ì¼ ì •ë³´ë„ ë³„ë„ë¡œ ì¶”ì¶œ (ë“¤ì—¬ì“°ê¸° ì •ë³´ í¬í•¨)
                    const cellStyleInfo = {};
                    for (let cellAddress in worksheet) {
                        if (cellAddress[0] === '!' || !worksheet[cellAddress].s) continue;
                        const cell = worksheet[cellAddress];
                        if (cell.s && cell.s.alignment && cell.s.alignment.indent !== undefined) {
                            cellStyleInfo[cellAddress] = {
                                indent: cell.s.alignment.indent || 0,
                                value: cell.v || cell.w || '',
                                formula: cell.f || ''
                            };
                        }
                    }
                    
                    console.log('ğŸ¯ Excel ì…€ ìŠ¤íƒ€ì¼ ì •ë³´ (ë“¤ì—¬ì“°ê¸°):', cellStyleInfo);
                    
                    // BOM ë°ì´í„° ì²˜ë¦¬ (ì…€ ìŠ¤íƒ€ì¼ ì •ë³´ í¬í•¨)
                    processBOMDataSales(jsonData, worksheet, cellStyleInfo);
                    
                    // í”„ë¡œì íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
                    selectedProjectForAnalysis.bomAnalyzed = true;
                    selectedProjectForAnalysis.bomAnalyzedAt = new Date().toISOString();
                    
                    // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                    const projectIndex = salesProjectList.findIndex(p => p.id === selectedProjectForAnalysis.id);
                    if (projectIndex >= 0) {
                        salesProjectList[projectIndex] = selectedProjectForAnalysis;
                        saveProjectListToStorage();
                        updateProjectListDisplay();
                    }
                    
                    alert(`BOM ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\\n\\nì´ ${salesBOMData.length}ê°œ ì•„ì´í…œì´ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    
                } catch (error) {
                    console.error('ğŸš¨ BOM íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                    alert(`BOM íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n\n${error.message}\n\nìì„¸í•œ ì •ë³´ëŠ” ë¸Œë¼ìš°ì € ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.`);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // BOM ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜ (Excel ìŠ¤íƒ€ì¼ ì •ë³´ í¬í•¨)
        // ğŸ”¥ ì‚¬ìš©ì Excel êµ¬ì¡°ì— ë§ëŠ” ì •í™•í•œ ì»¬ëŸ¼ ë§¤í•‘ ì²˜ë¦¬ í•¨ìˆ˜
        function processBOMDataSales(rawData, worksheet = null, cellStyleInfo = null) {
            console.log('ğŸš€ ì‚¬ìš©ì Excel êµ¬ì¡° ê¸°ë°˜ ì •í™•í•œ ì»¬ëŸ¼ ë§¤í•‘ ì‹œì‘');
            
            if (!rawData || rawData.length < 2) {
                console.error('âŒ BOM ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                alert('ìœ íš¨í•œ BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ğŸ¯ 1ë‹¨ê³„: ì „ì²´ Excel ë°ì´í„° êµ¬ì¡° ë¶„ì„
            console.log('ğŸ“‹ ì›ë³¸ Excel ì „ì²´ ë°ì´í„° êµ¬ì¡° ë¶„ì„:');
            console.log('í—¤ë” í–‰:', rawData[0]);
            console.log('ì´ ì»¬ëŸ¼ ìˆ˜:', rawData[0] ? rawData[0].length : 0);
            console.log('ì´ í–‰ ìˆ˜:', rawData.length);
            
            // ğŸ¯ 2ë‹¨ê³„: ì‚¬ìš©ì Excel ì‹¤ì œ êµ¬ì¡° ë¶„ì„ ë° í•„ìš”í•œ ì»¬ëŸ¼ ìœ„ì¹˜ í™•ì¸
            // ì‚¬ìš©ì ì›ë³¸: Depth | BOMCube | Lev | FindNumber | Identity | 0 | GST03315-001/A;1-TowSct | Mid1 | TS118-00 | Group | Action | Revision
            // í•„ìš”í•œ ì •ë³´: Depth, Name, Number, Version, FindNumber, Quantity, Unit, Weight, Material
            
            console.log('ğŸ” ì‚¬ìš©ì Excel ì›ë³¸ êµ¬ì¡° ë¶„ì„:');
            console.log('Aì—´(0): Depth');
            console.log('Bì—´(1): BOMCube');
            console.log('Cì—´(2): Lev'); 
            console.log('Dì—´(3): FindNumber');
            console.log('Eì—´(4): Identity');
            console.log('Fì—´(5): 0');
            console.log('Gì—´(6): GST03315-001/A;1-TowSct (Name+Number í˜¼í•©)');
            console.log('Hì—´(7): Mid1');
            console.log('Iì—´(8): TS118-00');
            console.log('Jì—´(9): Group');
            console.log('Kì—´(10): Action');
            console.log('Lì—´(11): Revision');
            
            // ğŸ¯ ì‹¤ì œ Excel ë°ì´í„° ìœ„ì¹˜ í™•ì¸ì„ ìœ„í•œ ìƒ˜í”Œ í–‰ ë¶„ì„
            if (rawData.length > 1) {
                console.log('ğŸ“‹ ìƒ˜í”Œ í–‰ ë¶„ì„:', rawData[1]);
                console.log('ê° ì»¬ëŸ¼ë³„ ë°ì´í„°:');
                for (let col = 0; col < Math.min(12, rawData[1].length); col++) {
                    console.log(`  ${col}ë²ˆ ì»¬ëŸ¼: "${rawData[1][col] || ''}"`);  
                }
            }
            
            // ğŸ¯ ì‹¤ì œ ì‚¬ìš©ì Excel êµ¬ì¡°ì— ê¸°ë°˜í•œ ì»¬ëŸ¼ ë§¤í•‘ (ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜)
            // í˜„ì¬ ë¬¸ì œ:
            // - Name: BOMCube ê°’ì´ ì˜ëª» ë“¤ì–´ê° â†’ ì˜¬ë°”ë¥¸ Name ì»¬ëŸ¼ ì°¾ì•„ì„œ ìˆ˜ì •
            // - FindNumber: Quantity ê°’ì´ ì˜ëª» ë“¤ì–´ê° â†’ ì‹¤ì œ FindNumber ì»¬ëŸ¼ ì°¾ì•„ì„œ ìˆ˜ì •
            // - Number, Version, Quantity, Unit, Weight, Material: ì •ìƒ
            
            // ì‹¤ì œ Excel í—¤ë” ë¶„ì„ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ì»¬ëŸ¼ ìœ„ì¹˜ ì°¾ê¸°
            const headerRow = rawData[0];
            console.log('ğŸ” Excel í—¤ë” ë¶„ì„ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ì»¬ëŸ¼ ìœ„ì¹˜ ì°¾ê¸°:');
            headerRow.forEach((header, index) => {
                console.log(`  ${index}ë²ˆ ì»¬ëŸ¼: "${header}"`);
            });
            
            // ğŸ” í—¤ë”ì—ì„œ í•„ìˆ˜ ì»¬ëŸ¼ ìœ„ì¹˜ ì°¾ê¸°
            const columnMap = {
                depth: -1,
                bomCube: -1,
                lev: -1,
                findNumber: -1,
                name: -1,
                number: -1,
                version: -1,
                quantity: -1,
                unit: -1,
                weight: -1,
                material: -1
            };
            
            // í—¤ë” ë¶„ì„í•˜ì—¬ ì»¬ëŸ¼ ì¸ë±ìŠ¤ ì €ì¥
            for (let col = 0; col < headerRow.length; col++) {
                const header = (headerRow[col] || '').toString().trim().toLowerCase();
                
                if (header === 'depth') {
                    columnMap.depth = col;
                    console.log(`âœ… Depth ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'bomcube') {
                    columnMap.bomCube = col;
                    console.log(`âœ… BOMCube ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'lev') {
                    columnMap.lev = col;
                    console.log(`âœ… Lev ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'findnumber' || header === 'find number') {
                    columnMap.findNumber = col;
                    console.log(`âœ… FindNumber ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'name') {
                    columnMap.name = col;
                    console.log(`âœ… Name ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'number' || header === 'part number') {
                    columnMap.number = col;
                    console.log(`âœ… Number ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'version' || header === 'rev' || header === 'revision') {
                    columnMap.version = col;
                    console.log(`âœ… Version ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'quantity' || header === 'qty') {
                    columnMap.quantity = col;
                    console.log(`âœ… Quantity ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'unit' || header === 'uom') {
                    columnMap.unit = col;
                    console.log(`âœ… Unit ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'weight') {
                    columnMap.weight = col;
                    console.log(`âœ… Weight ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                } else if (header === 'material') {
                    columnMap.material = col;
                    console.log(`âœ… Material ì»¬ëŸ¼ ë°œê²¬: ${col}ë²ˆ ì»¬ëŸ¼`);
                }
            }
            
            console.log('ğŸ“Š ìµœì¢… ì»¬ëŸ¼ ë§¤í•‘:', columnMap);
            
            // ğŸ” ê° í–‰ì—ì„œ ì •í™•í•œ ì»¬ëŸ¼ ìœ„ì¹˜ì˜ ë°ì´í„° ì¶”ì¶œ
            salesBOMData = [];
            
            for (let i = 1; i < rawData.length; i++) {
                const row = rawData[i];
                if (!row || row.length === 0) continue;
                
                console.log(`\nğŸ” ì›ë³¸ í–‰ ${i} ì „ì²´:`, row);
                
                // ğŸ¯ í—¤ë” ê¸°ë°˜ ë™ì  ì»¬ëŸ¼ ë§¤í•‘
                const depthValue = columnMap.depth >= 0 ? (row[columnMap.depth] || '') : (row[0] || '');
                
                // BOMCubeì—ì„œ Nameê³¼ Number ì¶”ì¶œ
                // BOMCube í˜•ì‹: "GST08493-000/A;2-TowSct Tb TS162-01"
                // â†’ Number: GST08493-000, Version: A, Name: TowSct Tb TS162-01
                const bomCubeValue = columnMap.bomCube >= 0 ? (row[columnMap.bomCube] || '') : '';
                
                let nameValue = '';
                let numberValue = '';
                let versionValue = '';
                
                if (bomCubeValue) {
                    // BOMCube íŒŒì‹±: "GST08493-000/A;2-TowSct Tb TS162-01"
                    const parts = bomCubeValue.split(';');
                    
                    if (parts.length >= 2) {
                        // Numberì™€ Version: "GST08493-000/A"
                        const numberPart = parts[0].trim();
                        const slashIndex = numberPart.indexOf('/');
                        
                        if (slashIndex > 0) {
                            numberValue = numberPart.substring(0, slashIndex).trim();
                            versionValue = numberPart.substring(slashIndex + 1).trim();
                        } else {
                            numberValue = numberPart;
                        }
                        
                        // Name: "2-TowSct Tb TS162-01"ì—ì„œ "2-" ì œê±°
                        const namePart = parts[1].trim();
                        const dashIndex = namePart.indexOf('-');
                        if (dashIndex > 0) {
                            nameValue = namePart.substring(dashIndex + 1).trim();
                        } else {
                            nameValue = namePart;
                        }
                    } else {
                        // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì „ì²´ë¥¼ Nameìœ¼ë¡œ
                        nameValue = bomCubeValue;
                    }
                }
                
                // Name ì»¬ëŸ¼ì´ ë”°ë¡œ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
                if (columnMap.name >= 0 && row[columnMap.name]) {
                    nameValue = row[columnMap.name];
                }
                
                // Number ì»¬ëŸ¼ì´ ë”°ë¡œ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
                if (columnMap.number >= 0 && row[columnMap.number]) {
                    numberValue = row[columnMap.number];
                }
                
                // Version ì»¬ëŸ¼ì´ ë”°ë¡œ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
                if (columnMap.version >= 0 && row[columnMap.version]) {
                    versionValue = row[columnMap.version];
                }
                
                // FindNumber: í—¤ë”ì—ì„œ ì°¾ì€ ì»¬ëŸ¼ ì‚¬ìš©
                let findNumberValue = '';
                if (parseInt(depthValue) !== 0 && columnMap.findNumber >= 0) {
                    findNumberValue = row[columnMap.findNumber] || '';
                }
                
                const quantityValue = columnMap.quantity >= 0 ? (row[columnMap.quantity] || '') : '';
                const unitValue = columnMap.unit >= 0 ? (row[columnMap.unit] || '') : '';
                const weightValue = columnMap.weight >= 0 ? (row[columnMap.weight] || '') : '';
                const materialValue = columnMap.material >= 0 ? (row[columnMap.material] || '') : '';
                
                console.log(`ğŸ“Š [í–‰ ${i}] ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜ ë°ì´í„° ì¶”ì¶œ:`);
                console.log(`  - Depth: "${depthValue}"`);
                console.log(`  - Name (ìˆ˜ì •ë¨): "${nameValue}"`);
                console.log(`  - Number (ì •ìƒ): "${numberValue}"`);
                console.log(`  - Version (ì •ìƒ): "${versionValue}"`);
                console.log(`  - FindNumber (ìˆ˜ì •ë¨): "${findNumberValue}"`);
                console.log(`  - Quantity (ì •ìƒ): "${quantityValue}"`);
                console.log(`  - Unit (ì •ìƒ): "${unitValue}"`);
                console.log(`  - Weight (ì •ìƒ): "${weightValue}"`);
                console.log(`  - Material (ì •ìƒ): "${materialValue}"`);
                
                // ğŸ¯ Depth ê³„ì‚° (ê¸°ì¡´ ë¡œì§ í™œìš©)
                let depth = parseInt(depthValue) || 0;
                
                // Excel ì…€ ìŠ¤íƒ€ì¼ ì •ë³´ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš© (ë“¤ì—¬ì“°ê¸° ë³´ì¡´)
                if (worksheet && cellStyleInfo) {
                    const cellAddress = XLSX.utils.encode_cell({r: i, c: 1}); // Bì—´(Name ì»¬ëŸ¼) ê¸°ì¤€
                    if (cellStyleInfo[cellAddress]) {
                        depth = cellStyleInfo[cellAddress].indent || depth;
                    }
                }
                
                // í…ìŠ¤íŠ¸ íŒ¨í„´ ë¶„ì„ìœ¼ë¡œ ë“¤ì—¬ì“°ê¸° ê°ì§€ (ê¸°ì¡´ calculateIndentationLevel í™œìš©)
                if (!depth && nameValue) {
                    depth = calculateIndentationLevel(nameValue);
                }
                
                // íŠ¹ë³„ ì²˜ë¦¬: "Documentation for steel tower supplier" ê°•ì œ depth 3
                const trimmedName = nameValue.trim().toLowerCase();
                if (trimmedName.includes('documentation for steel tower supplier')) {
                    depth = 3;
                    console.log('ğŸ¯ íŠ¹ë³„ í•­ëª© ê°ì§€: Documentation for steel tower supplier -> Depth 3');
                }
                
                // ì‚¬ìš©ìê°€ ìš”êµ¬í•œ ëŒ€ë¡œ: ì§€ëŠ¥í˜• ë¶„ë¦¬ ì—†ì´ ê° ì»¬ëŸ¼ì˜ ë°ì´í„° ê·¸ëŒ€ë¡œ ì‚¬ìš©
                
                const item = {
                    id: `sales-bom-${i}`,
                    depth: depth,
                    name: nameValue,                        // Bì—´: ì‹¤ì œ Name ë°ì´í„°
                    number: numberValue,                    // Fì—´: ì‹¤ì œ Number ë°ì´í„°
                    version: versionValue,                  // Jì—´: ì‹¤ì œ Version ë°ì´í„°
                    findNumber: findNumberValue,            // Kì—´: ì‹¤ì œ FindNumber ë°ì´í„°
                    quantity: quantityValue,                // Lì—´: ì‹¤ì œ Quantity ë°ì´í„°
                    unit: unitValue,                        // Mì—´: ì‹¤ì œ Unit ë°ì´í„°
                    weight: weightValue,                    // Nì—´: ì‹¤ì œ Weight ë°ì´í„°
                    material: materialValue,                // Oì—´: ì‹¤ì œ Material ë°ì´í„°
                    children: [],
                    isVisible: depth === 0, // Depth 0ë§Œ ì´ˆê¸° í‘œì‹œ
                    hasDrawing: false,
                    drawingFile: null
                };
                
                console.log(`ğŸ“¦ ìƒì„±ëœ BOM ì•„ì´í…œ ${i}:`, item);
                salesBOMData.push(item);
            }
            
            console.log('âœ… ì²˜ë¦¬ëœ Sales BOM ë°ì´í„°:', salesBOMData.length, 'ê°œ ì•„ì´í…œ');
            
            // ë°ì´í„° ê²€ì¦
            const numberItems = salesBOMData.filter(item => item.number && item.number !== '');
            const findNumberItems = salesBOMData.filter(item => item.findNumber && item.findNumber !== '');
            console.log(`ğŸ“Š Number í•„ë“œê°€ ìˆëŠ” í•­ëª©: ${numberItems.length}ê°œ`);
            console.log(`ğŸ“Š FindNumber í•„ë“œê°€ ìˆëŠ” í•­ëª©: ${findNumberItems.length}ê°œ`);
            
            // ğŸ¯ 4ë‹¨ê³„: ê³„ì¸µêµ¬ì¡° ìƒì„±
            buildBOMHierarchySales();
            
            // ğŸ¯ 5ë‹¨ê³„: BOM í…Œì´ë¸” í‘œì‹œ
            displayBOMTableSales();
            
            // BOM ë¶„ì„ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('basic-bom-analysis-section-sales').classList.remove('hidden');
            
            // ğŸ¯ 6ë‹¨ê³„: í†µê³„ ì—…ë°ì´íŠ¸
            updateBOMStatisticsSales();
            
            // ğŸ”¥ í”„ë¡œì íŠ¸ì— BOM ë°ì´í„° ì €ì¥
            if (selectedProjectForAnalysis) {
                selectedProjectForAnalysis.bomData = salesBOMData;
                console.log(`ğŸ’¾ í”„ë¡œì íŠ¸ "${selectedProjectForAnalysis.name}"ì— BOM ë°ì´í„° ì €ì¥ë¨:`, salesBOMData.length, 'ê°œ ì•„ì´í…œ');
            }
            
            // ğŸ”¥ BOM ë¶„ì„ ì™„ë£Œ alert ì œê±° - ì½˜ì†” ë¡œê·¸ë§Œ ìœ ì§€
            console.log(`âœ… BOM ë¶„ì„ ì™„ë£Œ: ${salesBOMData.length}ê°œ ì•„ì´í…œ (ë„ë©´ë²ˆí˜¸: ${numberItems.length}, í¬ì§€ì…˜: ${findNumberItems.length})`);
        }
        
        // BOM ê³„ì¸µ êµ¬ì¡° ìƒì„± (ì €ì¥ì§€ì  86 ë°©ì‹)
        function buildBOMHierarchySales() {
            console.log('ğŸ—ï¸ BOM ê³„ì¸µ êµ¬ì¡° ìƒì„± ì‹œì‘');
            
            for (let i = 0; i < salesBOMData.length; i++) {
                const currentItem = salesBOMData[i];
                
                // ë¶€ëª¨ ì°¾ê¸° (ì´ì „ í•­ëª© ì¤‘ì—ì„œ depthê°€ í•˜ë‚˜ ì ì€ í•­ëª©)
                for (let j = i - 1; j >= 0; j--) {
                    if (salesBOMData[j].depth === currentItem.depth - 1) {
                        currentItem.parent = salesBOMData[j];
                        salesBOMData[j].children.push(currentItem);
                        break;
                    }
                }
            }
            
            console.log('âœ… BOM ê³„ì¸µ êµ¬ì¡° ìƒì„± ì™„ë£Œ');
        }

        // BOM í…Œì´ë¸” í‘œì‹œ (ì €ì¥ì§€ì  86 ë°©ì‹)
        function displayBOMTableSales() {
            const tbody = document.getElementById('bom-tree-body-sales');
            if (!tbody) {
                console.error('âŒ BOM í…Œì´ë¸” ë°”ë””ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            tbody.innerHTML = '';
            
            salesBOMData.forEach(item => {
                if (item.isVisible) {
                    const row = createBOMTableRowSales(item);
                    tbody.appendChild(row);
                }
            });
        }

        // BOM í…Œì´ë¸” í–‰ ìƒì„± (ì €ì¥ì§€ì  86 ë°©ì‹)
        function createBOMTableRowSales(item) {
            const row = document.createElement('tr');
            row.className = `bom-tree-row depth-${Math.min(item.depth, 5)}`;
            row.id = `row-${item.id}`;
            
            const hasChildren = item.children.length > 0;
            const isExpanded = item.children.some(child => child.isVisible);
            
            const indent = '&nbsp;'.repeat(item.depth * 4);
            
            // ë“œë¡œì‰ ì…€ ìƒì„± ë¡œì§ (Save Point 87 ìŠ¤íƒ€ì¼ - ë‹¨ìˆœí•˜ê³  ëª…í™•)
            let drawingCell;
            if (item.hasDrawing) {
                if (item.drawingFile && (item.drawingFile instanceof File || item.drawingFile instanceof Blob)) {
                    // ì‹¤ì œ íŒŒì¼ ê°ì²´ê°€ ìˆëŠ” ê²½ìš° - "ë³´ê¸°" ë²„íŠ¼ í‘œì‹œ
                    drawingCell = `<button onclick="showPDFModalSales('${item.id}')" class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 bg-blue-100 rounded hover:bg-blue-200">ğŸ“„ ë³´ê¸°</button>`;
                } else if (item.drawingFileName) {
                    // íŒŒì¼ëª…ë§Œ ìˆëŠ” ê²½ìš° - ì´ˆë¡ìƒ‰ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ (Save Point 87 ë°©ì‹)
                    const shortName = item.drawingFileName.substring(0, 15);
                    drawingCell = `<span class="text-green-600 text-xs" title="${item.drawingFileName}">âœ“ ${shortName}...</span>`;
                } else {
                    // hasDrawingì€ trueì¸ë° íŒŒì¼ ì •ë³´ê°€ ì—†ìŒ
                    drawingCell = `<span class="text-green-600 text-xs">âœ“ ì—°ê²°ë¨</span>`;
                }
            } else {
                // ë“œë¡œì‰ ì—†ìŒ
                drawingCell = '<span class="text-gray-400 text-xs">ì—†ìŒ</span>';
            }
            
            // ğŸ”¥ ë””ë²„ê¹…: ë“œë¡œì‰ì´ ìˆëŠ” ëª¨ë“  í•­ëª©ì˜ ìƒíƒœ ì¶œë ¥
            if (item.hasDrawing) {
                console.log(`ğŸ” ë“œë¡œì‰ ì…€ ìƒì„± (${item.number}):`, {
                    hasDrawing: item.hasDrawing,
                    hasDrawingFile: !!item.drawingFile,
                    isFileObject: item.drawingFile instanceof File,
                    isBlobObject: item.drawingFile instanceof Blob,
                    hasDrawingFileName: !!item.drawingFileName,
                    drawingFileName: item.drawingFileName,
                    cellHTML: drawingCell.substring(0, 80)
                });
            }
            
            row.innerHTML = `
                <td class="px-2 py-2 border-r text-xs">${item.depth}</td>
                <td class="px-2 py-2 border-r text-xs">
                    ${indent}
                    ${hasChildren ? `<span class="toggle-icon cursor-pointer text-blue-600 mr-2" data-item-id="${item.id}">${isExpanded ? 'â–¼' : 'â–¶'}</span>` : '<span class="ml-4"></span>'}
                    ${item.name}
                </td>
                <td class="px-2 py-2 border-r text-xs">${item.number}</td>
                <td class="px-2 py-2 border-r text-xs">${item.version}</td>
                <td class="px-2 py-2 border-r text-xs">${item.findNumber}</td>
                <td class="px-2 py-2 border-r text-xs">${item.quantity}</td>
                <td class="px-2 py-2 border-r text-xs">${item.unit}</td>
                <td class="px-2 py-2 border-r text-xs">${item.weight}</td>
                <td class="px-2 py-2 border-r text-xs">${item.material}</td>
                <td class="px-2 py-2 text-center text-xs">${drawingCell}</td>
            `;
            
            // í† ê¸€ ì•„ì´ì½˜ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            if (hasChildren) {
                const toggleIcon = row.querySelector('.toggle-icon');
                if (toggleIcon) {
                    toggleIcon.addEventListener('click', function() {
                        toggleBOMRowSales(item.id);
                    });
                }
            }
            
            return row;
        }

        // BOM í–‰ í† ê¸€ (ì €ì¥ì§€ì  86 ë°©ì‹)
        function toggleBOMRowSales(itemId) {
            console.log('ğŸ”„ í† ê¸€ ì‹¤í–‰:', itemId);
            
            const item = salesBOMData.find(i => i.id === itemId);
            if (!item) {
                console.error('âŒ ì•„ì´í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', itemId);
                return;
            }
            
            console.log('ğŸ“‹ ì•„ì´í…œ ì •ë³´:', {
                id: item.id,
                name: item.name,
                depth: item.depth,
                childrenCount: item.children.length
            });
            
            const shouldShow = !item.children.some(child => child.isVisible);
            console.log(`${shouldShow ? 'ğŸ“‚ í¼ì¹˜ê¸°' : 'ğŸ“ ì ‘ê¸°'} ì‹¤í–‰`);
            
            function toggleChildren(parent, show) {
                parent.children.forEach(child => {
                    child.isVisible = show;
                    console.log(`  ${show ? 'ğŸ‘ï¸ í‘œì‹œ' : 'ğŸ™ˆ ìˆ¨ê¹€'}: ${child.name} (depth: ${child.depth})`);
                    
                    if (show && child.children.length > 0) {
                        // ìì‹ì´ í¼ì³ì§„ ìƒíƒœë¼ë©´ ì¬ê·€ì ìœ¼ë¡œ í‘œì‹œ
                        const childToggleIcon = document.querySelector(`[data-item-id="${child.id}"]`);
                        if (childToggleIcon && childToggleIcon.textContent === 'â–¼') {
                            toggleChildren(child, true);
                        }
                    } else if (!show) {
                        // ì ‘ì„ ë•ŒëŠ” ëª¨ë“  í•˜ìœ„ í•­ëª© ìˆ¨ê¸°ê¸°
                        toggleChildren(child, false);
                    }
                });
            }
            
            toggleChildren(item, shouldShow);
            displayBOMTableSales();
            updateBOMStatisticsSales();
            
            console.log('âœ… í† ê¸€ ì™„ë£Œ');
        }

        // BOM í†µê³„ ì—…ë°ì´íŠ¸ (ì €ì¥ì§€ì  86 ë°©ì‹)
        function updateBOMStatisticsSales() {
            if (!salesBOMData || salesBOMData.length === 0) return;
            
            const totalItems = salesBOMData.length;
            const visibleItems = salesBOMData.filter(item => item.isVisible).length;
            const maxDepth = Math.max(...salesBOMData.map(item => item.depth));
            const parentItems = salesBOMData.filter(item => item.children.length > 0).length;
            
            // í†µê³„ í‘œì‹œ ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
            const totalElement = document.getElementById('total-items-sales');
            const visibleElement = document.getElementById('visible-items-sales');
            const maxDepthElement = document.getElementById('max-depth-sales');
            const parentElement = document.getElementById('parent-items-sales');
            
            if (totalElement) totalElement.textContent = totalItems;
            if (visibleElement) visibleElement.textContent = visibleItems;
            if (maxDepthElement) maxDepthElement.textContent = maxDepth;
            if (parentElement) parentElement.textContent = parentItems;
            
            console.log(`ğŸ“Š BOM í†µê³„: ì „ì²´ ${totalItems}, í‘œì‹œ ${visibleItems}, ìµœëŒ€ ê¹Šì´ ${maxDepth}, ë¶€ëª¨ ${parentItems}`);
        }

        // BOM Cube ì…€ì˜ ë“¤ì—¬ì“°ê¸° ë ˆë²¨ ì •í™• ê³„ì‚° í•¨ìˆ˜
        function calculateIndentationLevel(text) {
            if (!text || typeof text !== 'string') return 0;
            
            console.log(`ğŸ”¬ ë“¤ì—¬ì“°ê¸° ë¶„ì„ ì‹œì‘: "${text}"`);
            
            // ë‹¤ì–‘í•œ ë“¤ì—¬ì“°ê¸° íŒ¨í„´ ê°ì§€
            let indentLevel = 0;
            
            // 1. íƒ­ ë¬¸ì ìš°ì„  ê°ì§€
            const tabMatch = text.match(/^(\t+)/);
            if (tabMatch) {
                indentLevel = tabMatch[1].length;
                console.log(`ğŸ” íƒ­ ê°ì§€: ${indentLevel}ê°œ íƒ­ = depth ${indentLevel}`);
                return indentLevel;
            }
            
            // 2. ê³µë°± ë¬¸ì íŒ¨í„´ ë¶„ì„ - ê°œì„ ëœ ë¡œì§
            const spaceMatch = text.match(/^(\s+)/);  // ëª¨ë“  ê³µë°± ë¬¸ì í¬í•¨
            if (spaceMatch) {
                const whitespaceText = spaceMatch[1];
                const spaceCount = whitespaceText.length;
                
                console.log(`ğŸ” ê³µë°± ìƒì„¸ ë¶„ì„: "${whitespaceText}" (${spaceCount}ê°œ)`);
                console.log('ğŸ” ê³µë°± ë¬¸ì ì½”ë“œ:', Array.from(whitespaceText).map(char => char.charCodeAt(0)).join(','));
                
                // Excelì˜ ë‹¤ì–‘í•œ ë“¤ì—¬ì“°ê¸° íŒ¨í„´ ëŒ€ì‘
                if (spaceCount === 0) {
                    indentLevel = 0;
                } else if (spaceCount >= 1 && spaceCount <= 2) {
                    indentLevel = 1;
                } else if (spaceCount >= 3 && spaceCount <= 5) {
                    indentLevel = 1;
                } else if (spaceCount >= 6 && spaceCount <= 8) {
                    indentLevel = 2;
                } else if (spaceCount >= 9 && spaceCount <= 11) {
                    indentLevel = 3;
                } else if (spaceCount >= 12 && spaceCount <= 15) {
                    indentLevel = 4;
                } else if (spaceCount >= 16 && spaceCount <= 20) {
                    indentLevel = 5;
                } else {
                    // ë§¤ìš° ë§ì€ ê³µë°±ì˜ ê²½ìš° - íŠ¹ë³„ ì²˜ë¦¬
                    if (spaceCount > 20) {
                        // "Documentation for steel tower supplier"ì²˜ëŸ¼ ë§¤ìš° ê¹Šê²Œ ë“¤ì—¬ì“°ê¸°ëœ ê²½ìš°
                        indentLevel = Math.min(Math.floor(spaceCount / 4), 10); // ìµœëŒ€ 10ë ˆë²¨ë¡œ ì œí•œ
                    } else {
                        indentLevel = Math.floor(spaceCount / 3); // 3ê³µë°±ë‹¹ 1ë ˆë²¨ ê¸°ë³¸
                    }
                }
                
                console.log(`ğŸ” ê³µë°± ê°ì§€: ${spaceCount}ê°œ ê³µë°± = depth ${indentLevel}`);
                return indentLevel;
            }
            
            // 3. ë¹„í‘œì‹œ ë¬¸ì íŒ¨í„´ (NBSP ë“±)
            const nonBreakingSpaceMatch = text.match(/^(\u00A0+|\u2000+|\u2001+|\u2002+|\u2003+|\u2004+|\u2005+|\u2006+|\u2007+|\u2008+|\u2009+|\u200A+)+/);
            if (nonBreakingSpaceMatch) {
                const nbspCount = nonBreakingSpaceMatch[0].length;
                indentLevel = Math.floor(nbspCount / 2); // ë¹„í‘œì‹œê³µë°± 2ê°œë‹¹ 1ë ˆë²¨
                return indentLevel;
            }
            
            // 4. ì‹¤ì œ ë“¤ì—¬ì“°ê¸° ìˆ˜ì¤€ì„ ì¶”ì •í•˜ëŠ” ê³ ê¸‰ ë¡œì§
            // Excelì—ì„œ ë³µì‚¬í•œ ë°ì´í„°ì˜ ê²½ìš° ì‹¤ì œ ë“¤ì—¬ì“°ê¸°ê°€ ë‹¤ì–‘í•œ í˜•íƒœë¡œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŒ
            const trimmed = text.trim();
            const originalLength = text.length;
            const trimmedLength = trimmed.length;
            const leadingWhitespace = originalLength - trimmedLength;
            
            if (leadingWhitespace > 0) {
                // ë“¤ì—¬ì“°ê¸° ë¬¸ìë“¤ì„ ë¶„ì„
                const whitespaceChars = text.substring(0, leadingWhitespace);
                
                // ì—°ì†ëœ ê³µë°± ê·¸ë£¹ ìˆ˜ë¡œ ë ˆë²¨ ê²°ì • (ë” ì •í™•í•œ ë°©ë²•)
                const spaceGroups = whitespaceChars.split(/[^\s]/).filter(group => group.length > 0);
                if (spaceGroups.length > 0) {
                    // ê° ê·¸ë£¹ì˜ í¬ê¸°ë¥¼ ë¶„ì„
                    const avgGroupSize = spaceGroups.reduce((sum, group) => sum + group.length, 0) / spaceGroups.length;
                    
                    if (avgGroupSize <= 2) {
                        indentLevel = Math.max(1, Math.floor(leadingWhitespace / 2));
                    } else if (avgGroupSize <= 4) {
                        indentLevel = Math.max(1, Math.floor(leadingWhitespace / 4));
                    } else {
                        indentLevel = Math.max(1, Math.floor(leadingWhitespace / 6));
                    }
                } else {
                    // ê¸°ë³¸ì ìœ¼ë¡œ 3ê³µë°±ë‹¹ 1ë ˆë²¨ (Excel ì¼ë°˜ì  íŒ¨í„´)
                    indentLevel = Math.floor(leadingWhitespace / 3);
                }
            }
            
            return Math.max(0, indentLevel);
        }

        // ì»¬ëŸ¼ ì°¾ê¸° í•¨ìˆ˜
        function findColumnIndexSales(headers, possibleNames) {
            for (let i = 0; i < headers.length; i++) {
                const header = (headers[i] || '').toString().toLowerCase().trim();
                for (const name of possibleNames) {
                    if (header.includes(name.toLowerCase())) {
                        return i;
                    }
                }
            }
            return -1;
        }

        // ì „ì²´ í¼ì¹˜ê¸° (ì €ì¥ì§€ì  86 ë°©ì‹)
        function expandAllTreeRowsSales() {
            console.log('ğŸ”„ SalesíŒ€: ì „ì²´ íŠ¸ë¦¬ í¼ì¹˜ê¸°');
            
            if (!salesBOMData || salesBOMData.length === 0) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ëª¨ë“  ì•„ì´í…œì„ ë³´ì´ê²Œ ì„¤ì •
            salesBOMData.forEach(item => {
                item.isVisible = true;
            });
            
            displayBOMTableSales();
            updateBOMStatisticsSales();
            
            console.log('âœ… ì „ì²´ í¼ì¹˜ê¸° ì™„ë£Œ');
        }

        // ì „ì²´ ì ‘ê¸° (ì €ì¥ì§€ì  86 ë°©ì‹)  
        function collapseAllTreeRowsSales() {
            console.log('ğŸ”„ SalesíŒ€: ì „ì²´ íŠ¸ë¦¬ ì ‘ê¸°');
            
            if (!salesBOMData || salesBOMData.length === 0) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // Depth 0ë§Œ ë³´ì´ê²Œ ì„¤ì •
            salesBOMData.forEach(item => {
                item.isVisible = item.depth === 0;
            });
            
            displayBOMTableSales();
            updateBOMStatisticsSales();
            
            console.log('âœ… ì „ì²´ ì ‘ê¸° ì™„ë£Œ');
        }

        // ë ˆë²¨ë³„ í¼ì¹˜ê¸° (ì €ì¥ì§€ì  86 ë°©ì‹)
        function expandToLevelSales(maxLevel) {
            console.log(`ğŸ”„ SalesíŒ€: ë ˆë²¨ ${maxLevel}ê¹Œì§€ í¼ì¹˜ê¸°`);
            
            if (!salesBOMData || salesBOMData.length === 0) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì§€ì •ëœ ë ˆë²¨ê¹Œì§€ë§Œ ë³´ì´ê²Œ ì„¤ì •
            salesBOMData.forEach(item => {
                item.isVisible = item.depth <= maxLevel;
            });
            
            displayBOMTableSales();
            updateBOMStatisticsSales();
            
            console.log(`âœ… ë ˆë²¨ ${maxLevel}ê¹Œì§€ í¼ì¹˜ê¸° ì™„ë£Œ`);
        }

        // í‘œì‹œëœ ì•„ì´í…œ ë‚´ë³´ë‚´ê¸° (ì €ì¥ì§€ì  86 ë°©ì‹)
        function exportVisibleItemsSales() {
            console.log('ğŸ’¾ í‘œì‹œëœ ì•„ì´í…œ ë‚´ë³´ë‚´ê¸°');
            
            if (!salesBOMData || salesBOMData.length === 0) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const visibleItems = salesBOMData.filter(item => item.isVisible);
            const csvData = [
                ['Depth', 'Name', 'Number', 'Version', 'Find Number', 'Quantity', 'Unit', 'Weight', 'Material'],
                ...visibleItems.map(item => [
                    item.depth,
                    item.name,
                    item.number,
                    item.version,
                    item.findNumber,
                    item.quantity,
                    item.unit,
                    item.weight,
                    item.material
                ])
            ];
            
            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `BOM_Visible_Items_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log(`âœ… ${visibleItems.length}ê°œ ì•„ì´í…œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ`);
        }
        
        // BOM íŠ¸ë¦¬ ë Œë”ë§
        function renderBOMTreeSales() {
            console.log('ğŸŒ³ BOM íŠ¸ë¦¬ ë Œë”ë§ ì‹œì‘:', salesBOMData.length, 'ê°œ ì•„ì´í…œ');
            
            // ìƒˆë¡œìš´ ë°©ì‹ìœ¼ë¡œ í…Œì´ë¸” í‘œì‹œ (ì €ì¥ì§€ì  86 ë°©ì‹)
            displayBOMTableSales();
            
            console.log('âœ… SalesíŒ€ BOM íŠ¸ë¦¬ ë Œë”ë§ ì™„ë£Œ');
        }
        
        // ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ (ì™„ì „í•œ ë²„ì „)
        function uploadDrawingPackageSales() {
            console.log('ğŸš€ğŸš€ğŸš€ ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ í•¨ìˆ˜ ì‹œì‘ë¨!');
            console.log('ì„ íƒëœ í”„ë¡œì íŠ¸:', selectedProjectForAnalysis);
            console.log('BOM ë°ì´í„°:', salesBOMData);
            
            // ì„ íƒëœ í”„ë¡œì íŠ¸ í™•ì¸
            if (!selectedProjectForAnalysis) {
                console.error('âŒ ì„ íƒëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŒ');
                alert('ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // BOM ë°ì´í„° í™•ì¸
            if (!salesBOMData || salesBOMData.length === 0) {
                alert('ë¨¼ì € BOM íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const fileInput = document.getElementById('drawing-package-input-sales');
            const files = Array.from(fileInput.files);
            
            if (files.length === 0) {
                alert('ë“œë¡œì‰ íŒ¨í‚¤ì§€ í´ë”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ ì‹œì‘:', files.length, 'ê°œ íŒŒì¼');
            
            // ğŸ”¥ PDF íŒŒì¼ë§Œ í•„í„°ë§
            const pdfFiles = files.filter(file => file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf'));
            console.log(`ğŸ“„ PDF íŒŒì¼ í•„í„°ë§: ${pdfFiles.length}ê°œ PDF íŒŒì¼ ë°œê²¬`);
            
            if (pdfFiles.length === 0) {
                alert('PDF íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë“œë¡œì‰ íŒ¨í‚¤ì§€ì— PDF íŒŒì¼ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ğŸ”¥ ìƒˆë¡œìš´ ì§ì ‘ ë¹„êµ ë°©ì‹ìœ¼ë¡œ BOMê³¼ PDF ë§¤ì¹­
            console.log('ğŸ“Š ìƒˆë¡œìš´ ì§ì ‘ ë¹„êµ ë°©ì‹ìœ¼ë¡œ BOM-PDF ë§¤ì¹­ ì‹œì‘...');
            
            // salesDrawingPackageì— PDF íŒŒì¼ ì €ì¥ (ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡)
            salesDrawingPackage = pdfFiles;
            
            // ê¸°ì¡´ matchDrawingsWithBOMSales í•¨ìˆ˜ ì‚¬ìš©
            let matchedCount = 0;
            let totalBOMItems = 0;
            
            salesBOMData.forEach((bomItem, index) => {
                if (!bomItem.number || bomItem.number === '') {
                    console.log(`âš ï¸ BOM í•­ëª© ${index}: Numberê°€ ë¹„ì–´ìˆìŒ - "${bomItem.name}"`);
                    bomItem.hasDrawing = false;
                    bomItem.drawingFile = null;
                    bomItem.drawingFileName = '';
                    return;
                }
                
                // Numberê°€ ìˆëŠ” í•­ëª©ë§Œ ì¹´ìš´íŠ¸
                totalBOMItems++;
                
                const bomNumber = bomItem.number.toString().trim();
                console.log(`ğŸ” BOM í•­ëª© ${index}: "${bomItem.name}" - Number: "${bomNumber}"`);
                
                // ìƒˆë¡œìš´ ì§ì ‘ ë¹„êµ ë°©ì‹ìœ¼ë¡œ ë§¤ì¹­ ì‹œë„
                let matchedPDF = null;
                
                for (const pdfFile of pdfFiles) {
                    if (isNumberMatch(bomNumber, pdfFile.name)) {
                        matchedPDF = pdfFile;
                        console.log(`âœ… ì§ì ‘ ë¹„êµ ë§¤ì¹­ ì„±ê³µ: "${bomNumber}" â†” "${pdfFile.name}"`);
                        break;
                    }
                }
                
                if (matchedPDF) {
                    // ë§¤ì¹­ ì„±ê³µ
                    bomItem.hasDrawing = true;
                    bomItem.drawingFile = matchedPDF;
                    bomItem.drawingFileName = matchedPDF.name;
                    matchedCount++;
                    
                    console.log(`âœ… ìµœì¢… ë§¤ì¹­ ì„±ê³µ: "${bomItem.name}" (${bomNumber}) â†” "${matchedPDF.name}"`);
                } else {
                    // ë§¤ì¹­ ì‹¤íŒ¨
                    bomItem.hasDrawing = false;
                    bomItem.drawingFile = null;
                    bomItem.drawingFileName = '';
                    
                    console.log(`âŒ ë§¤ì¹­ ì‹¤íŒ¨: "${bomItem.name}" (${bomNumber}) - í•´ë‹¹í•˜ëŠ” PDF ì—†ìŒ`);
                }
            });
            
            // ğŸ”¥ ë§¤ì¹­ ê²°ê³¼ ì—…ë°ì´íŠ¸
            salesDrawingPackage = pdfFiles;
            
            // ğŸ”¥ BOM í…Œì´ë¸” ë‹¤ì‹œ ê·¸ë¦¬ê¸° (ë§¤ì¹­ ê²°ê³¼ ë°˜ì˜)
            displayBOMTableSales();
            
            // í”„ë¡œì íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
            selectedProjectForAnalysis.drawingLinked = true;
            selectedProjectForAnalysis.drawingLinkedAt = new Date().toISOString();
            selectedProjectForAnalysis.drawingMatchingResults = {
                totalPDFs: pdfFiles.length,
                totalBOMItems: totalBOMItems,
                matchedCount: matchedCount,
                successRate: totalBOMItems > 0 ? (matchedCount / totalBOMItems * 100).toFixed(1) : 0
            };
            
            // ğŸ”¥ í”„ë¡œì íŠ¸ì— ì—…ë°ì´íŠ¸ëœ BOM ë°ì´í„° ì €ì¥ (ë“œë¡œì‰ ë§¤ì¹­ ì •ë³´ í¬í•¨)
            selectedProjectForAnalysis.bomData = salesBOMData;
            console.log(`ğŸ’¾ í”„ë¡œì íŠ¸ "${selectedProjectForAnalysis.name}"ì— ë“œë¡œì‰ ë§¤ì¹­ëœ BOM ë°ì´í„° ì €ì¥ë¨:`, salesBOMData.length, 'ê°œ ì•„ì´í…œ');
            
            // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const projectIndex = salesProjectList.findIndex(p => p.id === selectedProjectForAnalysis.id);
            if (projectIndex >= 0) {
                salesProjectList[projectIndex] = selectedProjectForAnalysis;
                saveProjectListToStorage();
                updateProjectListDisplay();
            }
            
            // ğŸ”¥ ê²°ê³¼ ì•Œë¦¼
            const successRate = totalBOMItems > 0 ? (matchedCount / totalBOMItems * 100).toFixed(1) : 0;
            
            console.log('ğŸ“Š ë§¤ì¹­ ê²°ê³¼ ì¤€ë¹„ë¨:', {
                totalPDFs: pdfFiles.length,
                totalBOMItems: totalBOMItems,
                matchedCount: matchedCount,
                successRate: successRate
            });
            
            // ğŸ”¥ ê°„ë‹¨í•œ ë§¤ì¹­ ê²°ê³¼ íŒì—…
            alert(`ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ ì™„ë£Œ!\n\nì „ì²´ ë„ë©´: ${pdfFiles.length}ê°œ\në§¤ì¹­ ì„±ê³µ: ${matchedCount}ê°œ (${successRate}%)`);
            
            console.log('âœ… ë“œë¡œì‰ ë§¤ì¹­ ì™„ë£Œ - ìë™ í”„ë¡œì íŠ¸ ì €ì¥ ì‹œì‘');
            
            // ğŸ”¥ ìë™ìœ¼ë¡œ í”„ë¡œì íŠ¸ ì €ì¥ (ê¸°ì¡´ ì‹œìŠ¤í…œ ë“±ë¡ ë¡œì§)
            autoSaveProject();
            
            // ğŸ”¥ ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ ì„¹ì…˜ í‘œì‹œ
            displayUnmatchedItems();
        }
        
        // ğŸ”¥ ìë™ í”„ë¡œì íŠ¸ ì €ì¥ í•¨ìˆ˜
        function autoSaveProject() {
            console.log('ğŸš€ í”„ë¡œì íŠ¸ ìë™ ì €ì¥ ì‹œì‘');
            
            if (!selectedProjectForAnalysis) {
                console.error('âŒ í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•ŠìŒ');
                return;
            }
            
            // í”„ë¡œì íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸ - "ë„ë©´ ë§í¬ ì™„ë£Œ"ë¡œ í‘œì‹œ
            selectedProjectForAnalysis.drawingLinkedComplete = true;
            selectedProjectForAnalysis.completedAt = new Date().toISOString();
            
            // BOM ë°ì´í„°ì—ì„œ ìˆœí™˜ ì°¸ì¡° ì œê±° í›„ ì €ì¥
            selectedProjectForAnalysis.bomData = removeBOMCircularReferences(salesBOMData);
            
            // ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì •ë³´ ì €ì¥
            selectedProjectForAnalysis.drawingPackage = salesDrawingPackage.map(f => {
                const bomNumber = f.name.replace(/[-_].*\.pdf$/i, '').trim();
                const matchedBomItem = salesBOMData.find(item => 
                    item.number && item.number.includes(bomNumber)
                );
                
                return {
                    name: f.name,
                    fileName: f.name,
                    size: f.size,
                    type: f.type,
                    bomNumber: matchedBomItem ? matchedBomItem.number : bomNumber
                };
            });
            
            // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const projectIndex = salesProjectList.findIndex(p => p.id === selectedProjectForAnalysis.id);
            if (projectIndex >= 0) {
                salesProjectList[projectIndex] = selectedProjectForAnalysis;
                
                if (saveProjectListToStorage()) {
                    updateProjectListDisplay();
                    console.log('âœ… í”„ë¡œì íŠ¸ ìë™ ì €ì¥ ì™„ë£Œ');
                }
            }
        }

        // ===== ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ ê´€ë¦¬ í•¨ìˆ˜ë“¤ =====
        
        // ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ í‘œì‹œ
        function displayUnmatchedItems() {
            console.log('ğŸ“‹ ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ í‘œì‹œ ì‹œì‘');
            
            // ë§¤ì¹­ ì‹¤íŒ¨í•œ ì•„ì´í…œ í•„í„°ë§ (Numberê°€ ìˆê³ , Eë¡œ ì‹œì‘í•˜ë©°, hasDrawingì´ falseì¸ í•­ëª©)
            const unmatchedItems = salesBOMData.filter(item => {
                if (!item.number || item.number === '') return false;
                const numberUpper = item.number.toString().trim().toUpperCase();
                // Eë¡œ ì‹œì‘í•˜ëŠ” ë„ë©´ë²ˆí˜¸ë§Œ í•„í„°ë§ (GST ë“±ì€ ì œì™¸)
                if (!numberUpper.startsWith('E')) return false;
                return !item.hasDrawing;
            });
            
            console.log(`ğŸ“Š ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ: ${unmatchedItems.length}ê°œ`);
            
            if (unmatchedItems.length === 0) {
                // ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œì´ ì—†ìœ¼ë©´ ì„¹ì…˜ ìˆ¨ê¹€
                document.getElementById('unmatched-items-section-sales').classList.add('hidden');
                return;
            }
            
            // ì„¹ì…˜ í‘œì‹œ
            document.getElementById('unmatched-items-section-sales').classList.remove('hidden');
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('unmatched-total-count').textContent = unmatchedItems.length;
            document.getElementById('unmatched-count-badge').textContent = `${unmatchedItems.length}ê°œ ëˆ„ë½`;
            document.getElementById('unmatched-selected-count').textContent = '0';
            document.getElementById('unmatched-after-delete-count').textContent = unmatchedItems.length;
            
            // í…Œì´ë¸” ë Œë”ë§
            const tbody = document.getElementById('unmatched-items-body');
            tbody.innerHTML = '';
            
            unmatchedItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-orange-50 transition-colors';
                row.dataset.itemId = item.id;
                
                row.innerHTML = `
                    <td class="px-2 py-2 border-r text-center">
                        <input type="checkbox" class="unmatched-item-checkbox w-4 h-4 text-blue-600 rounded" 
                               data-item-id="${item.id}" onchange="updateUnmatchedSelectionCount()">
                    </td>
                    <td class="px-2 py-2 border-r text-xs">${item.depth || ''}</td>
                    <td class="px-2 py-2 border-r text-xs">${item.name || ''}</td>
                    <td class="px-2 py-2 border-r text-xs font-mono text-blue-600">${item.number || ''}</td>
                    <td class="px-2 py-2 border-r text-xs">${item.version || ''}</td>
                    <td class="px-2 py-2 border-r text-xs text-center">${item.findNumber || ''}</td>
                    <td class="px-2 py-2 border-r text-xs text-right">${item.quantity || ''}</td>
                    <td class="px-2 py-2 border-r text-xs">${item.unit || ''}</td>
                    <td class="px-2 py-2 border-r text-xs text-right">${item.weight || ''}</td>
                    <td class="px-2 py-2 text-xs">${item.material || ''}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log('âœ… ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ');
        }
        
        // ì „ì²´ ì„ íƒ/í•´ì œ
        function toggleAllUnmatchedSelection() {
            const selectAllCheckbox = document.getElementById('select-all-unmatched');
            const headerCheckbox = document.getElementById('header-select-all-unmatched');
            const itemCheckboxes = document.querySelectorAll('.unmatched-item-checkbox');
            
            // ë‘ ì²´í¬ë°•ìŠ¤ ë™ê¸°í™”
            if (selectAllCheckbox) headerCheckbox.checked = selectAllCheckbox.checked;
            if (headerCheckbox) selectAllCheckbox.checked = headerCheckbox.checked;
            
            const isChecked = selectAllCheckbox ? selectAllCheckbox.checked : headerCheckbox.checked;
            
            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateUnmatchedSelectionCount();
        }
        
        // ì„ íƒ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateUnmatchedSelectionCount() {
            const selectedCheckboxes = document.querySelectorAll('.unmatched-item-checkbox:checked');
            const totalCount = parseInt(document.getElementById('unmatched-total-count').textContent);
            const selectedCount = selectedCheckboxes.length;
            const afterDeleteCount = totalCount - selectedCount;
            
            document.getElementById('unmatched-selected-count').textContent = selectedCount;
            document.getElementById('unmatched-after-delete-count').textContent = afterDeleteCount;
            document.getElementById('unmatched-delete-count').textContent = selectedCount;
            
            // ì‚­ì œ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            const deleteButton = document.getElementById('btn-delete-selected-unmatched');
            deleteButton.disabled = selectedCount === 0;
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            const allCheckboxes = document.querySelectorAll('.unmatched-item-checkbox');
            const selectAllCheckbox = document.getElementById('select-all-unmatched');
            const headerCheckbox = document.getElementById('header-select-all-unmatched');
            
            if (allCheckboxes.length > 0) {
                const isAllChecked = selectedCount === allCheckboxes.length;
                const isPartialChecked = selectedCount > 0 && selectedCount < allCheckboxes.length;
                
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = isAllChecked;
                    selectAllCheckbox.indeterminate = isPartialChecked;
                }
                if (headerCheckbox) {
                    headerCheckbox.checked = isAllChecked;
                    headerCheckbox.indeterminate = isPartialChecked;
                }
            }
        }
        
        // ì„ íƒëœ í•­ëª© ì‚­ì œ
        function deleteSelectedUnmatchedItems() {
            const selectedCheckboxes = document.querySelectorAll('.unmatched-item-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                alert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const confirmMessage = `ì„ íƒí•œ ${selectedCheckboxes.length}ê°œ í•­ëª©ì„ BOMì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‚­ì œëœ í•­ëª©ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìœ¼ë©°, Excel ë‚´ë³´ë‚´ê¸°ì—ë„ í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            // ì„ íƒëœ í•­ëª©ì˜ ID ìˆ˜ì§‘
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.itemId);
            
            console.log('ğŸ—‘ï¸ ì‚­ì œí•  í•­ëª© ID:', selectedIds);
            
            // salesBOMDataì—ì„œ í•´ë‹¹ í•­ëª© ì œê±°
            salesBOMData = salesBOMData.filter(item => !selectedIds.includes(item.id));
            
            console.log(`âœ… ${selectedIds.length}ê°œ í•­ëª© ì‚­ì œ ì™„ë£Œ. ë‚¨ì€ í•­ëª©: ${salesBOMData.length}ê°œ`);
            
            // BOM í…Œì´ë¸” ì¬ë Œë”ë§
            buildBOMHierarchySales();
            displayBOMTableSales();
            
            // ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ í…Œì´ë¸” ì¬ë Œë”ë§
            displayUnmatchedItems();
            
            // í”„ë¡œì íŠ¸ ì €ì¥
            if (selectedProjectForAnalysis) {
                selectedProjectForAnalysis.bomData = removeBOMCircularReferences(salesBOMData);
                const projectIndex = salesProjectList.findIndex(p => p.id === selectedProjectForAnalysis.id);
                if (projectIndex >= 0) {
                    salesProjectList[projectIndex] = selectedProjectForAnalysis;
                    saveProjectListToStorage();
                }
            }
            
            alert(`âœ… ${selectedIds.length}ê°œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // Excelë¡œ ë‚´ë³´ë‚´ê¸°
        function exportUnmatchedToExcel() {
            console.log('ğŸ“¤ ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ Excel ë‚´ë³´ë‚´ê¸° ì‹œì‘');
            
            // í˜„ì¬ í‘œì‹œëœ ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œ ê°€ì ¸ì˜¤ê¸°
            const unmatchedItems = salesBOMData.filter(item => {
                if (!item.number || item.number === '') return false;
                const numberUpper = item.number.toString().trim().toUpperCase();
                if (!numberUpper.startsWith('E')) return false;
                return !item.hasDrawing;
            });
            
            if (unmatchedItems.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë§¤ì¹­ ì‹¤íŒ¨ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // CSV í˜•ì‹ìœ¼ë¡œ ë°ì´í„° ìƒì„±
            let csvContent = '\uFEFF'; // UTF-8 BOM for Excel
            
            // í—¤ë”
            csvContent += 'Depth,Name,Number,Version,FindNumber,Quantity,Unit,Weight,Material\n';
            
            // ë°ì´í„° í–‰
            unmatchedItems.forEach(item => {
                const row = [
                    item.depth || '',
                    `"${(item.name || '').replace(/"/g, '""')}"`, // í°ë”°ì˜´í‘œ ì´ìŠ¤ì¼€ì´í”„
                    item.number || '',
                    item.version || '',
                    item.findNumber || '',
                    item.quantity || '',
                    item.unit || '',
                    item.weight || '',
                    item.material || ''
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const projectName = selectedProjectForAnalysis ? selectedProjectForAnalysis.name : 'project';
            const fileName = `${projectName}_ë§¤ì¹­ì‹¤íŒ¨_ë„ë©´ëª©ë¡_${new Date().toISOString().split('T')[0]}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log(`âœ… Excel íŒŒì¼ ìƒì„± ì™„ë£Œ: ${fileName}`);
            alert(`âœ… Excel íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${fileName}\ní•­ëª© ìˆ˜: ${unmatchedItems.length}ê°œ`);
        }

        // íŒŒì¼ ì •ë¦¬ í•¨ìˆ˜ë“¤
        function clearBOMFileSales() {
            const fileInput = document.getElementById('bom-file-input-sales');
            const infoDiv = document.getElementById('selected-bom-file-info-sales');
            
            if (fileInput) fileInput.value = '';
            if (infoDiv) infoDiv.classList.add('hidden');
        }

        function clearDrawingPackageSales() {
            const fileInput = document.getElementById('drawing-package-input-sales');
            const infoDiv = document.getElementById('selected-drawing-info-sales');
            
            if (fileInput) fileInput.value = '';
            if (infoDiv) infoDiv.classList.add('hidden');
        }

        // BOM ë°ì´í„°ì—ì„œ ìˆœí™˜ ì°¸ì¡° ì œê±° í—¬í¼ í•¨ìˆ˜
        function removeBOMCircularReferences(bomData) {
            if (!bomData || !Array.isArray(bomData)) return null;
            
            return bomData.map(item => {
                // ìˆœí™˜ ì°¸ì¡°ê°€ ìˆëŠ” ì†ì„±ë“¤ ì œì™¸í•˜ê³  ë³µì‚¬
                const cleanItem = {
                    id: item.id,
                    depth: item.depth,
                    name: item.name,
                    number: item.number,
                    version: item.version,
                    findNumber: item.findNumber,
                    quantity: item.quantity,
                    unit: item.unit,
                    weight: item.weight,
                    material: item.material,
                    isVisible: item.isVisible,
                    hasDrawing: item.hasDrawing,
                    drawingFileName: item.drawingFileName
                };
                
                return cleanItem;
            });
        }

        // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ localStorageì— ì•ˆì „í•˜ê²Œ ì €ì¥
        function saveProjectListToStorage() {
            try {
                // ê° í”„ë¡œì íŠ¸ì˜ bomDataì—ì„œ ìˆœí™˜ ì°¸ì¡° ì œê±°
                const cleanProjectList = salesProjectList.map(p => {
                    const cleanProject = {...p};
                    if (cleanProject.bomData && Array.isArray(cleanProject.bomData)) {
                        cleanProject.bomData = removeBOMCircularReferences(cleanProject.bomData);
                    }
                    return cleanProject;
                });
                
                localStorage.setItem('cswind-sales-projects', JSON.stringify(cleanProjectList));
                console.log('âœ… í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ê°€ localStorageì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                return true;
            } catch (error) {
                console.error('âŒ localStorage ì €ì¥ ì˜¤ë¥˜:', error);
                alert('í”„ë¡œì íŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return false;
            }
        }

        // ğŸ”¥ ì‹œìŠ¤í…œ ë“±ë¡ í•¨ìˆ˜ ì œê±°ë¨ - autoSaveProject()ë¡œ ëŒ€ì²´

        // Prod. TechíŒ€ ê¸°ëŠ¥ë“¤

        // ë„ë©´ íŒ¨í‚¤ì§€ ëª©ë¡ í‘œì‹œ (Prod. TechíŒ€)
        function showDrawingPackageListProdTech() {
            const mockDrawingFiles = [
                'GST03371-001_Tower_Base_Flange.pdf',
                'E0004044163-00_Hub_Assembly.pdf',
                'E0002862040-01_Platform_Flange.pdf',
                'GST04521-002_Nacelle_Frame.pdf',
                'E0004282266-00_Rotor_Hub.pdf'
            ];
            
            const listContainer = document.getElementById('drawing-files-list-prodtech');
            if (!listContainer) return;
            
            listContainer.innerHTML = '';
            
            mockDrawingFiles.forEach((filename, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded border';
                fileItem.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-file-pdf text-red-600 mr-3"></i>
                        <span class="text-sm font-medium text-gray-700">${filename}</span>
                    </div>
                    <div class="text-xs text-gray-500">
                        ${(Math.random() * 5 + 1).toFixed(1)} MB
                    </div>
                `;
                listContainer.appendChild(fileItem);
            });
            
            document.getElementById('drawing-package-list-prodtech').classList.remove('hidden');
        }

        // AI MTO ìƒì„± ì‹œì‘ (Prod. TechíŒ€)
        function startAIMTOGeneration() {
            console.log('Prod. TechíŒ€ AI MTO ìƒì„± ì‹œì‘');
            
            // ì§„í–‰ í‘œì‹œ
            const progressDiv = document.getElementById('ai-analysis-progress-prodtech');
            const btn = document.getElementById('btn-ai-mto-generation');
            
            if (progressDiv) progressDiv.classList.remove('hidden');
            if (btn) btn.disabled = true;
            
            // ë‹¨ê³„ë³„ ì§„í–‰ ì‹œë®¬ë ˆì´ì…˜
            simulateAIAnalysisProdTech();
        }

        // Prod. TechíŒ€ AI ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
        function simulateAIAnalysisProdTech() {
            const steps = [
                { id: 'analysis-step-1-prodtech', text: 'BOM ë°ì´í„° êµ¬ì¡° ë¶„ì„ ì™„ë£Œ', delay: 2000 },
                { id: 'analysis-step-2-prodtech', text: 'ë„ë©´ íŒŒì¼ ì—°ê²° ìƒíƒœ í™•ì¸ ì™„ë£Œ', delay: 3000 },
                { id: 'analysis-step-3-prodtech', text: '8-way ìì¬ ë¶„ë¥˜ ì‹¤í–‰ ì™„ë£Œ', delay: 4000 },
                { id: 'analysis-step-4-prodtech', text: 'MTO ê²°ê³¼ ìƒì„± ì™„ë£Œ', delay: 5000 }
            ];
            
            steps.forEach((step, index) => {
                setTimeout(() => {
                    const stepElement = document.getElementById(step.id);
                    if (stepElement) {
                        stepElement.innerHTML = `
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span class="text-green-700">${step.text}</span>
                        `;
                    }
                    
                    // ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ ê²°ê³¼ í‘œì‹œ
                    if (index === steps.length - 1) {
                        setTimeout(() => {
                            showMTOResultsProdTech();
                        }, 1000);
                    }
                }, step.delay);
            });
        }

        // MTO ê²°ê³¼ í‘œì‹œ (Prod. TechíŒ€)
        function showMTOResultsProdTech() {
            const resultsContent = document.getElementById('mto-results-content-prodtech');
            
            if (!resultsContent) return;
            
            const mockResults = [
                { category: 'LLT (Long Lead Time)', count: 12, items: ['Main Bearing', 'Generator', 'Transformer'], color: 'red' },
                { category: 'ëª¨ë“ˆë‹¨ìœ„ ì¡°ë¦½í’ˆ', count: 8, items: ['Hub Assembly', 'Nacelle Frame', 'Tower Section'], color: 'blue' },
                { category: 'ê³ ê°•ë„ ê°•ì¬', count: 15, items: ['S355 Steel Plate', 'S690 High Strength Steel'], color: 'gray' },
                { category: 'í”Œëœì§€ë¥˜', count: 6, items: ['Base Flange', 'Platform Flange', 'Connection Flange'], color: 'orange' },
                { category: 'Small Parts', count: 45, items: ['Bolts M24', 'Washers', 'Nuts'], color: 'green' },
                { category: 'Large Parts', count: 7, items: ['Tower Shell', 'Door Frame', 'Ladder'], color: 'purple' },
                { category: 'ì „ì¥í’ˆ', count: 9, items: ['Control Panel', 'Cables', 'Sensors'], color: 'yellow' },
                { category: 'ê¸°íƒ€', count: 18, items: ['Gaskets', 'Seals', 'Lubricants'], color: 'gray' }
            ];
            
            resultsContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${mockResults.map(category => `
                        <div class="bg-${category.color}-50 border border-${category.color}-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-medium text-gray-800">${category.category}</h5>
                                <span class="bg-${category.color}-100 text-${category.color}-800 px-2 py-1 rounded-full text-xs font-medium">${category.count}ê°œ</span>
                            </div>
                            <div class="text-xs text-gray-600">
                                ${category.items.slice(0, 2).join(', ')}${category.items.length > 2 ? ' ì™¸' : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-4 p-4 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        <span class="font-medium text-green-800">AI ë¶„ì„ ì™„ë£Œ</span>
                    </div>
                    <p class="text-green-700 text-sm mt-1">ì´ 120ê°œ ì•„ì´í…œì´ 8ê°€ì§€ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            
            document.getElementById('ai-analysis-progress-prodtech').classList.add('hidden');
            document.getElementById('mto-results-section-prodtech').classList.remove('hidden');
        }

        // ìŠ¹ì¸ ìš”ì²­ (Prod. TechíŒ€)
        function submitApprovalRequestProdTech() {
            console.log('Prod. TechíŒ€ ìŠ¹ì¸ ìš”ì²­ ì‹œì‘');
            
            // ê¸°ì¡´ ìŠ¹ì¸ ì‹œìŠ¤í…œ í™œìš©
            if (window.csWindApp && window.csWindApp.advancedBOMManager) {
                // ê¸°ì¡´ ìŠ¹ì¸ ì‹œìŠ¤í…œê³¼ ì—°ë™
                window.csWindApp.advancedBOMManager.startApprovalWorkflow();
            } else {
                // ëŒ€ì²´ ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤
                alert('ìŠ¹ì¸ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nìƒì‚°ê¸°ìˆ ì â†’ SCMíŒ€ì¥ â†’ CEO ìˆœì„œë¡œ ìŠ¹ì¸ì´ ì§„í–‰ë©ë‹ˆë‹¤.');
            }
        }

        // localStorage ìš©ëŸ‰ ì •ë¦¬ ë° ìµœì í™”
        function cleanupLocalStorage() {
            try {
                const projects = JSON.parse(localStorage.getItem('cswind-sales-projects') || '[]');
                let cleanedProjects = [];
                
                projects.forEach(project => {
                    // bomData í•„ë“œê°€ ìˆìœ¼ë©´ ì œê±°í•˜ê³  ìš”ì•½ ì •ë³´ë§Œ ìœ ì§€
                    if (project.bomData) {
                        const cleanProject = {
                            ...project,
                            bomItemCount: Array.isArray(project.bomData) ? project.bomData.length : 0
                        };
                        delete cleanProject.bomData; // ëŒ€ìš©ëŸ‰ BOM ë°ì´í„° ì œê±°
                        cleanedProjects.push(cleanProject);
                        console.log(`ğŸ§¹ í”„ë¡œì íŠ¸ ${project.name}ì˜ BOM ë°ì´í„° ì •ë¦¬ë¨ (${cleanProject.bomItemCount}ê°œ ì•„ì´í…œ)`);
                    } else {
                        cleanedProjects.push(project);
                    }
                });
                
                localStorage.setItem('cswind-sales-projects', JSON.stringify(cleanedProjects));
                console.log('âœ… localStorage ì •ë¦¬ ì™„ë£Œ');
                return cleanedProjects;
            } catch (error) {
                console.error('âŒ localStorage ì •ë¦¬ ì‹¤íŒ¨:', error);
                // localStorageê°€ ì™„ì „íˆ ê°€ë“ ì°¬ ê²½ìš° ì „ì²´ ì‚­ì œ
                try {
                    localStorage.removeItem('cswind-sales-projects');
                    console.log('ğŸ—‘ï¸ localStorage ì „ì²´ ì‚­ì œ í›„ ì¬ì‹œì‘');
                    return [];
                } catch (clearError) {
                    console.error('âŒ localStorage ì‚­ì œë„ ì‹¤íŒ¨:', clearError);
                    return [];
                }
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ localStorage ì •ë¦¬
        cleanupLocalStorage();

        console.log('SalesíŒ€ ë° Prod. TechíŒ€ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');

        // Workbox ì„œë¹„ìŠ¤ ì›Œì»¤ í•´ì œ (ì´ì „ ìºì‹œ ë¬¸ì œ í•´ê²°)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    if (registration.scope.includes('workbox') || registration.active?.scriptURL?.includes('sw.js')) {
                        console.log('ğŸ§¹ Workbox ì„œë¹„ìŠ¤ ì›Œì»¤ í•´ì œ ì¤‘:', registration.scope);
                        registration.unregister();
                    }
                }
            }).catch(function(error) {
                console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ í•´ì œ ì¤‘ ì˜¤ë¥˜ (ë¬´ì‹œ ê°€ëŠ¥):', error);
            });
        }
    </script>

    <!-- ë„ë©´ ì¡°íšŒ ëª¨ë‹¬ -->
    <div id="drawing-search-modal" class="fixed inset-0 z-50 hidden pointer-events-none">
        <div id="drawing-search-window" class="bg-white rounded-lg shadow-2xl absolute pointer-events-auto" 
             style="top: 20px; right: 20px; width: 420px; min-width: 350px; max-width: 600px; resize: both; overflow: auto;">
            <div id="drawing-search-header" class="bg-blue-600 text-white px-4 py-3 rounded-t-lg cursor-move flex justify-between items-center">
                <h3 class="text-sm font-semibold flex items-center">
                    <i class="fas fa-search mr-2"></i>ë„ë©´ ì¡°íšŒ (Ctrl+F)
                </h3>
                <button onclick="closeDrawingSearchModal()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-4 space-y-3">
                <!-- Category 1 -->
                <div class="flex items-center space-x-2">
                    <label class="w-16 text-xs font-medium text-gray-700">Cat 1:</label>
                    <select id="search-field-1" class="flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                        <option value="depth">Depth</option>
                        <option value="name">Name</option>
                        <option value="number">Number</option>
                        <option value="version">Version</option>
                        <option value="findNumber">FindNumber</option>
                        <option value="quantity">Quantity</option>
                        <option value="unit">Unit</option>
                        <option value="weight">Weight</option>
                        <option value="material">Material</option>
                    </select>
                    <input type="text" id="search-value-1" placeholder="ê²€ìƒ‰ì–´" 
                           class="flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- Category 2 -->
                <div class="flex items-center space-x-2">
                    <label class="w-16 text-xs font-medium text-gray-700">Cat 2:</label>
                    <select id="search-field-2" class="flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                        <option value="depth">Depth</option>
                        <option value="name">Name</option>
                        <option value="number">Number</option>
                        <option value="version">Version</option>
                        <option value="findNumber">FindNumber</option>
                        <option value="quantity">Quantity</option>
                        <option value="unit">Unit</option>
                        <option value="weight">Weight</option>
                        <option value="material">Material</option>
                    </select>
                    <input type="text" id="search-value-2" placeholder="ê²€ìƒ‰ì–´" 
                           class="flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                </div>
                
                <!-- Category 3 -->
                <div class="flex items-center space-x-2">
                    <label class="w-16 text-xs font-medium text-gray-700">Cat 3:</label>
                    <select id="search-field-3" class="flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                        <option value="depth">Depth</option>
                        <option value="name">Name</option>
                        <option value="number">Number</option>
                        <option value="version">Version</option>
                        <option value="findNumber">FindNumber</option>
                        <option value="quantity">Quantity</option>
                        <option value="unit">Unit</option>
                        <option value="weight">Weight</option>
                        <option value="material">Material</option>
                    </select>
                    <input type="text" id="search-value-3" placeholder="ê²€ìƒ‰ì–´" 
                           class="flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                </div>
            </div>
            
            <div class="px-4 pb-3">
                <div id="search-result-info" class="text-xs text-gray-600 mb-2 min-h-[20px]">
                    <!-- ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜ í‘œì‹œ -->
                </div>
                <div class="flex space-x-2">
                    <button onclick="clearSearchConditions()" 
                            class="flex-1 px-2 py-1 text-xs bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">
                        <i class="fas fa-eraser mr-1"></i>ì´ˆê¸°í™”
                    </button>
                    <button onclick="executeDrawingSearch()" 
                            class="flex-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
                        <i class="fas fa-search mr-1"></i>ê²€ìƒ‰
                    </button>
                    <button onclick="findNextResult()" 
                            class="flex-1 px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors">
                        <i class="fas fa-arrow-down mr-1"></i>ë‹¤ìŒ
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>