# CSWIND MTO 시스템 - Save Point 104

## 🎯 프로젝트 개요
씨에스윈드 도면관리 & MTO (Make To Order) 자동화 시스템으로, Excel BOM 파일과 PDF 도면 파일을 자동으로 매칭하여 효율적인 도면 관리를 제공합니다.

## 🌐 접속 URL
- **🌟 Production (Cloudflare Pages)**: https://cswind-mto.pages.dev
- **🎉 최신 배포 (Save Point 104)**: https://acbbfea4.cswind-mto.pages.dev
- **개발 서버 (Sandbox)**: https://3000-i6ovkx4qstgf5tedcqtx9-a402f90a.sandbox.novita.ai

## ✅ 현재 완료된 기능 (Save Point 104 기준)

### 0. 매칭 실패 도면 관리 및 고객사 보고 기능 ✅ (Save Point 104!)
- **사용자 요청**: 드로잉 매칭 실패 아이템을 관리하고 고객사에 보고할 수 있는 기능 추가
- **새로운 기능**:
  - ✅ **매칭 실패 아이템 자동 필터링**: E로 시작하는 도면번호 중 PDF가 매칭되지 않은 항목만 표시
  - ✅ **체크박스 다중 선택**: 도면이 불필요한 항목을 선택하여 제거 가능
  - ✅ **선택 삭제 기능**: 불필요한 항목을 BOM에서 완전히 제거
  - ✅ **Excel 내보내기**: 최종 누락 도면 리스트를 CSV 파일로 내보내기
  - ✅ **실시간 통계**: 매칭 실패 총 개수, 선택된 개수, 삭제 후 남을 개수 표시
  - ✅ **BOM 헤더 구조 유지**: Depth, Name, Number, Version 등 전체 컬럼 정보 포함
  - ✅ **UTF-8 BOM 인코딩**: Excel에서 한글 깨짐 없이 정상 표시
- **사용 시나리오**:
  1. BOM 업로드 + 드로잉 패키지 업로드
  2. "매칭 실패 아이템" 섹션 자동 표시
  3. 도면이 실제로 불필요한 항목 선택 후 삭제
  4. "Excel로 내보내기" 버튼으로 고객사 보고용 파일 생성
  5. CSV 파일을 고객사에 전달하여 누락된 도면 요청
- **결과**:
  - 도면 누락 상황을 체계적으로 관리
  - 고객사 보고 프로세스 자동화
  - 불필요한 항목 제거로 정확한 보고
  - 프로젝트별 도면 누락 이력 관리 가능

## ✅ 현재 완료된 기능 (Save Point 103 기준)

### 0. 대시보드 및 디버깅 샘플 제거 ✅ (Save Point 103!)
- **사용자 요청**: 불필요한 대시보드 통계 섹션과 디버깅용 샘플 프로젝트 완전 삭제
- **수정 사항**:
  - ❌ 대시보드 탭 컨텐츠 완전 제거 (통계 카드, 빠른 작업, 데이터 시각화)
  - ❌ localStorage 초기화 코드 제거 (기존 프로젝트 보존) ✅ **프로젝트 영구 저장**
  - ❌ 디버깅용 샘플 프로젝트 생성 로직 제거 ("Excel 데이터 디버깅 프로젝트")
  - ❌ setTimeout 기반 BOM/드로잉 시뮬레이션 코드 제거 (140+ 라인)
  - ✅ **앱 시작 시 디버깅 프로젝트 자동 필터링 및 삭제** (Save Point 103.1)
- **결과**:
  - 깔끔한 프로젝트 초기 화면 (빈 프로젝트 리스트)
  - localStorage에 저장된 실제 프로젝트만 표시
  - 브라우저 새로고침해도 프로젝트 유지됨 (정상 동작)
  - 과거 localStorage에 남아있던 디버깅 샘플 자동 제거
  - 불필요한 테스트 코드 제거로 코드 품질 향상
  - 사용자가 직접 생성한 프로젝트만 관리

## ✅ 현재 완료된 기능 (Save Point 100~102 통합)

### 0. UI 단순화 - 프로젝트 관리 탭만 유지 ✅ (Save Point 100!)
- **사용자 요청**: 헤더의 불필요한 탭들 제거
- **수정 사항**:
  - ❌ 대시보드 탭 제거
  - ❌ BOM 분석 탭 제거
  - ❌ 서플라이어 탭 제거
  - ❌ PO 관리 탭 제거
  - ✅ **프로젝트 관리 탭만 유지**
- **결과**:
  - 상단 네비게이션이 단순화되어 사용자 혼란 감소
  - 페이지 로드 시 바로 프로젝트 관리 화면 표시
  - 핵심 기능(프로젝트 생성, BOM 업로드, 드로잉 매칭)에 집중
- **향후 확장성**:
  - 다른 탭 컨텐츠는 코드에 유지되어 있음
  - 필요시 네비게이션에 버튼만 추가하면 재활성화 가능

## ✅ 현재 완료된 기능 (Save Point 98~100 통합)

### 0. 메인 네비게이션 탭 전환 수정 ✅ (CRITICAL FIX - Save Point 99!)
- **발견된 문제**: 배포 환경에서 대시보드, 프로젝트 관리 등 메인 네비게이션 탭 전환 불가
- **근본 원인**: 
  - 메인 네비게이션 버튼들에 대한 클릭 이벤트 리스너가 완전히 누락됨
  - HTML에 버튼은 존재하지만 JavaScript에서 이벤트 처리 코드 없음
- **해결책**:
  - DOMContentLoaded에 네비게이션 탭 전환 이벤트 리스너 추가
  - `querySelectorAll('.nav-tab')`로 모든 네비게이션 버튼 선택
  - 클릭 시 탭 활성화 스타일 전환 및 컨텐츠 표시/숨김 처리
- **구현 내용**:
  1. 모든 `.nav-tab` 버튼에 클릭 이벤트 리스너 등록
  2. 클릭 시 모든 탭 비활성화 → 선택된 탭만 활성화
  3. 모든 `.tab-content` 숨김 → 선택된 컨텐츠만 표시
  4. 콘솔 로그로 디버깅 가능
- **동작 확인**:
  - ✅ 대시보드 탭 클릭 → `tab-dashboard` 표시
  - ✅ 프로젝트 관리 탭 클릭 → `tab-projects` 표시
  - ✅ BOM 분석 탭 클릭 → `tab-bom` 표시
  - ✅ 서플라이어 탭 클릭 → `tab-suppliers` 표시
  - ✅ PO 관리 탭 클릭 → `tab-mto` 표시

## ✅ 현재 완료된 기능 (Save Point 98~99 통합)

### 0. 시스템 등록 시 drawingFile 유지 ✅ (CRITICAL FIX - Save Point 98!)
- **발견된 문제**: 시스템 등록 직후 파란색 "보기" 버튼이 초록색 텍스트로 변경됨
- **근본 원인**: 
  - Save Point 94의 BOM 동기화 로직이 `drawingFile: null`로 명시적 설정 (라인 6974)
  - 이 로직은 IndexedDB 도입 이전에 localStorage의 한계를 해결하기 위해 만들어짐
  - Save Point 96에서 IndexedDB 도입 후 이 동기화 로직이 오히려 문제를 일으킴
- **해결책**:
  - **시스템 등록 후 BOM 동기화 로직 전체 제거** (라인 6958~6990)
  - **drawingFile 객체를 메모리에 유지**
  - IndexedDB에 이미 PDF 파일이 저장되어 있으므로 안전하게 유지 가능
- **결과**:
  - ✅ 시스템 등록 직후에도 파란색 "📄 보기" 버튼 유지
  - ✅ 시스템 등록 직후에도 PDF 열기 가능
  - ✅ 프로젝트 재진입 시 IndexedDB에서 파일 복원
  - ✅ 일관된 사용자 경험 (업로드 → 등록 → 재진입 모두 동일)
- **사용자 워크플로우**:
  ```
  1. 드로잉 업로드 → 파란색 "보기" 버튼 → PDF 팝업 ✅
  2. 시스템 등록 → 파란색 "보기" 버튼 유지 ✅ (이전: 초록색 텍스트로 변경 ❌)
  3. PDF 열기 테스트 → 정상 작동 ✅
  4. 프로젝트 리스트로 나가기
  5. 등록된 프로젝트 재진입 → 파란색 "보기" 버튼 표시 ✅ (IndexedDB 복원)
  6. PDF 열기 테스트 → 정상 작동 ✅
  ```

### 0. IndexedDB 비동기 타이밍 수정 ✅ (Save Point 97)
- **발견된 문제**: Save Point 96 구현 후에도 재진입 시 초록색 텍스트만 표시되는 버그
- **근본 원인**: 
  - `displayBOMTableSales()`가 IndexedDB 복원 **이전**에 호출됨 (라인 3484)
  - IndexedDB 복원은 비동기(Promise)이므로 파일 객체가 없는 상태로 테이블 렌더링
  - 결과: `drawingFile`이 없어서 초록색 파일명 텍스트만 표시
- **수정 사항**:
  1. **첫 번째 `displayBOMTableSales()` 호출 제거**: BOM 데이터 로드 직후 호출 제거
  2. **IndexedDB 복원 완료 후 렌더링**: Promise `.then()` 블록에서만 테이블 렌더링
  3. **예외 처리**: 드로잉 패키지가 없거나 IndexedDB 실패 시에도 테이블 렌더링
- **강화된 디버깅 로그**:
  - `loadAllDrawingFiles()`: IndexedDB 쿼리 시작/성공, 각 파일의 File 객체 여부 출력
  - `createBOMTableRowSales()`: `hasDrawing`이 true인 모든 항목의 상태 출력 (File/Blob 객체 여부 명시)

### 0. IndexedDB로 PDF 파일 영구 저장 ✅ (Save Point 96 - 타이밍 버그 수정됨)
- **핵심 해결**: 시스템 등록 후 재진입 시에도 PDF를 열 수 있도록 완전 해결!
- **문제**: localStorage는 File 객체를 저장할 수 없어서 재진입 시 PDF를 열 수 없었음
- **해결책**: IndexedDB 사용으로 File 객체를 브라우저에 영구 저장
- **IndexedDB 구조**:
  - 데이터베이스: `cswind-mto-db`
  - 스토어: `drawing-files`
  - 키: `projectId-bomNumber`
  - 저장 데이터: { projectId, bomNumber, fileName, file (File 객체), savedAt }
- **동작 방식**:
  1. **드로잉 업로드 시**: PDF 파일을 IndexedDB에 자동 저장
  2. **시스템 등록**: localStorage에 메타데이터만 저장 (기존 방식 유지)
  3. **프로젝트 재진입**: IndexedDB에서 PDF 파일 복원 → 실제 File 객체 사용 가능
  4. **PDF 열기**: 파란색 "보기" 버튼 → PDF 팝업 정상 작동 ✅
- **Save Point 97 수정**: 비동기 타이밍 문제 해결로 재진입 시 파란색 버튼 정상 표시
- **장점**:
  - ✅ 드로잉 재업로드 불필요
  - ✅ 브라우저 새로고침 후에도 PDF 유지
  - ✅ Save Point 88 이전 방식과 동일한 사용자 경험
  - ✅ 도면 검색 (Ctrl+F) 기능 유지
- **사용자 워크플로우**:
  ```
  1. 드로잉 업로드 → 파란색 "보기" 버튼 → PDF 팝업 ✅
  2. 시스템 등록
  3. 프로젝트 리스트 돌아가기
  4. 등록된 프로젝트 다시 선택
  5. 파란색 "보기" 버튼 → PDF 팝업 ✅ (드로잉 재업로드 불필요!)
  ```

### 0. Save Point 87 스타일 드로잉 표시 방식 ✅ (Save Point 95)
- **변경 사항**: 복잡한 버튼 대신 단순하고 명확한 텍스트 표시 방식으로 전환
- **드로잉 표시 로직**:
  - `drawingFile` 있음 (File 객체) → 파란색 "📄 보기" 버튼 (클릭 시 PDF 팝업)
  - `drawingFileName`만 있음 → 초록색 텍스트 "✓ E0004954053-00..." (파일명 툴팁)
  - `hasDrawing`만 true → 초록색 "✓ 연결됨"
  - 드로잉 없음 → 회색 "없음"
- **장점**:
  - ✅ Save Point 87~89에서 작동했던 검증된 방식
  - ✅ 시스템 등록 후 명확한 시각적 구분
  - ✅ 사용자 혼란 최소화 (클릭 불가능한 것은 버튼으로 보이지 않음)
  - ✅ 도면 검색 (Ctrl+F) 기능 유지
- **사용자 경험**:
  - 시스템 등록 전: 파란색 "보기" 버튼으로 즉시 PDF 확인 가능
  - 시스템 등록 후: 초록색 텍스트로 어떤 도면이 매칭되었는지 확인 가능
  - 드로잉 재업로드 시: 다시 파란색 "보기" 버튼으로 변경

### 0. 시스템 등록 후 BOM 데이터 동기화 ✅ (Save Point 94)
- **문제**: 시스템 등록 직후 화면에서 드로잉 "보기" 버튼이 여전히 표시되지만 클릭 시 작동하지 않음
- **원인**: 
  - `removeBOMCircularReferences()`로 새로운 BOM 배열 생성 시 `drawingFile` 제거
  - 하지만 화면의 `salesBOMData`는 여전히 이전 객체 참조
  - 저장된 데이터와 메모리 데이터의 불일치 발생
- **해결책**:
  - **시스템 등록 직후 `salesBOMData` 동기화**: 저장된 데이터로 현재 메모리 갱신
  - **BOM 테이블 즉시 재렌더링**: `displayBOMTableSales()` 호출
  - **계층 구조 재구성**: `buildBOMHierarchySales()` 호출
- **결과**:
  - ✅ 시스템 등록 직후부터 주황색 "📄 파일명..." 버튼 정상 표시
  - ✅ 화면과 저장된 데이터 완전 일치
  - ✅ 혼란스러운 파란색 "보기" 버튼 제거

### 0. 드로잉 파일 객체 유효성 검증 강화 ✅ (Save Point 93)
- **문제**: 시스템 등록 후 프로젝트 재진입 시 드로잉 "보기" 버튼은 표시되지만 클릭 시 경고창 발생
  - 경고 내용: "브라우저 새로고침 또는 프로젝트 재진입으로 인해 파일 객체가 손실되었습니다"
- **원인**: localStorage에는 File 객체를 저장할 수 없어서 프로젝트 재진입 시 `drawingFile` 손실
- **해결책**:
  - **`instanceof File` 체크 추가**: 버튼 생성 전에 실제 File/Blob 객체인지 확인
  - **조건부 버튼 표시**:
    - `drawingFile`이 유효한 File 객체 → 파란색 "📄 보기" 버튼 (클릭 시 PDF 팝업)
    - `drawingFileName`만 있음 → 주황색 "📄 E000495..." 버튼 (클릭 시 재업로드 안내)
  - **개선된 에러 처리**: `showPDFModalSales()` 함수에서 File 객체 유효성 검증 후 적절한 안내 메시지 표시
- **사용자 경험 개선**:
  - 재업로드가 필요한 파일은 amber 색상으로 구분 표시
  - 클릭 시 명확한 안내 메시지와 해결 방법 제공
  - 드로잉 패키지 재업로드 시 자동 매칭으로 빠른 복원

### 0. 시스템 등록 후 드로잉 링크 정보 보존 ✅ (Save Point 91~92)
- **드로잉 메타데이터 저장**: `drawingFileName`, `hasDrawing` 속성 localStorage에 저장
- **BOM Number 매칭 정보 저장**: 드로잉 패키지 저장 시 BOM Number 함께 저장
- **재진입 시 메타데이터 표시**: 파일명 기반 버튼 표시로 어떤 도면이 매칭되었는지 확인 가능

## ✅ 현재 완료된 기능 (Save Point 90~93 통합)

### 0. 도면 조회 (Find) 기능 ✅ (UPDATED!)
- **단축키**: `Ctrl+F` (BOM 분석 결과 화면에서 사용 가능)
- **다중 카테고리 검색**: Category 1~5까지 동시 검색 조건 설정
  - 각 카테고리별로 헤더 필드 선택 (Depth, Name, Number, Version, FindNumber, Quantity, Unit, Weight, Material)
  - 검색어 입력 (부분 일치 지원)
- **AND 조건 검색**: 여러 카테고리 설정 시 모든 조건을 만족하는 항목만 검색
- **엑셀 Find와 유사한 UX**:
  - 검색 결과 자동 스크롤 (화면 중앙 배치)
  - **강렬한 오렌지 하이라이트** 🎨 (NEW!)
    - 밝은 오렌지 배경색 (#fed7aa)
    - 굵은 오렌지 테두리 (3px solid #fb923c)
    - Box-shadow 효과로 입체감 표현
    - 2회 반복 펄스 애니메이션 (2초간)
    - 텍스트 굵게 처리 및 진한 브라운 색상
  - `Enter` 키로 다음 결과 이동
  - `ESC` 키로 팝업 닫기
- **계층 구조 자동 확장**: 검색된 항목의 상위 부모 항목들을 자동으로 펼쳐서 표시
- **검색 결과 카운터**: "3 / 15" 형태로 현재 위치 표시 (오렌지 색상으로 강조)

### 0. 프로젝트 리스트 관리 기능 ✅ (NEW!)
- **체크박스 다중 선택**: 각 프로젝트 왼쪽에 체크박스 추가
- **전체 선택/해제**: 헤더 체크박스로 전체 프로젝트 일괄 선택/해제
- **일괄 삭제 기능**: 여러 프로젝트 선택하여 한 번에 삭제 가능
  - 선택된 프로젝트 개수 실시간 표시
  - 삭제 전 확인 메시지 (프로젝트명 리스트 표시)
  - 삭제 후 프로젝트 번호 자동 재정렬
- **개별 수정 기능**: 각 프로젝트 행에 "수정" 버튼
  - 프로젝트명, 타입, 고객사, 시작일, 완료일 수정 가능
  - 모달 팝업 형태의 수정 UI
  - 여러 개 선택 시에도 한 번에 하나씩만 수정 가능
- **시스템 등록 여부 무관**: 시스템 등록 완료된 프로젝트도 수정/삭제 가능

### 1. BOM 데이터 처리 시스템 ✅
- **Excel 헤더 분석 기반 컬럼 매핑**: 실제 Excel 구조를 동적으로 분석하여 올바른 컬럼에서 데이터 추출
- **지능형 컬럼 매핑**: 
  - **Depth** → 헤더에서 'Depth' 컬럼 자동 감지 (컬럼 위치 무관)
  - **BOMCube 파싱** → `Number/Version;Num-Name` 형식 자동 분리
    - 예: `GST08493-000/A;2-TowSct Tb TS162-01` → Number: `GST08493-000`, Version: `A`, Name: `TowSct Tb TS162-01`
  - **Name** → BOMCube에서 추출 또는 'Name' 헤더 컬럼 사용
  - **Number** → BOMCube에서 추출 또는 'Number' 헤더 컬럼 사용
  - **Version** → BOMCube에서 추출 또는 'Version'/'Rev' 헤더 컬럼 사용
  - **FindNumber** → 'FindNumber' 헤더 자동 감지 (depth 0에서는 빈값)
  - **Quantity, Unit, Weight, Material** → 각각 헤더에서 자동 감지
- **유연한 구조 지원**: Excel 컬럼 순서 변경 시에도 자동 대응

### 2. FindNumber 로직 개선 ✅
- **Depth 0 항목**: FindNumber 필드를 빈값으로 설정
- **Depth 1+ 항목**: Excel에서 FindNumber 관련 컬럼을 자동 감지하여 포지션 번호 매핑

### 3. PDF 매칭 시스템 완전 재작성 ✅
- **직접 번호 비교 방식**: 복잡한 패턴 매칭 대신 단순하고 명확한 직접 비교
- **매칭 로직**:
  - `E0005476410-00` → `E0005476410` 추출 후 PDF 파일명에 포함 여부 확인
  - `30972` → `30972`가 PDF 파일명에 포함 여부 확인
  - 모든 형태의 번호에 대해 하이픈(-) 이전 부분을 추출하여 매칭
- **대소문자 무시**: 매칭 시 대소문자를 구분하지 않음

### 4. BOM 계층 구조 및 표시 ✅
- **Depth 기반 계층**: 0~5단계 depth 지원
- **Level별 확장/축소**: L0-L5 버튼으로 레벨별 표시 제어
- **Excel 셀 스타일 보존**: 들여쓰기 정보를 Excel에서 추출하여 계층 구조 유지

### 5. 드로잉 패키지 관리 ✅
- **PDF 업로드**: 드래그 앤 드롭 또는 파일 선택으로 다중 PDF 업로드
- **자동 매칭**: BOM Number와 PDF 파일명 직접 비교로 자동 연결
- **매칭 결과 표시**: BOM 트리에서 "Drawing" 컬럼에 "보기" 버튼으로 도면 접근

## 🔧 기술 스택
- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **UI Framework**: Tailwind CSS
- **Excel 처리**: SheetJS (XLSX)
- **아이콘**: Font Awesome
- **폰트**: Google Fonts (Inter)

## 📁 파일 구조
```
index.html              # 메인 CSWIND MTO 시스템 (프로젝트 관리 통합)
ecosystem.config.cjs    # PM2 서버 설정
css/                    # 스타일시트 디렉토리
js/                     # JavaScript 모듈 디렉토리
supplier-portal.html    # 공급업체 포털 (별도)
bom-interactive-table.html # BOM 인터랙티브 테이블 (별도)
cswind-mto-system-restructured.html # 이전 버전 백업
new_bom_processor.js    # BOM 처리 유틸리티
```

## 🚀 주요 API 및 함수

### BOM 데이터 처리
- `processBOMDataSales(rawData, worksheet, cellStyleInfo)`: Excel BOM 데이터 처리
- `buildBOMHierarchySales()`: BOM 계층 구조 생성
- `displayBOMTableSales()`: BOM 테이블 표시

### PDF 매칭 시스템
- `isNumberMatch(bomNumber, pdfFileName)`: 직접 번호 비교 매칭
- `extractDrawingNumber(filename)`: 파일명에서 도면번호 추출 (단순화됨)
- `matchDrawingsWithBOMSales()`: BOM과 PDF 자동 매칭

### 디버깅 및 테스트
- `testDrawingMatch(bomNumber, pdfFileName)`: 매칭 테스트 함수
- `window.forceMatchDrawings()`: 강제 매칭 실행
- `window.debugDrawingMap()`: 매칭 결과 디버그 출력

## 📊 데이터 모델

### BOM Item 구조
```javascript
{
    id: 'sales-bom-{index}',
    depth: 0-5,                    // 계층 깊이
    name: 'Part Name',             // 부품명
    number: 'GST03315-001',        // 도면번호
    version: 'A',                  // 버전
    findNumber: '10',              // 포지션 번호 (depth 0에서는 빈값)
    quantity: '1',                 // 수량
    unit: 'EA',                    // 단위
    weight: '10.5',                // 중량
    material: 'Steel',             // 재질
    children: [],                  // 하위 항목
    isVisible: boolean,            // 표시 여부
    hasDrawing: boolean,           // 도면 연결 여부
    drawingFile: File              // 연결된 PDF 파일
}
```

### Drawing Map 구조
```javascript
window.drawingMap = new Map([
    ['GST03315-001', {
        file: File,                // PDF 파일 객체
        fileName: 'drawing.pdf',   // 파일명
        drawingNumber: 'GST03315-001', // 도면번호
        bomNumber: 'GST03315-001', // BOM 번호
        blobUrl: 'blob:...'        // 미리보기 URL
    }]
]);
```

## 🛠️ 주요 수정사항

### Save Point 90 (2025-10-28) 🎨 검색 결과 하이라이트 강화

#### 1. 검색 결과 시각적 강조 개선 ✅
- **문제**: 기존 노란색 하이라이트가 충분히 눈에 띄지 않음
- **해결**:
  - 더 강렬한 오렌지 색상 적용 (#fed7aa 배경 + #fb923c 테두리)
  - Box-shadow 효과로 입체감 부여 (rgba(251, 146, 60, 0.5))
  - 2초간 2회 반복되는 펄스 애니메이션 추가
  - 검색된 행의 모든 셀에 진한 브라운 색상 + 굵은 폰트 적용
  - z-index 10으로 다른 요소보다 앞에 표시
- **결과**:
  - ✅ 검색 결과가 즉시 눈에 들어옴
  - ✅ 애니메이션으로 시선 집중 효과
  - ✅ 전문적이고 세련된 UI/UX

#### 2. CSS 애니메이션 시스템 추가 ✅
- **@keyframes searchPulse**: 부드러운 박스 쉐도우 확장 애니메이션
  - 0% → 50% → 100%의 3단계 전환
  - 그림자가 바깥으로 퍼지며 페이드아웃
  - 배경색이 밝아졌다 원래대로 복귀
- **[data-search-highlight="true"] 선택자**:
  - 모든 시각적 스타일을 CSS로 중앙 관리
  - !important로 다른 스타일 오버라이드
  - 일관성 있는 하이라이트 효과 보장

### Save Point 89 (2025-10-27) ⭐ 도면 조회(Find) 기능 추가

#### 1. Ctrl+F 단축키로 도면 조회 ✅
- **문제**: BOM 테이블에서 특정 도면번호나 항목을 찾기 어려움
- **해결**:
  - `Ctrl+F` 단축키로 도면 조회 팝업 열기
  - 엑셀의 Find 기능과 유사한 UX 제공
  - BOM 분석 결과가 표시된 상태에서만 작동
- **결과**:
  - ✅ 빠른 도면 검색 가능
  - ✅ 다중 조건 검색으로 정확도 향상
  - ✅ 직관적인 키보드 단축키 지원

#### 2. 고급 검색 기능 ✅
- **5개 카테고리 동시 검색**
  - 각 카테고리별로 헤더 필드 + 검색어 입력
  - AND 조건으로 정확한 검색 결과 도출
- **자동 스크롤 및 하이라이트**
  - 검색 결과를 화면 중앙에 자동 배치
  - 노란색 하이라이트로 강조 표시
  - 상위 부모 항목 자동 확장
- **키보드 내비게이션**
  - `Enter`: 검색 실행 또는 다음 결과 이동
  - `ESC`: 팝업 닫기
  - 검색어 입력란에서 `Enter`: 즉시 검색

#### 3. 검색 결과 관리 ✅
- **결과 카운터**: "3 / 15" 형태로 현재 위치 표시
- **순환 검색**: 마지막 결과 다음은 첫 번째 결과로 이동
- **초기화 버튼**: 모든 검색 조건 한 번에 초기화

### Save Point 88 (2025-10-27) ⭐ 프로젝트 관리 기능 추가

#### 1. 프로젝트 리스트 관리 기능 구현 ✅
- **문제**: 프로젝트를 수정하거나 삭제할 수 있는 기능이 없었음
- **해결**:
  - 체크박스 기반 다중 선택 시스템 구현
  - 전체 선택/해제 토글 기능
  - 선택된 프로젝트 일괄 삭제 (확인 메시지 포함)
  - 개별 프로젝트 수정 모달 UI
  - 프로젝트 번호 자동 재정렬
- **결과**:
  - ✅ 시스템 등록 완료된 프로젝트도 수정/삭제 가능
  - ✅ 사용자 친화적인 관리 인터페이스
  - ✅ 데이터 무결성 유지 (localStorage 자동 저장)

#### 2. UI/UX 개선 ✅
- **테이블 레이아웃 개선**
  - 체크박스 컬럼 추가 (제일 왼쪽)
  - 관리 컬럼 추가 (제일 오른쪽)
  - colspan 조정으로 빈 행 표시 개선
- **버튼 상태 관리**
  - 선택된 프로젝트 개수 실시간 표시
  - 선택 없을 시 삭제 버튼 비활성화
  - 전체 선택 체크박스 indeterminate 상태 지원

### Save Point 87 (2025-10-27) ⭐ 프로젝트 재진입 기능

#### 1. 시스템 등록 완료 프로젝트 재진입 가능 ✅
- **문제**: 시스템 등록을 완료한 프로젝트는 프로젝트 리스트에서 다시 열 수 없었음
- **해결**:
  - `selectProjectForAnalysis()` 함수 개선
  - BOM 데이터 자동 복원 및 계층 구조 재구성
  - 드로잉 패키지 메타데이터 복원 기능 추가
  - 시스템 등록 완료 상태 시각적 표시
- **결과**:
  - ✅ 시스템 등록 완료된 프로젝트도 더블클릭으로 재진입 가능
  - ✅ BOM 데이터, 계층 구조, 드로잉 정보 모두 복원
  - ✅ "시스템 등록 완료" 상태 메시지 표시

#### 2. 드로잉 메타데이터 복원 시스템 ✅
- **`restoreDrawingPackageMetadata()` 함수 추가**
  - localStorage에서 드로잉 메타데이터 복원
  - BOM 항목에 드로잉 파일명 매칭
  - 드로잉 연결 상태 시각적 표시
- **드로잉 셀 표시 개선**
  - 실제 파일 있음: "📄 보기" 버튼 (클릭 가능)
  - 메타데이터만 있음: "✓ 파일명..." 표시 (파일 없음 안내)
  - 드로잉 없음: "없음" 회색 텍스트

#### 3. 서버 안정성 개선 ✅
- **Python HTTP 서버 → Node.js HTTP 서버로 전환**
- **포트 충돌 문제 해결**
- **PM2 재시작 안정성 향상**

### Save Point 86 수정사항 (2025-10-27)

#### 1. 순환 참조 오류 수정 ⭐ CRITICAL FIX
- **문제**: 프로젝트 생성/등록 시 "Converting circular structure to JSON" 오류 발생
- **원인**: BOM 데이터의 parent/children 속성이 순환 참조를 형성
- **해결**:
  - `removeBOMCircularReferences()` 헬퍼 함수 추가
  - `saveProjectListToStorage()` 중앙 집중식 저장 함수 추가
  - 모든 localStorage 저장 호출을 안전한 함수로 교체
  - try-catch 오류 처리 및 사용자 피드백 추가
- **결과**: 
  - 프로젝트 생성 정상 작동 ✅
  - 시스템 등록 정상 작동 ✅
  - 데이터 무결성 보장 ✅

#### 2. 드로잉 패키지 업로드 완료 팝업 수정
- **문제**: totalBOMItems 변수 미정의로 인한 팝업 오류
- **해결**: 
  - totalBOMItems 변수 초기화 및 카운팅 로직 추가
  - Number가 있는 항목만 집계
  - 상세 디버깅 로그 추가
  - 시스템 등록 섹션 활성화 개선
- **결과**: 업로드 완료 팝업 정상 표시 ✅

#### 3. 프로젝트 관리 워크플로우 개선
- **Step 1: 프로젝트 리스트 관리**
  - 등록된 프로젝트 목록 표시
  - "+ 새 프로젝트" 버튼으로 프로젝트 생성
  - 프로젝트별 상태 표시 (BOM 분석, 도면 링크, 시스템 등록)
  - 더블클릭으로 BOM 분석 시작
  
- **Step 2: 신규 프로젝트 생성**
  - 프로젝트명, 타입, 고객사, 시작일/완료일 입력
  - 필수 항목 검증
  - 프로젝트 생성 후 자동으로 리스트에 추가
  
- **Step 3: BOM 분석 & 드로잉 패키지 업로드**
  - **BOM 분석**: Excel 파일 업로드 및 자동 파싱
  - **드로잉 패키지 업로드**: PDF 폴더 업로드 및 BOM 매칭
    - ✨ **업로드 완료 팝업 알림** (매칭 결과 상세 표시)
    - ✨ **도면링크 상태 자동 '완료' 변경**
    - ✨ **시스템 등록 섹션 자동 활성화**
  
- **시스템 등록 (Step 3 하단에 추가)** ✨
  - BOM 분석 + 도면 링크 완료 시 나타남
  - 3단계 진행 상황 표시 (BOM 분석 ✅ / 도면 링크 ✅ / 시스템 등록 ⏳)
  - "시스템에 등록하기" 버튼 클릭 시:
    - 프로젝트 상태 최종 업데이트
    - 로컬 스토리지에 저장
    - 성공 알림 팝업
    - 자동으로 프로젝트 리스트로 이동
    
- **프로젝트 리스트 상태 표시**
  - BOM 분석: ✅ 완료 / ⊖ 미완료
  - 도면 링크: ✅ 완료 / ⊖ 미완료
  - 시스템 등록: ✅ 완료 / ⏳ 대기 / ⊖ 미완료

#### 2. Excel Depth 컬럼 파싱 오류 수정
- **문제**: Excel 원본에서 Depth 값이 0~5로 다양하지만, 파싱 결과는 모두 0으로 표시되어 토글 기능이 작동하지 않음
- **원인**: 하드코딩된 컬럼 인덱스(0번 컬럼)를 사용하여 Depth를 읽었으나, 실제 Excel에서는 Depth가 3번 컬럼에 위치
- **해결**: 
  - Excel 헤더를 동적으로 분석하여 'Depth' 컬럼 자동 감지
  - BOMCube 컬럼 파싱: `Number/Version;Num-Name` 형식 분리 (예: `GST08493-000/A;2-TowSct Tb TS162-01`)
  - 모든 필수 컬럼(Depth, Name, Number, Version, FindNumber 등)을 헤더 기반으로 매핑
  - 유연한 Excel 구조 지원: 컬럼 순서가 변경되어도 자동 대응
- **결과**: 
  - Depth 값이 정확히 파싱되어 BOM 트리 계층 구조 정상 표시
  - 토글 기능 완전 복구: 각 레벨의 확장/축소 정상 작동
  - Excel 구조 변경에 강건한 시스템 구축

#### 2. BOM 트리 토글 기능 수정
- **문제**: Depth에 따른 토글 아이콘이 클릭되지 않는 문제
- **원인**: `innerHTML`로 생성된 `onclick` 속성이 제대로 바인딩되지 않음
- **해결**: 
  - `onclick` 속성 대신 `data-item-id` 속성 사용
  - JavaScript `addEventListener`로 직접 이벤트 바인딩
  - 토글 아이콘 클릭 시 정상 작동 확인
- **개선**:
  - 토글 실행 시 상세 디버깅 로그 추가
  - 아이템 정보, 자식 개수, 표시/숨김 상태 콘솔 출력
  - 사용자가 문제 발생 시 쉽게 추적 가능

#### 2. PDF 미리보기 로딩 문제 해결
- **문제**: PDF 미리보기가 로딩되지 않는 문제
- **해결**:
  - `<embed>` 태그에서 `<iframe>` 태그로 변경하여 브라우저 호환성 향상
  - PDF 로딩 파라미터 추가 (`#toolbar=1&navpanes=1&scrollbar=1`)
  - PDF 표시 실패 시 다운로드 링크 제공하는 폴백 메시지 추가
  - 디버깅을 위한 콘솔 로그 추가
  - 배경색 추가로 로딩 상태 시각적 피드백 개선

### Save Point 86

#### 1. BOM 컬럼 매핑 정확성 수정
- **문제**: FindNumber 컬럼에 Quantity 값이, Number 컬럼에 FindNumber 값이 잘못 매핑됨
- **해결**: Excel 헤더 분석을 통해 정확한 컬럼 위치 자동 감지
- **결과**: GST03315-001, E0005030033 등 실제 도면번호가 Number 컬럼에 정확히 표시

#### 2. PDF 매칭 로직 완전 재작성
- **기존**: 복잡한 정규식 패턴 매칭 및 E-pattern 분석
- **신규**: 직접 문자열 포함 여부 비교
- **예시**: 
  - BOM: `E0005476410-00` → PDF파일명에 `E0005476410` 포함 여부 확인
  - BOM: `30972` → PDF파일명에 `30972` 포함 여부 확인

#### 3. FindNumber 로직 개선
- **Depth 0 항목**: 자동으로 FindNumber 필드를 빈값으로 설정
- **Depth 1+ 항목**: Excel에서 FindNumber 관련 헤더를 자동 감지하여 매핑

## 🧪 테스트 가이드

### 개발자 도구에서 테스트
```javascript
// PDF 매칭 테스트
testDrawingMatch('E0005476410-00', 'E0005476410_drawing.pdf');
testDrawingMatch('30972', '30972-Rev1.pdf');

// 강제 매칭 실행
forceMatchDrawings();

// 매칭 결과 디버그
debugDrawingMap();
```

## 🔄 워크플로우

1. **BOM Excel 파일 업로드**: SheetJS로 파싱하여 컬럼 매핑
2. **PDF 드로잉 패키지 업로드**: 다중 PDF 파일 업로드
3. **자동 매칭**: 직접 번호 비교로 BOM-PDF 연결
4. **BOM 트리 표시**: 계층구조 및 도면 링크가 포함된 테이블 렌더링
5. **도면 보기**: "보기" 버튼으로 연결된 PDF 도면 확인

## 📋 향후 개발 계획

### 우선순위 높음
- [ ] 매칭 정확도 향상을 위한 추가 테스트 케이스 확장
- [ ] BOM 데이터 내보내기 기능 (Excel/CSV)
- [ ] 도면 미리보기 화면 개선

### 우선순위 중간
- [ ] 사용자 설정 가능한 컬럼 매핑 UI
- [ ] 매칭 결과 통계 대시보드
- [ ] PDF 주석 기능

### 우선순위 낮음
- [ ] 다국어 지원
- [ ] 모바일 반응형 최적화
- [ ] 클라우드 저장소 연동

## 🎉 성과

### 문제 해결 완료
- ✅ BOM Number 컬럼에 올바른 도면번호 표시 (GST03315-001, E0005030033 등)
- ✅ FindNumber 컬럼에 올바른 포지션 번호 표시 (10, 20, 30 등)
- ✅ Depth 0 항목의 FindNumber 자동 공백 처리
- ✅ PDF 매칭 성공률 향상 (직접 비교 방식)

### 시스템 안정성 향상
- ✅ Excel 구조 변경에 대한 유연한 대응 (헤더 분석 기반)
- ✅ 단순화된 PDF 매칭 로직으로 유지보수성 향상
- ✅ 명확한 디버깅 및 테스트 도구 제공

---

**최종 업데이트**: 2025-10-28
**버전**: Save Point 104
**상태**: 운영 준비 완료 ✅

## 🎮 단축키 가이드

| 단축키 | 기능 | 사용 가능 위치 |
|--------|------|----------------|
| `Ctrl+F` | 도면 조회 팝업 열기 | BOM 분석 결과 화면 |
| `Enter` | 검색 실행 / 다음 결과 이동 | 도면 조회 팝업 내 |
| `ESC` | 팝업 닫기 | 도면 조회 팝업 내 |

## 📝 다음 개발 계획

### 우선순위: 높음
- [x] ~~**프로젝트 편집 기능**~~: 등록된 프로젝트의 정보(이름, 고객사, 날짜 등) 수정 기능 ✅ **완료**
- [x] ~~**프로젝트 삭제 기능**~~: 불필요한 프로젝트 삭제 및 데이터 정리 ✅ **완료**
- [x] ~~**도면 조회 기능**~~: Ctrl+F로 BOM 항목 검색 ✅ **완료**
- [ ] **드로잉 파일 재업로드**: 시스템 등록 후에도 드로잉 파일 추가/교체 가능
- [ ] **BOM 데이터 수정**: BOM 항목 직접 편집 기능

### 우선순위: 중간
- [ ] **BOM 데이터 내보내기**: Excel/CSV 형식으로 내보내기
- [ ] **프로젝트 검색 및 필터링**: 프로젝트명, 고객사, 날짜로 검색
- [ ] **드로잉 미리보기 개선**: 확대/축소, 페이지 이동 등 뷰어 기능 강화
- [ ] **프로젝트 복사 기능**: 기존 프로젝트 기반으로 신규 프로젝트 생성
- [ ] **검색 결과 내보내기**: 검색된 BOM 항목만 Excel로 내보내기