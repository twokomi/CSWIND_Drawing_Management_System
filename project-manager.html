<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSWIND í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .tab-active {
            background-color: #3b82f6;
            color: white;
        }
        .tab-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        .status-complete {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-progress {
            background-color: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- í—¤ë” -->
    <header class="bg-blue-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">
                <i class="fas fa-project-diagram mr-2"></i>
                CSWIND í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ
            </h1>
            <button onclick="location.href='index.html'" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition">
                <i class="fas fa-arrow-left mr-2"></i>
                BOM ë¶„ì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
    </header>

    <div class="container mx-auto p-6">
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex border-b">
                <button id="tab-project-list" class="tab-button flex-1 py-4 px-6 text-center font-semibold transition tab-active" onclick="switchTab('project-list')">
                    <i class="fas fa-list mr-2"></i>
                    ë“±ë¡ëœ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸
                </button>
                <button id="tab-new-project" class="tab-button flex-1 py-4 px-6 text-center font-semibold transition hover:bg-gray-50" onclick="switchTab('new-project')">
                    <i class="fas fa-plus-circle mr-2"></i>
                    ìƒˆ í”„ë¡œì íŠ¸ ë“±ë¡
                </button>
            </div>
        </div>

        <!-- ë“±ë¡ëœ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ íƒ­ -->
        <div id="content-project-list" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-folder-open mr-2 text-blue-600"></i>
                        ë“±ë¡ëœ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸
                    </h2>
                    <button onclick="refreshProjectList()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-sync-alt mr-2"></i>
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>

                <!-- í”„ë¡œì íŠ¸ í…Œì´ë¸” -->
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs uppercase bg-gray-100 text-gray-700">
                            <tr>
                                <th class="px-6 py-3">ë²ˆí˜¸</th>
                                <th class="px-6 py-3">í”„ë¡œì íŠ¸ëª…</th>
                                <th class="px-6 py-3">í”„ë¡œì íŠ¸ ë‹´ë‹¹</th>
                                <th class="px-6 py-3">ê³ ê°ì‚¬</th>
                                <th class="px-6 py-3">ì‹œì‘ì¼</th>
                                <th class="px-6 py-3">ì™„ë£Œì¼</th>
                                <th class="px-6 py-3">BOM ë¶„ì„</th>
                                <th class="px-6 py-3">ë„ë©´ ë§í¬</th>
                                <th class="px-6 py-3">ì‹œìŠ¤í…œ ë“±ë¡</th>
                                <th class="px-6 py-3">ì•¡ì…˜</th>
                            </tr>
                        </thead>
                        <tbody id="project-list-tbody">
                            <tr>
                                <td colspan="10" class="px-6 py-8 text-center text-gray-500">
                                    <i class="fas fa-inbox text-4xl mb-2 block"></i>
                                    ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ìƒˆ í”„ë¡œì íŠ¸ ë“±ë¡ íƒ­ -->
        <div id="content-new-project" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-plus-circle mr-2 text-blue-600"></i>
                    ìƒˆ í”„ë¡œì íŠ¸ ë“±ë¡
                </h2>

                <!-- Step 1: í”„ë¡œì íŠ¸ ê´€ë¦¬ -->
                <div id="step-1" class="mb-8">
                    <div class="border-l-4 border-blue-600 pl-4 mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Step 1: í”„ë¡œì íŠ¸ ê´€ë¦¬</h3>
                        <p class="text-sm text-gray-600">í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">í”„ë¡œì íŠ¸ëª… *</label>
                            <input type="text" id="project-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì˜ˆ: Excel ë°ì´í„° ë‹¤ë£¨ê¸° í”„ë¡œì íŠ¸">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">í”„ë¡œì íŠ¸ ë‹´ë‹¹ *</label>
                            <input type="text" id="project-manager" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ë‹´ë‹¹ìëª…">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ê³ ê°ì‚¬ *</label>
                            <input type="text" id="customer" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì˜ˆ: Onshore">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ì‹œì‘ì¼ *</label>
                            <input type="date" id="start-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ì™„ë£Œì¼</label>
                            <input type="date" id="end-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Step 2: BOM ë¶„ì„ -->
                <div id="step-2" class="mb-8">
                    <div class="border-l-4 border-blue-600 pl-4 mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Step 2: BOM ë¶„ì„</h3>
                        <p class="text-sm text-gray-600">Excel BOM íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                    </div>

                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition cursor-pointer" onclick="document.getElementById('bom-file-input').click()">
                        <i class="fas fa-file-excel text-5xl text-green-600 mb-4"></i>
                        <p class="text-lg font-semibold text-gray-700 mb-2">BOM Excel íŒŒì¼ ì—…ë¡œë“œ</p>
                        <p class="text-sm text-gray-500">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                        <input type="file" id="bom-file-input" accept=".xlsx,.xls" class="hidden" onchange="handleBOMUpload(event)">
                    </div>

                    <div id="bom-status" class="mt-4 hidden">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-600 text-xl mr-3"></i>
                                <div>
                                    <p class="font-semibold text-green-800">BOM ì—…ë¡œë“œ ì™„ë£Œ</p>
                                    <p class="text-sm text-green-600" id="bom-file-name"></p>
                                </div>
                            </div>
                            <button onclick="viewBOMPreview()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-eye mr-2"></i>
                                ë¯¸ë¦¬ë³´ê¸°
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ -->
                <div id="step-3" class="mb-8">
                    <div class="border-l-4 border-blue-600 pl-4 mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Step 3: ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ</h3>
                        <p class="text-sm text-gray-600">PDF ë„ë©´ íŒŒì¼ë“¤ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                    </div>

                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition cursor-pointer" onclick="document.getElementById('drawing-files-input').click()">
                        <i class="fas fa-file-pdf text-5xl text-red-600 mb-4"></i>
                        <p class="text-lg font-semibold text-gray-700 mb-2">PDF ë„ë©´ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ</p>
                        <p class="text-sm text-gray-500">ì—¬ëŸ¬ íŒŒì¼ì„ ë™ì‹œì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                        <input type="file" id="drawing-files-input" accept=".pdf" multiple class="hidden" onchange="handleDrawingUpload(event)">
                    </div>

                    <div id="drawing-status" class="mt-4 hidden">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-check-circle text-green-600 text-xl mr-3"></i>
                                <p class="font-semibold text-green-800">ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ ì™„ë£Œ</p>
                            </div>
                            <p class="text-sm text-green-600 ml-9" id="drawing-file-count"></p>
                        </div>
                    </div>
                </div>

                <!-- Step 4: ì‹œìŠ¤í…œ ë“±ë¡ -->
                <div id="step-4" class="mb-8">
                    <div class="border-l-4 border-gray-400 pl-4 mb-4" id="step-4-header">
                        <h3 class="text-lg font-bold text-gray-400">Step 4: ì‹œìŠ¤í…œ ë“±ë¡</h3>
                        <p class="text-sm text-gray-500">BOM ë¶„ì„ê³¼ ë„ë©´ ë§í¬ê°€ ì™„ë£Œë˜ë©´ í™œì„±í™”ë©ë‹ˆë‹¤</p>
                    </div>

                    <div id="system-register-section" class="opacity-50 pointer-events-none">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <div class="flex items-start mb-4">
                                <i class="fas fa-info-circle text-blue-600 text-xl mr-3 mt-1"></i>
                                <div>
                                    <p class="font-semibold text-blue-800 mb-2">ì‹œìŠ¤í…œ ë“±ë¡ ì•ˆë‚´</p>
                                    <p class="text-sm text-blue-700">í”„ë¡œì íŠ¸ ì •ë³´, BOM ë°ì´í„°, ë„ë©´ ë§¤ì¹­ ê²°ê³¼ë¥¼ ì‹œìŠ¤í…œì— ë“±ë¡í•©ë‹ˆë‹¤.</p>
                                    <p class="text-sm text-blue-700">ë“±ë¡ í›„ì—ëŠ” "ë“±ë¡ëœ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸"ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                </div>
                            </div>
                            <button id="register-button" onclick="registerProject()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                                <i class="fas fa-save mr-2"></i>
                                ì‹œìŠ¤í…œì— ë“±ë¡í•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ì§„í–‰ ìƒíƒœ ìš”ì•½ -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-tasks mr-2"></i>
                        ì§„í–‰ ìƒíƒœ
                    </h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-2">
                                <i id="status-icon-1" class="fas fa-check text-green-600 text-2xl"></i>
                            </div>
                            <p class="text-sm font-semibold text-gray-700">í”„ë¡œì íŠ¸ ì •ë³´</p>
                            <span id="status-badge-1" class="status-badge status-complete mt-2">ì™„ë£Œ</span>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-2">
                                <i id="status-icon-2" class="fas fa-hourglass-half text-gray-400 text-2xl"></i>
                            </div>
                            <p class="text-sm font-semibold text-gray-700">BOM ë¶„ì„</p>
                            <span id="status-badge-2" class="status-badge status-pending mt-2">ëŒ€ê¸°</span>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-2">
                                <i id="status-icon-3" class="fas fa-hourglass-half text-gray-400 text-2xl"></i>
                            </div>
                            <p class="text-sm font-semibold text-gray-700">ë„ë©´ ë§í¬</p>
                            <span id="status-badge-3" class="status-badge status-pending mt-2">ëŒ€ê¸°</span>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-2">
                                <i id="status-icon-4" class="fas fa-lock text-gray-400 text-2xl"></i>
                            </div>
                            <p class="text-sm font-semibold text-gray-700">ì‹œìŠ¤í…œ ë“±ë¡</p>
                            <span id="status-badge-4" class="status-badge status-pending mt-2">ëŒ€ê¸°</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BOM ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
    <div id="bom-preview-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-6xl max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-table mr-2 text-blue-600"></i>
                    BOM ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°
                </h3>
                <button onclick="closeBOMPreview()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="bom-preview-content" class="p-6 overflow-auto max-h-[70vh]">
                <!-- BOM ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentProject = {
            id: null,
            name: '',
            manager: '',
            customer: '',
            startDate: '',
            endDate: '',
            bomData: null,
            bomFileName: '',
            drawingFiles: [],
            drawingMap: new Map(),
            status: {
                projectInfo: false,
                bomAnalysis: false,
                drawingLink: false,
                systemRegister: false
            }
        };

        let projects = JSON.parse(localStorage.getItem('cswind-projects') || '[]');

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            const tabs = ['project-list', 'new-project'];
            tabs.forEach(tab => {
                document.getElementById(`tab-${tab}`).classList.remove('tab-active');
                document.getElementById(`content-${tab}`).classList.add('hidden');
            });

            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
            document.getElementById(`content-${tabName}`).classList.remove('hidden');

            if (tabName === 'project-list') {
                refreshProjectList();
            }
        }

        // BOM íŒŒì¼ ì—…ë¡œë“œ
        function handleBOMUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            console.log('ğŸ“ BOM íŒŒì¼ ì—…ë¡œë“œ:', file.name);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array', cellStyles: true });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    console.log('âœ… BOM ë°ì´í„° íŒŒì‹± ì™„ë£Œ:', jsonData.length, 'í–‰');

                    currentProject.bomData = jsonData;
                    currentProject.bomFileName = file.name;
                    currentProject.status.bomAnalysis = true;

                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('bom-status').classList.remove('hidden');
                    document.getElementById('bom-file-name').textContent = file.name;

                    updateStatusBadge(2, 'complete', 'BOM ë¶„ì„');

                    // ë„ë©´ ë§í¬ ë‹¨ê³„ë„ ì²´í¬
                    checkDrawingLinkStatus();

                    alert('âœ… BOM íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ' + file.name + '\nì´ í–‰ ìˆ˜: ' + jsonData.length);

                } catch (error) {
                    console.error('âŒ BOM íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜:', error);
                    alert('BOM íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // ë“œë¡œì‰ íŒŒì¼ ì—…ë¡œë“œ
        function handleDrawingUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            console.log('ğŸ“ ë“œë¡œì‰ íŒŒì¼ ì—…ë¡œë“œ:', files.length, 'ê°œ');

            currentProject.drawingFiles = files;
            currentProject.status.drawingLink = true;

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('drawing-status').classList.remove('hidden');
            document.getElementById('drawing-file-count').textContent = `ì´ ${files.length}ê°œì˜ PDF íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤`;

            // âœ… ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ ì™„ë£Œ íŒì—…
            alert(`âœ… ë“œë¡œì‰ íŒ¨í‚¤ì§€ ì—…ë¡œë“œ ì™„ë£Œ!\n\nì´ ${files.length}ê°œì˜ PDF íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ ë‹¨ê³„: ì‹œìŠ¤í…œ ë“±ë¡ íƒ­ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);

            updateStatusBadge(3, 'complete', 'ë„ë©´ ë§í¬');

            // ë„ë©´ ë§í¬ ì™„ë£Œ í›„ ì‹œìŠ¤í…œ ë“±ë¡ í™œì„±í™” ì²´í¬
            checkSystemRegisterStatus();
        }

        // ë„ë©´ ë§í¬ ìƒíƒœ í™•ì¸
        function checkDrawingLinkStatus() {
            if (currentProject.status.bomAnalysis && currentProject.status.drawingLink) {
                checkSystemRegisterStatus();
            }
        }

        // ì‹œìŠ¤í…œ ë“±ë¡ í™œì„±í™” ì²´í¬
        function checkSystemRegisterStatus() {
            if (currentProject.status.bomAnalysis && currentProject.status.drawingLink) {
                console.log('âœ… BOM ë¶„ì„ê³¼ ë„ë©´ ë§í¬ ì™„ë£Œ - ì‹œìŠ¤í…œ ë“±ë¡ í™œì„±í™”');

                // Step 4 í™œì„±í™”
                document.getElementById('step-4-header').querySelector('.border-l-4').classList.remove('border-gray-400');
                document.getElementById('step-4-header').querySelector('.border-l-4').classList.add('border-blue-600');
                document.getElementById('step-4-header').querySelector('h3').classList.remove('text-gray-400');
                document.getElementById('step-4-header').querySelector('h3').classList.add('text-gray-800');
                document.getElementById('step-4-header').querySelector('p').classList.remove('text-gray-500');
                document.getElementById('step-4-header').querySelector('p').classList.add('text-gray-600');

                document.getElementById('system-register-section').classList.remove('opacity-50', 'pointer-events-none');

                updateStatusBadge(4, 'progress', 'ì‹œìŠ¤í…œ ë“±ë¡');
            }
        }

        // ìƒíƒœ ë°°ì§€ ì—…ë°ì´íŠ¸
        function updateStatusBadge(stepNum, status, label) {
            const icon = document.getElementById(`status-icon-${stepNum}`);
            const badge = document.getElementById(`status-badge-${stepNum}`);
            const circle = icon.parentElement;

            // ì•„ì´ì½˜ ë³€ê²½
            if (status === 'complete') {
                icon.className = 'fas fa-check text-green-600 text-2xl';
                circle.className = 'w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-2';
                badge.className = 'status-badge status-complete mt-2';
                badge.textContent = 'ì™„ë£Œ';
            } else if (status === 'progress') {
                icon.className = 'fas fa-spinner fa-spin text-blue-600 text-2xl';
                circle.className = 'w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-2';
                badge.className = 'status-badge status-progress mt-2';
                badge.textContent = 'ì§„í–‰ì¤‘';
            }
        }

        // BOM ë¯¸ë¦¬ë³´ê¸°
        function viewBOMPreview() {
            if (!currentProject.bomData) {
                alert('BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const modal = document.getElementById('bom-preview-modal');
            const content = document.getElementById('bom-preview-content');

            const headers = currentProject.bomData[0] || [];
            const rows = currentProject.bomData.slice(1, 21); // ì²˜ìŒ 20í–‰ë§Œ í‘œì‹œ

            let html = '<div class="overflow-x-auto">';
            html += '<table class="w-full text-sm text-left border-collapse">';
            html += '<thead class="text-xs uppercase bg-gray-100 text-gray-700">';
            html += '<tr>';
            headers.forEach(header => {
                html += `<th class="px-4 py-2 border">${header || ''}</th>`;
            });
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';

            rows.forEach((row, i) => {
                html += '<tr class="border-b hover:bg-gray-50">';
                headers.forEach((_, j) => {
                    html += `<td class="px-4 py-2 border">${row[j] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody>';
            html += '</table>';
            html += '</div>';
            html += `<p class="text-sm text-gray-500 mt-4">ì´ ${currentProject.bomData.length - 1}ê°œ í–‰ ì¤‘ ì²˜ìŒ 20ê°œ í‘œì‹œ</p>`;

            content.innerHTML = html;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeBOMPreview() {
            const modal = document.getElementById('bom-preview-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // í”„ë¡œì íŠ¸ ë“±ë¡
        function registerProject() {
            // í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥ í™•ì¸
            const projectName = document.getElementById('project-name').value.trim();
            const projectManager = document.getElementById('project-manager').value.trim();
            const customer = document.getElementById('customer').value.trim();
            const startDate = document.getElementById('start-date').value;

            if (!projectName || !projectManager || !customer || !startDate) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\n- í”„ë¡œì íŠ¸ëª…\n- í”„ë¡œì íŠ¸ ë‹´ë‹¹\n- ê³ ê°ì‚¬\n- ì‹œì‘ì¼');
                return;
            }

            if (!currentProject.status.bomAnalysis) {
                alert('BOM ë¶„ì„ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!currentProject.status.drawingLink) {
                alert('ë“œë¡œì‰ íŒ¨í‚¤ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            const endDate = document.getElementById('end-date').value;

            // í”„ë¡œì íŠ¸ ID ìƒì„±
            const projectId = 'proj-' + Date.now();

            const newProject = {
                id: projectId,
                name: projectName,
                manager: projectManager,
                customer: customer,
                startDate: startDate,
                endDate: endDate || '-',
                bomFileName: currentProject.bomFileName,
                bomData: currentProject.bomData,
                drawingFileCount: currentProject.drawingFiles.length,
                drawingFiles: currentProject.drawingFiles.map(f => f.name),
                status: {
                    bomAnalysis: 'ì™„ë£Œ',
                    drawingLink: 'ì™„ë£Œ',
                    systemRegister: 'ì™„ë£Œ'
                },
                registeredAt: new Date().toISOString()
            };

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ê°„ë‹¨í•œ ë°ëª¨ìš©)
            projects.push(newProject);
            localStorage.setItem('cswind-projects', JSON.stringify(projects));

            console.log('âœ… í”„ë¡œì íŠ¸ ë“±ë¡ ì™„ë£Œ:', newProject);

            updateStatusBadge(4, 'complete', 'ì‹œìŠ¤í…œ ë“±ë¡');

            alert(`âœ… í”„ë¡œì íŠ¸ê°€ ì‹œìŠ¤í…œì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n\ní”„ë¡œì íŠ¸ëª…: ${projectName}\në‹´ë‹¹ì: ${projectManager}\nê³ ê°ì‚¬: ${customer}\n\n"ë“±ë¡ëœ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸" íƒ­ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);

            // í¼ ì´ˆê¸°í™”
            resetProjectForm();

            // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ íƒ­ìœ¼ë¡œ ì´ë™
            switchTab('project-list');
        }

        // í”„ë¡œì íŠ¸ í¼ ì´ˆê¸°í™”
        function resetProjectForm() {
            document.getElementById('project-name').value = '';
            document.getElementById('project-manager').value = '';
            document.getElementById('customer').value = '';
            document.getElementById('start-date').value = '';
            document.getElementById('end-date').value = '';

            document.getElementById('bom-file-input').value = '';
            document.getElementById('drawing-files-input').value = '';

            document.getElementById('bom-status').classList.add('hidden');
            document.getElementById('drawing-status').classList.add('hidden');

            currentProject = {
                id: null,
                name: '',
                manager: '',
                customer: '',
                startDate: '',
                endDate: '',
                bomData: null,
                bomFileName: '',
                drawingFiles: [],
                drawingMap: new Map(),
                status: {
                    projectInfo: false,
                    bomAnalysis: false,
                    drawingLink: false,
                    systemRegister: false
                }
            };

            // ìƒíƒœ ë°°ì§€ ì´ˆê¸°í™”
            for (let i = 1; i <= 4; i++) {
                const icon = document.getElementById(`status-icon-${i}`);
                const badge = document.getElementById(`status-badge-${i}`);
                const circle = icon.parentElement;

                if (i === 1) {
                    icon.className = 'fas fa-check text-green-600 text-2xl';
                    circle.className = 'w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-2';
                    badge.className = 'status-badge status-complete mt-2';
                    badge.textContent = 'ì™„ë£Œ';
                } else {
                    icon.className = 'fas fa-hourglass-half text-gray-400 text-2xl';
                    circle.className = 'w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-2';
                    badge.className = 'status-badge status-pending mt-2';
                    badge.textContent = 'ëŒ€ê¸°';
                }
            }

            // Step 4 ë¹„í™œì„±í™”
            document.getElementById('step-4-header').querySelector('.border-l-4').classList.add('border-gray-400');
            document.getElementById('step-4-header').querySelector('.border-l-4').classList.remove('border-blue-600');
            document.getElementById('step-4-header').querySelector('h3').classList.add('text-gray-400');
            document.getElementById('step-4-header').querySelector('h3').classList.remove('text-gray-800');
            document.getElementById('step-4-header').querySelector('p').classList.add('text-gray-500');
            document.getElementById('step-4-header').querySelector('p').classList.remove('text-gray-600');
            document.getElementById('system-register-section').classList.add('opacity-50', 'pointer-events-none');
        }

        // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        function refreshProjectList() {
            projects = JSON.parse(localStorage.getItem('cswind-projects') || '[]');
            const tbody = document.getElementById('project-list-tbody');

            if (projects.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-inbox text-4xl mb-2 block"></i>
                            ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = '';
            projects.forEach((project, index) => {
                const tr = document.createElement('tr');
                tr.className = 'border-b hover:bg-gray-50 cursor-pointer';
                tr.onclick = () => openProject(project.id);

                tr.innerHTML = `
                    <td class="px-6 py-4">${index + 1}</td>
                    <td class="px-6 py-4 font-semibold text-blue-600">${project.name}</td>
                    <td class="px-6 py-4">${project.manager}</td>
                    <td class="px-6 py-4">${project.customer}</td>
                    <td class="px-6 py-4">${project.startDate}</td>
                    <td class="px-6 py-4">${project.endDate}</td>
                    <td class="px-6 py-4">
                        <span class="status-badge status-complete">${project.status.bomAnalysis}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="status-badge status-complete">${project.status.drawingLink}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="status-badge status-complete">${project.status.systemRegister}</span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="event.stopPropagation(); openProject('${project.id}')" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition text-sm">
                            <i class="fas fa-folder-open mr-1"></i>
                            ì—´ê¸°
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // í”„ë¡œì íŠ¸ ì—´ê¸°
        function openProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) {
                alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            console.log('ğŸ“‚ í”„ë¡œì íŠ¸ ì—´ê¸°:', project);

            // í”„ë¡œì íŠ¸ ë°ì´í„°ë¥¼ index.htmlë¡œ ì „ë‹¬í•˜ê³  ì´ë™
            localStorage.setItem('current-project', JSON.stringify(project));
            window.location.href = 'index.html?project=' + projectId;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('load', function() {
            refreshProjectList();
        });
    </script>
</body>
</html>
